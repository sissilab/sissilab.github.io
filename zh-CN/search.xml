<?xml version="1.0" encoding="utf-8"?>
<search>
    
    
    
    <entry>
        <title>å•ä¾‹æ¨¡å¼</title>
        <link href="/zh-CN/design-pattern/singleton-pattern/"/>
        <url>/zh-CN/design-pattern/singleton-pattern/</url>
        
        <content type="html"><![CDATA[<h1 id="0-æ¦‚è¿°"><a class="markdownIt-Anchor" href="#0-æ¦‚è¿°"></a> 0. æ¦‚è¿°</h1><p><strong>å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰</strong> æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œç¡®ä¿ä¸€ä¸ªç±»æœ‰ä¸”åªæœ‰ <strong>ä¸€ä¸ªå®ä¾‹</strong>ï¼Œå¹¶æä¾› <strong>ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹</strong> æ¥è·å–è¯¥å•ä¾‹å®ä¾‹ã€‚</p><p>ç»´åŸºç™¾ç§‘ï¼š</p><blockquote><p>åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œå•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œå®ƒé™åˆ¶ä¸€ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ã€‚è®¸å¤šæ—¶å€™æ•´ä¸ªç³»ç»Ÿåªéœ€è¦æ‹¥æœ‰ä¸€ä¸ªçš„å…¨å±€å¯¹è±¡ï¼Œè¿™æ ·æœ‰åˆ©äºæˆ‘ä»¬åè°ƒç³»ç»Ÿæ•´ä½“çš„è¡Œä¸ºã€‚</p></blockquote><p><strong>å…³é”®ç‰¹ç‚¹</strong>ï¼š</p><ul><li><strong>å•ä¸€å®ä¾‹</strong>ï¼š ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚</li><li><strong>å…¨å±€è®¿é—®ç‚¹</strong>ï¼š æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹æ¥è·å–è¯¥å®ä¾‹ã€‚</li></ul><p><strong>åŸºæœ¬ç»“æ„</strong>ï¼š</p><ul><li><strong>ç§æœ‰æ„é€ å‡½æ•°</strong>ï¼š æ„é€ å‡½æ•°è¢«è®¾ä¸ºç§æœ‰ï¼Œç¡®ä¿è¯¥ç±»æ— æ³•åœ¨ç±»å¤–éƒ¨è¢«å®ä¾‹åŒ–ã€‚</li><li><strong>ç§æœ‰é™æ€å­—æ®µ</strong>ï¼š ä¸€ä¸ªç§æœ‰é™æ€å­—æ®µ <code>instance</code> ç”¨æ¥ä¿å­˜è¯¥ç±»çš„å”¯ä¸€å®ä¾‹ï¼Œå¹¶ä¸”è¯¥å®ä¾‹åº”åœ¨ç±»å†…éƒ¨åˆ›å»ºã€‚</li><li><strong>å…¬å…±é™æ€æ–¹æ³•</strong>ï¼š ä¸€ä¸ªå…¬å…±é™æ€æ–¹æ³• <code>getInstance()</code>ï¼Œé€šå¸¸ä½œä¸ºå…¨å±€è®¿é—®ç‚¹ï¼Œç”¨æ¥è¿”å›è¯¥ç±»çš„å•ä¾‹å®ä¾‹ã€‚</li></ul><img class="kroki" src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIyMzVweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjIwNnB4O2hlaWdodDoyMzVweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyMDYgMjM1IiB3aWR0aD0iMjA2cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tY2xhc3MgU2luZ2xldG9uLS0+PGcgaWQ9ImVsZW1fU2luZ2xldG9uIj48cmVjdCBjb2RlTGluZT0iMyIgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI5Ni44OTA2IiBpZD0iU2luZ2xldG9uIiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxOTIiIHg9IjciIHk9IjEzMiIvPjxlbGxpcHNlIGN4PSI2Ni4yNSIgY3k9IjE0OCIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwYXRoIGQ9Ik02OS4yMTg4LDE1My42NDA2IFE2OC42NDA2LDE1My45Mzc1IDY4LDE1NC4wNzgxIFE2Ny4zNTk0LDE1NC4yMzQ0IDY2LjY1NjMsMTU0LjIzNDQgUTY0LjE1NjMsMTU0LjIzNDQgNjIuODI4MSwxNTIuNTkzOCBRNjEuNTE1NiwxNTAuOTM3NSA2MS41MTU2LDE0Ny44MTI1IFE2MS41MTU2LDE0NC42ODc1IDYyLjgyODEsMTQzLjAzMTMgUTY0LjE1NjMsMTQxLjM3NSA2Ni42NTYzLDE0MS4zNzUgUTY3LjM1OTQsMTQxLjM3NSA2OCwxNDEuNTMxMyBRNjguNjU2MywxNDEuNjg3NSA2OS4yMTg4LDE0MS45ODQ0IEw2OS4yMTg4LDE0NC43MDMxIFE2OC41OTM4LDE0NC4xMjUgNjgsMTQzLjg1OTQgUTY3LjQwNjMsMTQzLjU3ODEgNjYuNzgxMywxNDMuNTc4MSBRNjUuNDM3NSwxNDMuNTc4MSA2NC43NSwxNDQuNjU2MyBRNjQuMDYyNSwxNDUuNzE4OCA2NC4wNjI1LDE0Ny44MTI1IFE2NC4wNjI1LDE0OS45MDYzIDY0Ljc1LDE1MC45ODQ0IFE2NS40Mzc1LDE1Mi4wNDY5IDY2Ljc4MTMsMTUyLjA0NjkgUTY3LjQwNjMsMTUyLjA0NjkgNjgsMTUxLjc4MTMgUTY4LjU5MzgsMTUxLjUgNjkuMjE4OCwxNTAuOTIxOSBMNjkuMjE4OCwxNTMuNjQwNiBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1IiB4PSI4Ni43NSIgeT0iMTUyLjg0NjciPlNpbmdsZXRvbjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI4IiB4Mj0iMTk4IiB5MT0iMTY0IiB5Mj0iMTY0Ii8+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSI2IiB4PSIxNSIgeT0iMTc0LjY0ODQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iMTMzIiB4PSIyNyIgeT0iMTgwLjk5NTEiPmluc3RhbmNlOiBTaW5nbGV0b248L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iOCIgeDI9IjE5OCIgeTE9IjE4OC4yOTY5IiB5Mj0iMTg4LjI5NjkiLz48cmVjdCBmaWxsPSIjRjI0RDVDIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjYiIHg9IjE1IiB5PSIxOTguOTQ1MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc1IiB4PSIyNyIgeT0iMjA1LjI5MiI+U2luZ2xldG9uKCk8L3RleHQ+PGVsbGlwc2UgY3g9IjE4IiBjeT0iMjE4LjI0MjIiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9IjE2NiIgeD0iMjciIHk9IjIyMS41ODg5Ij5nZXRJbnN0YW5jZSgpOiBTaW5nbGV0b248L3RleHQ+PC9nPjwhLS1jbGFzcyBTaW5nbGV0b25NYWluLS0+PGcgaWQ9ImVsZW1fU2luZ2xldG9uTWFpbiI+PHJlY3QgY29kZUxpbmU9IjkiIGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDgiIGlkPSJTaW5nbGV0b25NYWluIiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjkiIHg9IjM4LjUiIHk9IjciLz48ZWxsaXBzZSBjeD0iNTMuNSIgY3k9IjIzIiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBhdGggZD0iTTU2LjQ2ODgsMjguNjQwNiBRNTUuODkwNiwyOC45Mzc1IDU1LjI1LDI5LjA3ODEgUTU0LjYwOTQsMjkuMjM0NCA1My45MDYzLDI5LjIzNDQgUTUxLjQwNjMsMjkuMjM0NCA1MC4wNzgxLDI3LjU5MzggUTQ4Ljc2NTYsMjUuOTM3NSA0OC43NjU2LDIyLjgxMjUgUTQ4Ljc2NTYsMTkuNjg3NSA1MC4wNzgxLDE4LjAzMTMgUTUxLjQwNjMsMTYuMzc1IDUzLjkwNjMsMTYuMzc1IFE1NC42MDk0LDE2LjM3NSA1NS4yNSwxNi41MzEzIFE1NS45MDYzLDE2LjY4NzUgNTYuNDY4OCwxNi45ODQ0IEw1Ni40Njg4LDE5LjcwMzEgUTU1Ljg0MzgsMTkuMTI1IDU1LjI1LDE4Ljg1OTQgUTU0LjY1NjMsMTguNTc4MSA1NC4wMzEzLDE4LjU3ODEgUTUyLjY4NzUsMTguNTc4MSA1MiwxOS42NTYzIFE1MS4zMTI1LDIwLjcxODggNTEuMzEyNSwyMi44MTI1IFE1MS4zMTI1LDI0LjkwNjMgNTIsMjUuOTg0NCBRNTIuNjg3NSwyNy4wNDY5IDU0LjAzMTMsMjcuMDQ2OSBRNTQuNjU2MywyNy4wNDY5IDU1LjI1LDI2Ljc4MTMgUTU1Ljg0MzgsMjYuNSA1Ni40Njg4LDI1LjkyMTkgTDU2LjQ2ODgsMjguNjQwNiBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3IiB4PSI2Ny41IiB5PSIyNy44NDY3Ij5TaW5nbGV0b25NYWluPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjM5LjUiIHgyPSIxNjYuNSIgeTE9IjM5IiB5Mj0iMzkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIzOS41IiB4Mj0iMTY2LjUiIHkxPSI0NyIgeTI9IjQ3Ii8+PC9nPjwhLS1saW5rIFNpbmdsZXRvbk1haW4gdG8gU2luZ2xldG9uLS0+PGcgaWQ9ImxpbmtfU2luZ2xldG9uTWFpbl9TaW5nbGV0b24iPjxwYXRoIGNvZGVMaW5lPSIxMiIgZD0iTTEwMyw1NS4zNiBDMTAzLDc1LjgzIDEwMywxMDAuMiAxMDMsMTI1Ljc4ICIgZmlsbD0ibm9uZSIgaWQ9IlNpbmdsZXRvbk1haW4tdG8tU2luZ2xldG9uIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDtzdHJva2UtZGFzaGFycmF5OjcuMCw3LjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMDMsMTMxLjc4LDEwNywxMjIuNzgsMTAzLDEyNi43OCw5OSwxMjIuNzgsMTAzLDEzMS43OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjMiIHg9IjEwNCIgeT0iOTguMDY2OSI+dXNlPC90ZXh0PjwvZz48IS0tU1JDPVtLeXllQUlhZWpqQk5CeVg5cDJpZnBTdEhJeXhGcktfRUlJbWtyYXQ5SjRtbElpcGJ1VzlwNU84cHl6OXBLYWxveW5JZ2tOR0xnZWpCNGFpb2FzaUxDbEUwaEJwYUwyazQwZzBxZEFzWG9RTURLOW9VTWs4OUxRLVhZUW9aNWlDTXR5SENhNHIwMkxHWEZKcXg5QVRPQVBHTWZ0ODEwMDAwXS0tPjwvZz48L3N2Zz4='><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>åªæœ‰ä¸€ä¸ªå•ä¸€å®ä¾‹ã€‚</li><li>æä¾›ä¸€ä¸ªå…¨å±€å¯è®¿é—®çš„å•ä¸€è®¿é—®ç‚¹ã€‚</li><li>å¯¹äºç®¡ç†å…±äº«èµ„æºéå¸¸æœ‰ç”¨ã€‚</li><li>é˜²æ­¢é¢‘ç¹åˆ›å»ºå’Œé”€æ¯å®ä¾‹ï¼Œä»è€Œå‡å°‘å†…å­˜å¼€é”€ã€‚</li><li>é€šè¿‡ä½¿ç”¨å•ä¸€å®ä¾‹ç¡®ä¿ä¸€è‡´æ€§ã€‚</li><li>åŸºäºå»¶è¿Ÿåˆå§‹åŒ–ï¼ˆLazy Initializationï¼‰ï¼Œå®ä¾‹å¯ä»¥åœ¨é¦–æ¬¡è®¿é—®æ—¶åˆ›å»ºã€‚</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>ä¸å¤Ÿçµæ´»ï¼šå®ƒä¼šä½¿ä»£ç ä¸ç‰¹å®šå®ä¾‹ç´§å¯†è€¦åˆï¼Œä»è€Œé™ä½çµæ´»æ€§ã€‚</li><li>é€šå¸¸è¢«æ ‡è®°ä¸º <code>final</code>ï¼Œæˆ–è€…ä»¥ä¸èƒ½è¢«ç»§æ‰¿çš„æ–¹å¼è®¾è®¡ã€‚</li><li>ä¸é€‚ç”¨äºå¯å˜å¯¹è±¡ã€‚å¦‚æœç›¸åŒç±»å‹çš„å¯¹è±¡åœ¨ä¸åŒä½¿ç”¨åœºæ™¯ä¸­éœ€è¦å‘ç”Ÿå˜åŒ–ï¼Œå®¹æ˜“å¯¼è‡´æ•°æ®é”™è¯¯ã€‚</li><li>å¦‚æœåŠŸèƒ½è®¾è®¡ä¸åˆç†ï¼Œå¯èƒ½è¿å<u>å•ä¸€èŒè´£åŸåˆ™</u>ã€‚</li><li>ä½¿å•å…ƒæµ‹è¯•å˜å¾—å…·æœ‰æŒ‘æˆ˜æ€§ã€‚</li></ul><p><strong>å‡ ç§å•ä¾‹æ¨¡å¼å®ç°çš„æ¯”è¾ƒ</strong>ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>çº¿ç¨‹å®‰å…¨æ€§</th><th>åŠ è½½æ–¹å¼</th><th>æ¨èåº¦</th><th>åå°„æ”»å‡»</th><th>åºåˆ—åŒ–æ”»å‡»</th><th>å®Œç¾ç‰ˆæœ¬</th></tr></thead><tbody><tr><td><a href="#11-%E6%87%92%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B-%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%AE%89%E5%85%A8">1.1. æ‡’æ±‰å¼å•ä¾‹ - çº¿ç¨‹ä¸å®‰å…¨</a></td><td>Ã—</td><td>å»¶è¿ŸåŠ è½½</td><td>âŒ</td><td>-</td><td>-</td><td>-</td></tr><tr><td><a href="#12-%E6%87%92%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B-synchronized">1.2. æ‡’æ±‰å¼å•ä¾‹ - synchronized</a></td><td>âˆš (åŒæ­¥é™æ€æ–¹æ³•)</td><td>å»¶è¿ŸåŠ è½½</td><td>âŒ</td><td>-</td><td>-</td><td>-</td></tr><tr><td><a href="#13-%E6%87%92%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B-%E5%BB%B6%E8%BF%9F%E9%94%81">1.3. æ‡’æ±‰å¼å•ä¾‹ - å»¶è¿Ÿé”</a></td><td>Ã—</td><td>å»¶è¿ŸåŠ è½½</td><td>âŒ</td><td>-</td><td>-</td><td>-</td></tr><tr><td><a href="#14-%E6%87%92%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B-%E5%8F%8C%E9%87%8D%E6%A3%80%E6%9F%A5%E9%94%81%E5%AE%9A%E6%97%A0-volatile">1.4. æ‡’æ±‰å¼å•ä¾‹ - åŒé‡æ£€æŸ¥é”å®šï¼ˆæ—  volatileï¼‰</a></td><td>Ã—</td><td>å»¶è¿ŸåŠ è½½</td><td>âŒ</td><td>-</td><td>-</td><td>-</td></tr><tr><td><a href="#15-%E6%87%92%E6%B1%89%E5%8D%95%E4%BE%8B-%E5%8F%8C%E9%87%8D%E6%A3%80%E6%9F%A5%E9%94%81%E5%AE%9Adcl">1.5. æ‡’æ±‰å•ä¾‹ - åŒé‡æ£€æŸ¥é”å®šï¼ˆDCLï¼‰</a></td><td>âˆš (volatile å®ä¾‹ + DCL)</td><td>å»¶è¿ŸåŠ è½½ (DCL)</td><td>ğŸ‘</td><td>Ã— (<a href="#151-%E5%AF%B9%E6%87%92%E6%B1%89%E5%8D%95%E4%BE%8B-%E5%8F%8C%E9%87%8D%E6%A3%80%E6%9F%A5%E9%94%81%E5%AE%9A%E7%9A%84%E5%8F%8D%E5%B0%84%E6%94%BB%E5%87%BB">1.5.1. å¯¹â€œæ‡’æ±‰å•ä¾‹ - åŒé‡æ£€æŸ¥é”å®šâ€çš„åå°„æ”»å‡»</a>)</td><td>âˆš (<a href="#152-%E5%AF%B9%E6%87%92%E6%B1%89%E5%8D%95%E4%BE%8B-%E5%8F%8C%E9%87%8D%E6%A3%80%E6%9F%A5%E9%94%81%E5%AE%9A%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E6%94%BB%E5%87%BB">1.5.2. å¯¹â€œæ‡’æ±‰å•ä¾‹ - åŒé‡æ£€æŸ¥é”å®šâ€çš„åºåˆ—åŒ–æ”»å‡»</a>)</td><td><a href="#153-%E5%AE%8C%E7%BE%8E%E7%89%88%E7%9A%84%E6%87%92%E6%B1%89%E5%8D%95%E4%BE%8B-%E5%8F%8C%E9%87%8D%E6%A3%80%E6%9F%A5%E9%94%81%E5%AE%9A">1.5.3. å®Œç¾ç‰ˆçš„â€œæ‡’æ±‰å•ä¾‹ - åŒé‡æ£€æŸ¥é”å®šâ€</a></td></tr><tr><td><a href="#21-%E9%A5%BF%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B-%E9%9D%99%E6%80%81%E5%B8%B8%E9%87%8F">2.1. é¥¿æ±‰å¼å•ä¾‹ - é™æ€å¸¸é‡</a></td><td>âˆš (ç±»åŠ è½½æœºåˆ¶)</td><td>é¥¿æ±‰å¼ï¼ˆç±»åŠ è½½æ—¶ï¼‰</td><td>ğŸ‘</td><td>âˆš (<a href="#211-%E5%AF%B9%E9%A5%BF%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B-%E9%9D%99%E6%80%81%E5%B8%B8%E9%87%8F%E7%9A%84%E5%8F%8D%E5%B0%84%E6%94%BB%E5%87%BB">2.1.1. å¯¹â€œé¥¿æ±‰å¼å•ä¾‹ - é™æ€å¸¸é‡â€çš„åå°„æ”»å‡»</a>)</td><td>âˆš (<a href="#212-%E5%AF%B9%E9%A5%BF%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B-%E9%9D%99%E6%80%81%E5%B8%B8%E9%87%8F%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E6%94%BB%E5%87%BB">2.1.2. å¯¹â€œé¥¿æ±‰å¼å•ä¾‹ - é™æ€å¸¸é‡â€çš„åºåˆ—åŒ–æ”»å‡»</a>)</td><td><a href="#213-%E5%AE%8C%E7%BE%8E%E7%89%88%E7%9A%84%E9%A5%BF%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B-%E9%9D%99%E6%80%81%E5%B8%B8%E9%87%8F">2.1.3. å®Œç¾ç‰ˆçš„â€œé¥¿æ±‰å¼å•ä¾‹ - é™æ€å¸¸é‡â€</a></td></tr><tr><td><a href="#22-%E9%A5%BF%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B-%E9%9D%99%E6%80%81%E5%9D%97">2.2. é¥¿æ±‰å¼å•ä¾‹ - é™æ€å—</a></td><td>âˆš (ç±»åŠ è½½æœºåˆ¶)</td><td>é¥¿æ±‰å¼ï¼ˆç±»åŠ è½½æ—¶ï¼‰</td><td>ğŸ‘</td><td>âˆš (<a href="#221-%E5%AF%B9%E9%A5%BF%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B-%E9%9D%99%E6%80%81%E5%9D%97%E7%9A%84%E5%8F%8D%E5%B0%84%E6%94%BB%E5%87%BB">2.2.1. å¯¹â€œé¥¿æ±‰å¼å•ä¾‹ - é™æ€å—â€çš„åå°„æ”»å‡»</a>)</td><td>âˆš (<a href="#222-%E5%AF%B9%E9%A5%BF%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B-%E9%9D%99%E6%80%81%E5%9D%97%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E6%94%BB%E5%87%BB">2.2.2. å¯¹â€œé¥¿æ±‰å¼å•ä¾‹ - é™æ€å—â€çš„åºåˆ—åŒ–æ”»å‡»</a>)</td><td><a href="#223-%E5%AE%8C%E7%BE%8E%E7%89%88%E6%9C%AC%E7%9A%84%E9%A5%BF%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B-%E9%9D%99%E6%80%81%E5%9D%97">2.2.3. å®Œç¾ç‰ˆæœ¬çš„â€œé¥¿æ±‰å¼å•ä¾‹ - é™æ€å—â€</a></td></tr><tr><td><a href="#3-%E9%9D%99%E6%80%81%E5%86%85%E9%83%A8%E7%B1%BB%E5%8D%95%E4%BE%8B">3. é™æ€å†…éƒ¨ç±»å•ä¾‹</a></td><td>âˆš (ç±»åŠ è½½æœºåˆ¶)</td><td>å»¶è¿ŸåŠ è½½ï¼ˆé™æ€å†…éƒ¨ç±»ï¼‰</td><td>ğŸ‘</td><td>âˆš (<a href="#31-%E5%AF%B9%E9%9D%99%E6%80%81%E5%86%85%E9%83%A8%E7%B1%BB%E5%8D%95%E4%BE%8B%E7%9A%84%E5%8F%8D%E5%B0%84%E6%94%BB%E5%87%BB">3.1. å¯¹â€œé™æ€å†…éƒ¨ç±»å•ä¾‹â€çš„åå°„æ”»å‡»</a>)</td><td>âˆš (<a href="#32-%E5%AF%B9%E9%9D%99%E6%80%81%E5%86%85%E9%83%A8%E7%B1%BB%E5%8D%95%E4%BE%8B%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E6%94%BB%E5%87%BB">3.2. å¯¹â€œé™æ€å†…éƒ¨ç±»å•ä¾‹â€çš„åºåˆ—åŒ–æ”»å‡»</a>)</td><td><a href="#33-%E5%AE%8C%E7%BE%8E%E7%89%88%E6%9C%AC%E7%9A%84%E9%9D%99%E6%80%81%E5%86%85%E9%83%A8%E7%B1%BB%E5%8D%95%E4%BE%8B">3.3. å®Œç¾ç‰ˆæœ¬çš„â€œé™æ€å†…éƒ¨ç±»å•ä¾‹â€</a></td></tr><tr><td><a href="#4-%E6%9E%9A%E4%B8%BE%E5%9E%8B%E5%8D%95%E4%BE%8B">4. æšä¸¾å‹å•ä¾‹</a></td><td>âˆš (å¤©ç”Ÿå®‰å…¨ï¼Œç±»åŠ è½½æœºåˆ¶)</td><td>é¥¿æ±‰å¼ï¼ˆæšä¸¾ç±»åŠ è½½æ—¶ï¼‰</td><td>ğŸ‘</td><td>âˆš (<a href="#41-%E5%AF%B9%E6%9E%9A%E4%B8%BE%E5%9E%8B%E5%8D%95%E4%BE%8B%E7%9A%84%E5%8F%8D%E5%B0%84%E6%94%BB%E5%87%BB">4.1. å¯¹â€œæšä¸¾å‹å•ä¾‹â€çš„åå°„æ”»å‡»</a>)</td><td>âˆš (<a href="#42-%E5%AF%B9%E6%9E%9A%E4%B8%BE%E5%9E%8B%E5%8D%95%E4%BE%8B%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E6%94%BB%E5%87%BB">4.2. å¯¹â€œæšä¸¾å‹å•ä¾‹â€çš„åºåˆ—åŒ–æ”»å‡»</a>)</td><td><a href="#43-%E5%AE%8C%E7%BE%8E%E7%89%88%E6%9C%AC%E7%9A%84%E6%9E%9A%E4%B8%BE%E5%9E%8B%E5%8D%95%E4%BE%8B">4.3. å®Œç¾ç‰ˆæœ¬çš„â€œæšä¸¾å‹å•ä¾‹â€</a></td></tr></tbody></table><h1 id="1-æ‡’æ±‰å¼å•ä¾‹"><a class="markdownIt-Anchor" href="#1-æ‡’æ±‰å¼å•ä¾‹"></a> 1. æ‡’æ±‰å¼å•ä¾‹</h1><p>æ‡’åŠ è½½æ„å‘³ç€å®ä¾‹åªä¼šåœ¨é¦–æ¬¡è®¿é—®æˆ–é¦–æ¬¡è°ƒç”¨é™æ€æ–¹æ³•æ—¶åˆ›å»ºã€‚</p><h2 id="11-æ‡’æ±‰å¼å•ä¾‹-çº¿ç¨‹ä¸å®‰å…¨"><a class="markdownIt-Anchor" href="#11-æ‡’æ±‰å¼å•ä¾‹-çº¿ç¨‹ä¸å®‰å…¨"></a> 1.1. æ‡’æ±‰å¼å•ä¾‹ - çº¿ç¨‹ä¸å®‰å…¨</h2><p>å®ƒåœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹å·¥ä½œæ­£å¸¸ï¼Œä½†åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å¯èƒ½ä¼šç ´åå•ä¾‹æ¨¡å¼ï¼Œå¯¼è‡´åˆ›å»ºå¤šä¸ªä¸åŒçš„å®ä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LazySingletonThreadUnsafe</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazySingletonThreadUnsafe instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šé™åˆ¶ç”¨æˆ·è‡ªè¡Œåˆ›å»ºå®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazySingletonThreadUnsafe</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ§åˆ¶å¯¹å•ä¾‹å®ä¾‹çš„è®¿é—®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LazySingletonThreadUnsafe <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == instance) &#123;</span><br><span class="line">            <span class="comment">/*try &#123;</span></span><br><span class="line"><span class="comment">                // æ¨¡æ‹Ÿå¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ— æ³•ä¿è¯å•ä¾‹æ¨¡å¼çš„æƒ…å†µï¼Œ</span></span><br><span class="line"><span class="comment">                // æé«˜é‡ç°é—®é¢˜çš„æ¦‚ç‡ã€‚</span></span><br><span class="line"><span class="comment">                TimeUnit.MILLISECONDS.sleep(200);</span></span><br><span class="line"><span class="comment">            &#125; catch (InterruptedException e) &#123;</span></span><br><span class="line"><span class="comment">                e.printStackTrace();</span></span><br><span class="line"><span class="comment">            &#125;*/</span></span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">LazySingletonThreadUnsafe</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ä»£ç ï¼š</strong></p><ul><li>å•çº¿ç¨‹ç¯å¢ƒï¼šå¯ä»¥è·å–ç›¸åŒçš„å®ä¾‹ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLazySingletonThreadUnsafeSingleThread</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">LazySingletonThreadUnsafe</span> <span class="variable">instance1</span> <span class="operator">=</span> LazySingletonThreadUnsafe.getInstance();</span><br><span class="line">    <span class="type">LazySingletonThreadUnsafe</span> <span class="variable">instance2</span> <span class="operator">=</span> LazySingletonThreadUnsafe.getInstance();</span><br><span class="line">    System.out.println(<span class="string">&quot;instance1: &quot;</span> + instance1);</span><br><span class="line">    System.out.println(<span class="string">&quot;instance2: &quot;</span> + instance2);</span><br><span class="line">    <span class="comment">// `instance1` å’Œ `instance2` æ˜¯ç›¸åŒçš„å®ä¾‹ã€‚</span></span><br><span class="line">    Assertions.assertSame(instance1, instance2); <span class="comment">// âˆš</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¤šçº¿ç¨‹ç¯å¢ƒï¼šå¯èƒ½ä¼šè·å–åˆ°ä¸åŒçš„å®ä¾‹ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLazySingletonThreadUnsafeMultiThread</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">THREAD_COUNT</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newFixedThreadPool(THREAD_COUNT);</span><br><span class="line"></span><br><span class="line">    Callable&lt;LazySingletonThreadUnsafe&gt; callableTask = () -&gt; LazySingletonThreadUnsafe.getInstance();</span><br><span class="line">    Future&lt;LazySingletonThreadUnsafe&gt;[] futures = <span class="keyword">new</span> <span class="title class_">Future</span>[THREAD_COUNT];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; THREAD_COUNT; i++) &#123;</span><br><span class="line">        futures[i] = executorService.submit(callableTask);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">LazySingletonThreadUnsafe</span> <span class="variable">firstInstance</span> <span class="operator">=</span> futures[<span class="number">0</span>].get();</span><br><span class="line">    <span class="keyword">for</span> (Future&lt;LazySingletonThreadUnsafe&gt; future : futures) &#123;</span><br><span class="line">        <span class="type">LazySingletonThreadUnsafe</span> <span class="variable">instance</span> <span class="operator">=</span> future.get();</span><br><span class="line">        System.out.println(instance);</span><br><span class="line">        <span class="comment">// åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å¯èƒ½ä¼šç ´åå•ä¾‹æ¨¡å¼ï¼Œå¯¼è‡´è·å–åˆ°ä¸åŒçš„å®ä¾‹ã€‚</span></span><br><span class="line">        <span class="comment">// å¦‚æœé—®é¢˜æ— æ³•é‡ç°ï¼Œè¯·å°è¯•å¤šæ¬¡è¿è¡Œæµ‹è¯•æ–¹æ³•æˆ–å–æ¶ˆæ³¨é‡Š LazySingletonThreadUnsafe.getInstance() ä¸­çš„ä»£ç ã€‚</span></span><br><span class="line">        Assertions.assertSame(firstInstance, instance); <span class="comment">// Ã—</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    executorService.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="12-æ‡’æ±‰å¼å•ä¾‹-synchronized"><a class="markdownIt-Anchor" href="#12-æ‡’æ±‰å¼å•ä¾‹-synchronized"></a> 1.2. æ‡’æ±‰å¼å•ä¾‹ - synchronized</h2><p><a href="#11-%E6%87%92%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B-%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%AE%89%E5%85%A8">1.1. æ‡’æ±‰å¼å•ä¾‹ - çº¿ç¨‹ä¸å®‰å…¨</a> ä¸æ”¯æŒå¤šçº¿ç¨‹åœºæ™¯ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•ç²—æš´åœ°åœ¨ <code>getInstance()</code> æ–¹æ³•ä¸Šæ·»åŠ  <code>synchronized</code> é”ã€‚è™½ç„¶è¿™ç§æ–¹æ³•å¯ä»¥è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä½†æ•ˆç‡ä½ä¸‹ï¼Œå› ä¸ºå®ƒé€šè¿‡é”å®šé™æ€æ–¹æ³•æ¥é”å®šç±»å¯¹è±¡ï¼ˆç±»çº§åˆ«é”ï¼Œè€Œä¸æ˜¯å¯¹è±¡çº§åˆ«é”ï¼‰ã€‚è¿™æ„å‘³ç€æ¯æ¬¡å¤šä¸ªçº¿ç¨‹å°è¯•é€šè¿‡ <code>getInstance()</code> æ–¹æ³•è®¿é—®å•ä¾‹å®ä¾‹æ—¶ï¼Œéƒ½ä¼šè¢«é”å®šï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®ï¼Œè¿™å¤§å¤§å½±å“äº†æ€§èƒ½ã€‚å®é™…ä¸Šï¼Œè¿™ç§æ–¹æ³•åªéœ€åœ¨ç±»å®ä¾‹åŒ–æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œä¹‹åçš„æ‰€æœ‰è¯·æ±‚éƒ½å¯ä»¥ç›´æ¥è¿”å›å·²ç»å®ä¾‹åŒ–çš„å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LazySingletonSynchronized</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazySingletonSynchronized instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šé™åˆ¶ç”¨æˆ·è‡ªè¡Œåˆ›å»ºå®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazySingletonSynchronized</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŒæ­¥é™æ€æ–¹æ³•ï¼šç±»çº§åˆ«é”ç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œé™æ€åŒæ­¥æ–¹æ³•ã€‚</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> LazySingletonSynchronized <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == instance) &#123;</span><br><span class="line">            <span class="comment">/*try &#123;</span></span><br><span class="line"><span class="comment">                // æ¨¡æ‹Ÿå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹å¹¶ä¸æ€»æ˜¯è·å–åˆ°ç›¸åŒçš„å•ä¾‹å®ä¾‹ï¼Œ</span></span><br><span class="line"><span class="comment">                // æé«˜é‡ç°é—®é¢˜çš„æ¦‚ç‡ã€‚</span></span><br><span class="line"><span class="comment">                TimeUnit.MILLISECONDS.sleep(200);</span></span><br><span class="line"><span class="comment">            &#125; catch (InterruptedException e) &#123;</span></span><br><span class="line"><span class="comment">                e.printStackTrace();</span></span><br><span class="line"><span class="comment">            &#125;*/</span></span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">LazySingletonSynchronized</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="13-æ‡’æ±‰å¼å•ä¾‹-å»¶è¿Ÿé”"><a class="markdownIt-Anchor" href="#13-æ‡’æ±‰å¼å•ä¾‹-å»¶è¿Ÿé”"></a> 1.3. æ‡’æ±‰å¼å•ä¾‹ - å»¶è¿Ÿé”</h2><p>åŸºäº <a href="#12-%E6%87%92%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B-synchronized">1.2. æ‡’æ±‰å¼å•ä¾‹ - synchronized</a>ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä»…åœ¨ç¬¬ä¸€æ¬¡è¿”å›å®ä¾‹æ—¶é”å®šå®ä¾‹åŒ–è¿‡ç¨‹ã€‚å®ä¾‹åœ¨ä¸´ç•ŒåŒºå†…è¢«å®ä¾‹åŒ–ï¼Œä»¥ç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„çº¿ç¨‹å®‰å…¨ã€‚ä¹‹åçš„æ‰€æœ‰æ“ä½œå°†ç›´æ¥è¿”å›è¯¥å®ä¾‹ï¼Œè€Œä¸è¿›å…¥ä¸´ç•ŒåŒºï¼Œä»¥æé«˜å¤šçº¿ç¨‹æ€§èƒ½ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä»ç„¶ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œåœ¨ä»¥ä¸‹åœºæ™¯ä¸­ï¼Œçº¿ç¨‹ T1 å’Œ T2 å¯èƒ½ä¼šåˆ›å»ºä¸¤ä¸ªä¸åŒçš„å®ä¾‹ã€‚</p><ol><li>T1ï¼šåˆšè¿›å…¥ä¸´ç•ŒåŒºï¼Œå°šæœªå®ä¾‹åŒ–ï¼š<code>instance=null</code>ï¼ŒT1 æŒæœ‰ç±»çº§åˆ«é”</li><li>T2ï¼šè¿›å…¥ if ä»£ç å—ï¼Œå› ä¸º T1 ä¸­çš„ <code>instance</code> å­—æ®µå°šæœªå®ä¾‹åŒ–å®Œæˆï¼ˆ<code>instance</code> ä»ç„¶ä¸º nullï¼‰ï¼š<code>instance=null</code>ï¼ŒT1 æŒæœ‰ç±»çº§åˆ«é”ï¼ŒT2 åœ¨è¿›å…¥ä¸´ç•ŒåŒºå‰è¢«é˜»å¡</li><li>T1ï¼šå®Œæˆå®ä¾‹åŒ–å¹¶é€€å‡ºä¸´ç•ŒåŒºï¼š<code>instance=LazySingletonDelayLock@4a87761d</code>ï¼ˆ<code>instance!=null</code>ï¼‰ï¼ŒT1 é‡Šæ”¾é”ï¼ŒT2 æœ‰æœºä¼šè·å¾—é”</li><li>T2ï¼šè¿›å…¥ä¸´ç•ŒåŒºå¹¶å†æ¬¡æ‰§è¡Œå®ä¾‹åŒ–ï¼š<code>instance=LazySingletonDelayLock@2db7a79b</code>ï¼ˆç°åœ¨å®ƒè¿”å›äº†ä¸¤ä¸ªä¸åŒçš„å®ä¾‹ï¼Œç ´åäº†å•ä¾‹æ¨¡å¼ï¼ï¼‰</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LazySingletonDelayLock</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazySingletonDelayLock instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šé™åˆ¶ç”¨æˆ·è‡ªè¡Œåˆ›å»ºå®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazySingletonDelayLock</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨ `instance` ä¸ºç©ºæ—¶çš„ if ä»£ç å—ä¸­å»¶è¿Ÿé”å®š</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LazySingletonDelayLock <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == instance) &#123;</span><br><span class="line">            <span class="comment">// T2ï¼šæ­¤æ—¶ä»å¯èƒ½è¿›å…¥ if ä»£ç å—ï¼Œå› ä¸º T1 ä¸­çš„ `instance` å­—æ®µå°šæœªå®Œæˆå®ä¾‹åŒ–ï¼ˆ`instance` ä»ç„¶ä¸º nullï¼‰</span></span><br><span class="line">            <span class="keyword">synchronized</span> (LazySingletonDelayLock.class) &#123; <span class="comment">// ç±»çº§åˆ«é”</span></span><br><span class="line">                <span class="comment">// T1ï¼šåˆšè¿›å…¥ä¸´ç•ŒåŒºï¼Œå°šæœªå®ä¾‹åŒ–</span></span><br><span class="line">                instance = <span class="keyword">new</span> <span class="title class_">LazySingletonDelayLock</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="14-æ‡’æ±‰å¼å•ä¾‹-åŒé‡æ£€æŸ¥é”å®šæ— -volatile"><a class="markdownIt-Anchor" href="#14-æ‡’æ±‰å¼å•ä¾‹-åŒé‡æ£€æŸ¥é”å®šæ— -volatile"></a> 1.4. æ‡’æ±‰å¼å•ä¾‹ - åŒé‡æ£€æŸ¥é”å®šï¼ˆæ—  volatileï¼‰</h2><p>ä¸ºäº†è§£å†³ <a href="#13-%E6%87%92%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B-%E5%BB%B6%E8%BF%9F%E9%94%81">1.3. æ‡’æ±‰å¼å•ä¾‹ - å»¶è¿Ÿé”</a> ä¸­æåˆ°çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥åœ¨åŒæ­¥å—ä¸­æ·»åŠ æ£€æŸ¥ï¼Œç¡®è®¤ <code>instance</code> æ˜¯å¦ä¸ºç©ºã€‚å¦‚æœä¸ºç©ºï¼Œåˆ™è¿›è¡Œå®ä¾‹åŒ–ã€‚è¿™å¯ä»¥é˜²æ­¢å¤šçº¿ç¨‹åœºæ™¯ä¸‹å¯¼è‡´çš„å¤šæ¬¡å®ä¾‹åŒ–é—®é¢˜ã€‚</p><p>ç„¶è€Œï¼Œç”±äº <code>instance</code> å­—æ®µæ²¡æœ‰æ ‡è®°ä¸º <code>volatile</code>ï¼Œä»ç„¶å¯èƒ½ç”±äº<u>æŒ‡ä»¤é‡æ’åº</u>å¯¼è‡´é”™è¯¯ã€‚</p><p>åœ¨åˆ›å»ºæ–°å¯¹è±¡ï¼ˆå¦‚ <code>instance = new LazySingletonNoVolatileDoubleCheck()</code>ï¼‰æ—¶ï¼Œå†…éƒ¨å®é™…ä¸Šæ¶‰åŠä¸‰ä¸ªä¸»è¦æ­¥éª¤ï¼š<code>1. å†…å­˜åˆ†é…</code> â†’ <code>2. åˆå§‹åŒ–</code> â†’ <code>3. å¼•ç”¨èµ‹å€¼</code>ã€‚</p><p>ä¸ºäº†æé«˜æ€§èƒ½ï¼ŒJVM å…è®¸å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œè¿™ä¸‰ä¸ªæ­¥éª¤å¯èƒ½ä¼šè¢«é‡æ–°æ’åˆ—ï¼Œå¦‚ <code>1. å†…å­˜åˆ†é…</code> â†’ <code>3. å¼•ç”¨èµ‹å€¼</code> â†’ <code>2. åˆå§‹åŒ–</code>ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼š</p><ol><li>T1ï¼šè¿›å…¥ä¸´ç•ŒåŒºå¹¶å‡†å¤‡ new</li><li>T1ï¼šå†…å­˜åˆ†é…</li><li>T1ï¼šå¼•ç”¨èµ‹å€¼ï¼ˆå› ä¸ºæ­¤æ—¶å°šæœªå®Œæˆåˆå§‹åŒ–ï¼Œå°½ç®¡ <code>instance</code> ç°åœ¨æŒ‡å‘æ–°åˆ†é…çš„å †ç©ºé—´ï¼Œä½†å¯¹è±¡åªæ˜¯éƒ¨åˆ†åˆå§‹åŒ–ã€‚ï¼‰</li><li>T2ï¼šåœ¨ç¬¬ä¸€æ¬¡ <code>if</code> æ£€æŸ¥æ—¶ï¼Œå‘ç° <code>instance</code> ä¸ä¸ºç©ºï¼ˆT1 å°šæœªå®Œæˆå®Œæ•´åˆå§‹åŒ–ï¼‰ï¼Œç›´æ¥è¿”å›äº†éƒ¨åˆ†åˆå§‹åŒ–çš„å¯¹è±¡ï¼Œå¯¼è‡´ç¨‹åºé”™è¯¯ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LazySingletonNoVolatileDoubleCheck</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazySingletonNoVolatileDoubleCheck instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šé™åˆ¶ç”¨æˆ·è‡ªè¡Œåˆ›å»ºå®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazySingletonNoVolatileDoubleCheck</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ·»åŠ åŒé‡æ£€æŸ¥é”å®šï¼Œä½†æœªæ ‡è®° `volatile` çš„ `instance`</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LazySingletonNoVolatileDoubleCheck <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == instance) &#123; <span class="comment">// T2ï¼šç›´æ¥è¿”å› `instance`ï¼Œä½†æ­¤æ—¶å°šæœªå®Œå…¨åˆå§‹åŒ–ï¼Œå¯¼è‡´è¿”å›äº†éƒ¨åˆ†æ„é€ æˆ–æœªåˆå§‹åŒ–çš„å®ä¾‹</span></span><br><span class="line">            <span class="keyword">synchronized</span> (LazySingletonNoVolatileDoubleCheck.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> == instance) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">LazySingletonNoVolatileDoubleCheck</span>();</span><br><span class="line">                    <span class="comment">// å­—èŠ‚ç ï¼š1. å†…å­˜åˆ†é… -&gt; 2. åˆå§‹åŒ– -&gt; 3. å¼•ç”¨èµ‹å€¼</span></span><br><span class="line">                    <span class="comment">// å¯èƒ½é‡æ’åºå¦‚ä¸‹ï¼š</span></span><br><span class="line">                    <span class="comment">// 1. å†…å­˜åˆ†é…</span></span><br><span class="line">                    <span class="comment">// 3. å¼•ç”¨èµ‹å€¼ // T1ï¼š`instance` è¢«èµ‹äºˆå¼•ç”¨ï¼Œä½†å°šæœªå®Œå…¨åˆå§‹åŒ–</span></span><br><span class="line">                    <span class="comment">// 2. åˆå§‹åŒ–</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å·²ç»å‘ç°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡çš„è¿‡ç¨‹ä¸­åŒ…å«äº†å¤šä¸ªæ­¥éª¤ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ä» Java å­—èŠ‚ç çš„è§’åº¦æ·±å…¥ç†è§£å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ç¼–å†™å¦‚ä¸‹ç®€å•çš„æµ‹è¯•ä»£ç æ¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NewTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">NewTest</span> <span class="variable">newTest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NewTest</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>javac -g NewTest.java</code> ç¼–è¯‘ <code>NewTest.java</code> ä»¥è·å– <code>NewTest.class</code>ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œ <code>javap -v -p NewTest.class</code> æ¥è·å–ç±»æ–‡ä»¶ä¸­å­—æ®µã€æ„é€ å‡½æ•°å’Œæ–¹æ³•çš„å­—èŠ‚ç ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">Classfile /DesignPattern-Lab/src/main/java/com/sissilab/dp/ox1_creational/ox11_singleton/NewTest.<span class="keyword">class</span></span><br><span class="line">  <span class="title class_">Last</span> modified <span class="number">25</span>/<span class="number">07</span>/<span class="number">2024</span>; size <span class="number">487</span> bytes</span><br><span class="line">  MD5 checksum e132b23dc7ec6394be9137ad5aa7c33a</span><br><span class="line">  Compiled from <span class="string">&quot;NewTest.java&quot;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">com</span>.sissilab.dp.ox1_creational.ox11_singleton.NewTest</span><br><span class="line">  minor version: <span class="number">0</span></span><br><span class="line">  major version: <span class="number">52</span> <span class="comment">// Java ä¸»ç‰ˆæœ¬å· 52 è¡¨ç¤ºç”¨ JDK 1.8ï¼ˆJava 8ï¼‰ç¼–è¯‘çš„ç±»æ–‡ä»¶ã€‚</span></span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER <span class="comment">// ç±»è®¿é—®ä¿®é¥°ç¬¦ï¼šè¯¥ç±»æ˜¯ publicï¼ˆå…¬å…±çš„ï¼‰ã€‚</span></span><br><span class="line">Constant pool:</span><br><span class="line">   #<span class="number">1</span> = Methodref          #<span class="number">4.</span>#<span class="number">19</span>         <span class="comment">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">   #<span class="number">2</span> = Class              #<span class="number">20</span>            <span class="comment">// com/sissilab/dp/ox1_creational/ox11_singleton/NewTest</span></span><br><span class="line">   #<span class="number">3</span> = Methodref          #<span class="number">2.</span>#<span class="number">19</span>         <span class="comment">// com/sissilab/dp/ox1_creational/ox11_singleton/NewTest.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">   #<span class="number">4</span> = Class              #<span class="number">21</span>            <span class="comment">// java/lang/Object</span></span><br><span class="line">   #<span class="number">5</span> = Utf8               &lt;init&gt;</span><br><span class="line">   #<span class="number">6</span> = Utf8               ()V</span><br><span class="line">   #<span class="number">7</span> = Utf8               Code</span><br><span class="line">   #<span class="number">8</span> = Utf8               LineNumberTable</span><br><span class="line">   #<span class="number">9</span> = Utf8               LocalVariableTable</span><br><span class="line">  #<span class="number">10</span> = Utf8               <span class="built_in">this</span></span><br><span class="line">  #<span class="number">11</span> = Utf8               Lcom/sissilab/dp/ox1_creational/ox11_singleton/NewTest;</span><br><span class="line">  #<span class="number">12</span> = Utf8               main</span><br><span class="line">  #<span class="number">13</span> = Utf8               ([Ljava/lang/String;)V</span><br><span class="line">  #<span class="number">14</span> = Utf8               args</span><br><span class="line">  #<span class="number">15</span> = Utf8               [Ljava/lang/String;</span><br><span class="line">  #<span class="number">16</span> = Utf8               newTest</span><br><span class="line">  #<span class="number">17</span> = Utf8               SourceFile</span><br><span class="line">  #<span class="number">18</span> = Utf8               NewTest.java</span><br><span class="line">  #<span class="number">19</span> = NameAndType        #<span class="number">5</span>:#<span class="number">6</span>          <span class="comment">// &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">  #<span class="number">20</span> = Utf8               com/sissilab/dp/ox1_creational/ox11_singleton/NewTest</span><br><span class="line">  #<span class="number">21</span> = Utf8               java/lang/Object</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> com.sissilab.dp.ox1_creational.ox11_singleton.NewTest(); <span class="comment">// è‡ªåŠ¨ç”Ÿæˆçš„é»˜è®¤æ— å‚æ„é€ å‡½æ•°</span></span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">6</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="built_in">this</span>   Lcom/sissilab/dp/ox1_creational/ox11_singleton/NewTest;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(java.lang.String[])</span>; <span class="comment">// main æ–¹æ³•</span></span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">2</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="comment">// newï¼šä¸ºç”± #2 å¼•ç”¨çš„ç±»çš„å¯¹è±¡åˆ†é…å†…å­˜ -&gt; å°†å¼•ç”¨æ·»åŠ åˆ°æ“ä½œæ•°æ ˆçš„é¡¶éƒ¨ã€‚</span></span><br><span class="line">         <span class="number">0</span>: <span class="keyword">new</span>           #<span class="number">2</span>                  <span class="comment">// class com/sissilab/dp/ox1_creational/ox11_singleton/NewTest</span></span><br><span class="line">         <span class="comment">// dupï¼šå¤åˆ¶æ ˆé¡¶å€¼ -&gt; å°†å¤åˆ¶çš„å¼•ç”¨æ·»åŠ åˆ°æ“ä½œæ•°æ ˆçš„é¡¶éƒ¨ï¼ˆå› ä¸ºéšåçš„ `invokespecial` å°†æ¶ˆè€—ä¸€ä¸ªå¼•ç”¨ï¼‰ã€‚</span></span><br><span class="line">         <span class="number">3</span>: dup</span><br><span class="line">         <span class="comment">// invokespecialï¼šè°ƒç”¨æ„é€ å‡½æ•°ä»¥åˆå§‹åŒ–æ–°åˆ†é…çš„ç©ºé—´å¹¶æ¶ˆè€—ä¸€ä¸ªå¼•ç”¨ã€‚</span></span><br><span class="line">         <span class="number">4</span>: invokespecial #<span class="number">3</span>                  <span class="comment">// Method &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         <span class="comment">// astore_1ï¼šå¼¹å‡ºæ ˆé¡¶å€¼ -&gt; å°†å¼•ç”¨åˆ†é…ç»™ LocalVariableTable ä¸­ä½ç½® 1 çš„å…ƒç´ ï¼ˆ`newTest`ï¼‰ã€‚</span></span><br><span class="line">         <span class="number">7</span>: astore_1</span><br><span class="line">         <span class="number">8</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable: <span class="comment">// å°†å­—èŠ‚ç æŒ‡ä»¤æ˜ å°„åˆ°æºæ–‡ä»¶ä¸­çš„è¡Œã€‚</span></span><br><span class="line">        line <span class="number">8</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">9</span>: <span class="number">8</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">9</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">            <span class="number">8</span>       <span class="number">1</span>     <span class="number">1</span> newTest   Lcom/sissilab/dp/ox1_creational/ox11_singleton/NewTest;</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">&quot;NewTest.java&quot;</span></span><br></pre></td></tr></table></figure><p>è™½ç„¶åªæœ‰å‡ è¡Œç®€å•çš„æºä»£ç ï¼Œä½†åç¼–è¯‘åçš„å†…å®¹å´å¾ˆåºå¤§ã€‚ä¸»è¦é›†ä¸­åœ¨ä¸‹é¢çš„ä»£ç éƒ¨åˆ†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: <span class="keyword">new</span>           #<span class="number">2</span>                  <span class="comment">// class com/sissilab/dp/ox1_creational/ox11_singleton/NewTest</span></span><br><span class="line"><span class="number">3</span>: dup</span><br><span class="line"><span class="number">4</span>: invokespecial #<span class="number">3</span>                  <span class="comment">// Method &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line"><span class="number">7</span>: astore_1</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯è¯¥è¿‡ç¨‹çš„è¯´æ˜ï¼š</p><div class="excalidraw-svg"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1081.6370313640625 772.25" filter="invert(93%) hue-rotate(180deg)" class="excalidraw-svg"><!-- svg-source:excalidraw --><defs><style class="style-fonts"> @font-face { font-family: Virgil; src: url(data:font/woff2;base64,d09GMgABAAAAABiAAAsAAAAAJtwAABgwAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAABmAAgRwRCArDWLIAC1oAATYCJAOBMAQgBYMcByAb6RxRVM8qZF8c8ObQKYfzYhl1y0eMQV7LSUc0Z7N3uUsupuAxxBPEvyQhCSFYMGkJEtxq+o7U5SsKfVEqKnzfpOb8pdNPuuuk1vChPSAob3rArtlt97UkcKzAWjLF+SA7QCTo/4ACgf+b0+/lrbS9unKcwoPgA6ZVOjlzMsCfNptm27eVHduhgu1QYSDw27QD1DfAsvXBlOXQVLP2iL9rg5pCeIzD/fKh/Wb9h1cRqZROLMdHH8zsEEuTJN6uzWIVtSQa99fqQiuUuFJmaW2tg0+xU6RcNovrixdnAhpmQf1AAGAfYQUAkAKVbjjAJxAKryMWIEiMYYA7IJ3GroUZZjPoQA59eNf7j4BoR6AuAODlmi3oHPY2Fk89U0QmxCqHvJYGC5gH8KfAJTxMBX4QDOEQBbFggVTIgTxogW7oGx8HqAr7QhBoSLauFNp+q/Ex99xy3TVXXHLUIT+Mfz8+Mj48vhcQYAiNA0zKA0mBEKFhpRTZbwE9DEAJAxSaMZ8seCVgiYQb5zSnP3CjKCjcU+gp9Z3EKyvIFIsnTcjM+EDrFCcOkIXma2VFBUYnN5lvuspmdpX7i4PMFbZYW/Id+ZvHyLBXDVdO3xHQXjM0MrWKekNDt4Wf6azUExbrNYJQP43wKeQllFy0bZuJyPbz8b3b9ZweMB88gkpFIObiTB4JdqlxDF03qnGggBhMeFKzuXIBgyHFQEoo++9hZEXa4KUgCCQ0HMWbRIp6kOHIR5fXyo6yGem8aKMY50QtE6zUtjt5SKENSuJFwe5+CWNFHLXw/v2/st2cUQFN/8QbL/vqoU4/yqVf7CYnogRb7M/nV4West7eXrxRpkoXHfUIh1vTUKlx+sb/8VNhcN+nCadRyAdmcAmjMXo4HGKeG5YTMbp6miDP5uGlPrW59O3axLaZo9ilwMK9i8LBkfLmp9haTLTPMrHvzmp7ndyY/EjNJTyFjlWY/v+8RhxS0xf1bpcBJ/KGgj+QqFJYsNSgcYzI0OWV6UXQHIyRLsetnShngmHQNQPY7VsuSUc6YHesyc3d6dNTgeJ54x7zqkRhaPeCllNI8ZQehAXMDa9UQLcL+O+cpeZK6uBk4e3VtNRs7r7L1Lwyf9X1q2AN0Yt5KfBQOupTRPx1/4Nh8r1X5chxMFoTonWMasgJTal59M7kaHxR9ifNkspzIdj9GbBop54UvIwnT4Ez8PfRyXiWO/q2vKrJvtytWjeS8t+j8wMzUCa6+IvA6fKxwEOYMKkJ0e06HU+z2YZJ0oWxMgezap2iDGiHoOdxVbAGRvgBO75TN1xd0dN8r7Mvnos2xEHPKGpw56h0QgFaCwhh34IQI5tsp2gZAmX6kF03g0e2hDMFlUfmCnYHq15tJqL5hY3K4lVhkMJlQFdKikvI/YV4mvV7B6kL2CCqC9zHV+9XaKD0YOGazQ3Ti/PuRHC9NhBtWRN6zXB1y9Bb+awYLgKqxlNlM9jPnk4yIaJWXd3KT48rE9WMkiRYbiigFa8BKCV4Bxol7xbK30czTL+eXzxZW6LTuupgIlYZpIr0vAJ0m0Dnpwwu1jGqhXbIKbRt4gQZzyTlaCBWi1Rcvw+xru1aUYKVzvpHosPxVZgwGXSmnZ+E/PRT7LfvyXPJOGciykEAVkFRdsLtmJd8OdNR58600BQ3/qbXqhZjNf4DYe3cRYrT9a02mXQEhGEedJn0dw3yJEcJ6VLGDKln4C2kAceYUDzrYAGllGhPsEadvL2SJdu2PV6SYi6fidrqViayEQ9NJLgLBTrKVA2CgAU7tnguSua6icX+JnZLWvzqtyHrQ8im+mJtMBE+8Z+JO8GxMTWfU2/dB1ilnLEJqOn/KwSUF12SOLPS5EiLB/neY3ofzTvnapPraH2/KhL9xY8idhksPF/WbPZ4eaA9Tj2bh6eTEvCckZETYWuYvDNgkL/cHeZ0G63K2J/XP+pXlkSsD8sFfEsGsx1lFmwDe1dYLfB4Gs+EH3cLhR5pJT0k6dnVkE8fkhtK/HUupeYZSllOvrm5q89n273i4EAAJnDwFfIY7G63oBoeXz6/vvAneYBdyJ9U0+o4Kbu1z+kfM0pGcDEu2NljIGrT6b9jo05Je03Eedrm5LkcV4gqBcp0iDT55+FGzENAao5w39/0W4gKivvR+NdjlFRqO5Vjt7Cg7llqXgwpw16idI32O6di9aEvNne27uG3QZ4rtNJFXQZOYfjyJTttiX98pGtedd9TssJY5aJBVkZCJ0akRdTeEiMG2WkcN5Y5eS5BV6K1IoMT5CSX7s4UbE7j8+cN6maQmgRn1GScJ6QTp5QMgM9THSuOnplP9VXvbRDZZ1rEOu0dhc2DjWQu0Vc3GdxWnpTAD06A0sZWvMdA/5ZKLvqEH764CKEyCxTtcQYzF5pGfav7vv25W8D4ElJjsYMt7VdrItGrlRUnaZc7nGybl2kVE8cXfTVjUNyOD5bpBgJSk5ucqaLVUwZZWeHjm3SdPPDs+EdMW69zkkSjdHyeUqrprXDVcMkrbOyR4dsrDDi9Sr0eb87ENMF08414GstuPJDb00vMMyVJkgd8fbZ8LBxbo+ZJ+uPODeVLyl3U1FPKHGdya3I2q6dl7s2o1bYkm51WzSYPiUNi86dOlpdprcMgSxs3xJMHkAPJIHh1ySlJ+YwPSv0LlS3p+cX/H4oZFBX/k0gRgFa8ZpPTDt4Ph5/61cpTPLg7P7I2s73jTnOgxUp+Wny5EKxmVxMDTC32W86qEVHswgKNn/DMBLsSbIRsuB5DAaS5xb7hdtp7fyv3KzPI/WIGtND4rFp6esAhFRLlEvlLyGAgpFZ7ySTcsFNl6E/VJCFgQA3yJlZFbuEQTdnlqpDpVGwyiG+X/QI4DL6nJ7+NzTJtnP4DdU6qvhNhFTYZhD58ioxE16ss/fX0mJyh5D066kGe3PCUIgVDU7dJB+tipTqp1u16gfaW0nYymZ/hRg3WSoppSb65uXnfy+VGeRLsBd6JIjTjIIDGlhk2VlLkudI8cOdJ53RZ6uJ4Q6NRuM/gotRP88GVct/H7lXRojYIX9r4Aj5XMN/KPAgAXb4eX17/I5731fCrI285K/+tD0VYzM0Q2fGR2+LHU2u/VN8jRTEHm2X7na+/ns70wQ4VNOy5hlpuptTxAQchgODcK86KnXo6D+Puz49wSGdH+NNWOkqQ/9ZMnmPrM7FDHs6oY524uLwDXxdFuHFoS93Lf+z/EG22/DVDDJcPy0DIiJFtL7pEQWNMgk+KUwZ5GQy26ltC1ysfkfdj0kuVpA2vx3uiHsX6qJynHlHHCmA3NMGXzdpoHBx+vjlXFaPXuiwKjxhdFHtPrpoe9EudWWKiRVtimoewvsfnSJONvtExufv7q786OFYg1Lfo7MzjucMEy7r1mWi1bbnaf9fjcYQzg2u1mtjUV0WI4IRWOpNuZMT186+ncdyfNtsMLuUlDFwWHh8do/0Xw78xbfc4FTABg++wWT1RHeZ0OtESQrJYLgF94S8Grw/hf13jUEN8JO+SuQaO+TDODxb227nlbV3ZPl7cZIcr6RtKz9O7gGsurVtQgHNI38T1jLHWsMwkrSRvN2UFwkqLIW8wnDwmC7MZyomM9YKj87qE7sFu1H8cPBIz0dasE+ZOXyxgdpFta78KJEazYbUH4+qJ2Z8Fw6zYz35OuR9MdYlDhWG5+c+yMkkMxSLMrcF8YMZB3ohS6LK5aT+LvoM6n66IHZSVyBPRm0I/bBhHQJ0K/8ZgeRcyXxBXF4nESMgP1Ss6ciOWLVGXi2MsBZ3Kbr/xnDFn1iTKYH927rvz7nKgY5WCoFz/9u44VfvkbVnrTvMF8Br4gtv7JRz6etry6wxVYpoya7Yyz20Bx2LWz8SveF6RDhyg6E9xHohJmeWJTPyC6P/9on3t+vJDhWNVMwaldp/+48b7guXbwOgkTUG9Fb95D2WwSksPSWasboTp1pg1JpZ+9m3kwyDKfXP0+h7lmCo3cMFXGypp3rbUO6apE+M/QYVOpUFThK/oRe89dVHf9vgZ1z2BkZJDaergma+WXdo4M34hVKV5s8Q+zk55/7PFT6TZvRHIhbmvjImxebQGLmcSXp3cS2OL/kZGNOqBQfHAlTvd9FpyxAPvi5/MNHjtpa/scWrNa1w2q0GEpMgLhcmz9Lrw77xCypR/Z+XJY+5T0MWpm6rK9jNcrOq7MmPREQM/IcejZle8nF6x8IJgSrMtPpssvXhy+a4RdFHisyH+/zfGj2lj+V+KFHyEs49KnVXn4RlOkiHmBeWzipVPMsVWXZpi9/GMH6PjqCXX96U6by/mVJaZypdbD/i8HbZJdZKXbaXUWLpYXO5s/WzCJ5cuBtv/nP3oC0HpB7RqMMfnrd9Gm5dENkyCvghL4e+l8yJYNGO2cWUDfe3jsYWOl6YxmP7f0Qfp4tOOtVZnBhc7nZhvMm0f3PPRg6yiZ8SzdRELq0Xd/iEv6BGIvwyJFWU3BGaZgCPMHpFIgtZhSr8Fc3Zv4a1h8x8L0dVQbvQnrhJ5AGjatUpTCZ9B4IE0yOzj8QrXjs4Z/SYk0CHyX/RY4V3D5Mlv17ksvzzyWJiO6XEMaeS4H67RgMYujnR/SP4U3NohiPPSWp8s6kziNJ8I+AxLQcfwKaPY0bOeZoasQ2Un7TQH5Q8ZOa4eW3huC1gbWcgQ+SGpk2r2+NN+mhHH5/xVQQ9Apl6MO/fArKXOE6HyBwPRpz5tZooZpaPtCTUqySyiJsDJ1sNXlkwoCGEVoixsFBdt5D93bmhjcKkkhQcyIs7XQoZBAq+C3abiFllIca1NHVXpLN1+DOFYfrMryuBSJle/DFHHPjk5i7J54XZYitdRWdgefWbUb/8ma9RFET0SqzZgUiCDLEV/LgliiTZwrJv/KXjqN9FNRBU23QxTHZ7PnLE26+OsqSBwrZpG4fXBGDWPC8wOfvCY9xIt2vbUW4es1F/9S7JN2txGn8nxvGur9rTaNGgy/vX9j2ckQdvga8OBReXzdCyifx5WgmyiGs2uKeH709yY5IEVKZ7t/REJ6XMnPdPHNzoaUTuWrtyyrRhSUrklGlsOZKBprR7js1QSXrz763K/JdmyErqOcMzF17bwiRamBY1ZaQGkWeHJQMv4Leta2JvYIkL3QEf8Rc+H8wwmtXw97jRd+R3/iCExzIHSCRHtBMiiZr60j3xvPoKU25SOOo+8sydqespGPdKk1mTOL9j+6Y8ff4vlBkZ456hzvyv5egduw3zD3qVVzt+f3PNxaO/APvX8Hte/M6M0IDM4n85FGsLMIluIx3t5tu94ayRkcZV8A5Yrj+U4kgSB7CoiASewhhnbGTZiBv8NEclgfwR5hqdF0KPs1s4l1itC9we26tplGXX24eJNsOTzzvXJlca1D/RO3p/WXc/Ilfgjf9M3gZXKAQsvgy6oXR59+vZkrWNi+PrwzspX/fxtmG8cWu3EnuVdHmfQzsmr8pe4qAXX0BSHBe+hh1tpYUMFwy00kEV+w3SV/MeR1N0WLGG6PSR48934HzEMchx/pqNlkgLLcs9gmzK65cMlqeF2VJnkZw2mSpClQUdF7/N+aOLCa2OWYLh35AuxKHF4iSMNeAebPp8lLfX5Q3dMUdWUcGwU3/drTPimP1sfdV5uSMXLAjY+j1/bKOxxdhwn4v98WnG+QWQt83z3GohtdCpjdl86W78BY45kaRQjjjCwtexXyF7URZlWSxHei6QM+yrOtFn0+K8fZrmmBMl4ZBPpxa5Xe6apdYClYCH5bq46q8ffEXRizzL//aTtrfhYbGpYUvKhYxztiZu7XpGZUOWWVJzrWoVfKDYH0vLyEyNl4b8qSa0CUUxdZ5EeH5LiwYNBQ/SybyivaMP6z4/+Js/HbZpkL5+Jf/k090kkP8+hzWKoUALbX+f67ItMJ5cbVSgS0qm+LYWS6SpPfn/sMIlKZSSrmCXaNy4q8hO9aE7VFUyqGPFOUlCEatvpjY7/c5yMsbrcyvw09R9Hbdy53NqjJxaL8i8tmRAATySu9ZK13jLnLgbBiHabzqLfTlMMvJw/y69PIkyE1NtlMuF3xsEXShySBWTKhBhuZzIrLlSTMj/WwozLzjuUHpUEJIP93eiXpgcfJBvj4pK3VX0ruKWWG8Slnh+vxPkPNMP6OWoznUlzj64xBXzKX0Dmdt8O/EMoMkcVNa7QOUPsv9/51Ycn13DYV1nSQeGKcDVO44SEabAUIV6MOVOtTjGs2W0w/utdZlBMYgMlIrs6e6qkUoVF7Fmwxq3A30ssyGMxvC9bZGYmLxE4gZN+RraBTdk7QwvyYwS1zG4p5vcpn9po+dOVbqMX0F3c//Q+ck7S2HwpiKEMQViIX51hI3BA5WWTsrqN7xfsmCo1r6D7cxKGM1OCFIHuAz9lfiPlzi3goLoci+f+j32ec8M4JVzLDu7L+8vDQq46STP+Lgr1O+zwps35qjAdVn+2pwJhDIwq35Ax1XRsW1jQtyxmtbvBX0R8pvlSjenr6cWqXkvb2pe1Swm95rfNbAFZjZPmlwc7bBPLIJH5UwCfDGg3uQ8UXJhm4hpuYnXBkLKHxTpJB4oV1Ct18+Qw8SQmB00U1yIrJ8a/ZnQNp++YWHYMST7IhBZ5aeCj3kcFfl8/E0eVOlTxab3Xdy+0jjIKUf5P7iu82d0Hc8abdnwUNAWroLTZxh7BqgyhSYXCUv8dwm4n5LPqMC0Y7V6Gj2kb7erV2JNYKXsARDx9VESWKDi9dZ3xe89k1iJ3Ao/BCRo/8aH8UF0AxUSdkF+THnnTfHWUz9hQ11+/zyMpV5iJH0Auf8lrSKazsKpaqC/x3mVJKmOA25yGOv/av7rfbF6aYF2QcCzMvDOhcarbM0eLhuFf+2NyekDjw331Ab550uRoM4t7cJlneE5woDR61rKTs5W8b3cRRa7eoGU+PCEycehDnR4ayzv2tP+aJihvZoWvolHYPAW9LrZycFnk3paWm3k/CHySmFsYUOWCskoo49DEiJ7sFLd41xMuhsRTNxZsGnJNJigFqFj19xZpY8zHcsLDcFmI7Sm3I9z5xnmGRnfly9yED90nBOTVS3+wrvuYw/172vXVoDeJrnhFh/7tvnGvjiUNHArrClqdZnB4pMSYyy+6ko36RNGrEnU2gSnwR9phY5dFkjWXyHw40vnm2uW5L+4NZ2I0Jju5pC1VdOmhoFUxbRps+Q5luqfkJeppcsp9b/mt+4kxogK2pkpYjVbWSDcGe6H8KvQM097cq7+waTvMLHth5u/l97PMbG9p4m4X7UPqouaJbVg/x9RdOyWJ1ineNXrhTqbOPjkqzdYqn8a6UOx18UsvRE9kAKxz1kWf2UnHafYNXMUrNRZYSaU2BTyJYZFEoSZqcZ/F+w7++7WEi6haKGXmcsjg5yKlduY1rPXDYDZOw9ResSF+z8tfsyTWZ4eVs/tXRRA4yHYqH1b8xrz8Xo+nuNRJPE/ufKx6V9J0bZ+vnVygPODPIwOSZ+lspkkrLf8aNgu+RosEB7WC4W8M7vxHTpZTZWqdB0g9STZfH6avtl+df1dJFRJNdLpO6CSlX9PqlcVYo1EYybhRe0T4jeS0aPMvhoIdFofAgTJ1dm5B+weWYKPZKA891+lwNlqW43LWpdC1VH7ABA83VAJzmQ9br72cww6nO5tWRHR8UiH8Y5k8tsrA4tWQrk3N5ut2+2XN96OV7MkiEW8RSuF4LMjQfvpl3O1qtIyPGzTM0mJnvs3mlNo9lswYJTS/6ACpf7+t3fxcXFbKi3/GYOF/AOo36xtPJdf4ef1/G8Yr3r2m/UWbCgAMwBiJnz5thLpCM14kTvEYHohMAOgpBe7Jt1kDTJQFArQCREgIBmwPaBBvHHYGidhWQNgMYGEu4ASPQY/5gAeWDxzMDhSuHj89Ahh47Pgf7YdCjPu5b0GKngOFxQCGqUCIfhv/uWfARf+BM9wCAlnGF6Dfx59Eh1SsFwLQJZBh/iBF/4IT2lXs7QlcLGL8wqLBB2MBHyubLsSDZOv9gXAXSGA+h1T6QNWADkWGIRpVGGfBaBABG0aCGHBhcxCHPLAFaSCF2CABHuAG0gEoA7XQBtXD4Q0QBFng0KQTZREaJw7SPrwZmkAOmlDUQnDCs5YmDAohA8xgprfGURYTx2VxEKrEPuJ0IRWiCn6beNbwRGiGFugdR61fqwY6QA6+UAF+iaihDVSzcuh1KKSh01FVyIDuLcuZt7C5I0OnR2UVpSHYMz00hNnypebax+BIiANdDpWkHhwQjQAAAAA=); } </style></defs><rect x="0" y="0" width="1081.6370313640625" height="772.25" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(14.490141898123547 38.5) rotate(0 50 67)"><path d="M0 0 C25.66 0.7, 51.37 1.35, 100 0 M0 0 C24.31 -0.36, 48.98 -0.01, 100 0 M100 0 C100.25 29.92, 99.83 56.31, 100 134 M100 0 C101.85 34.28, 101.22 68.56, 100 134 M100 134 C79.06 133.86, 56.21 136.15, 0 134 M100 134 C65.44 132.33, 31.25 132.83, 0 134 M0 134 C0.3 88.25, -0.78 48.12, 0 0 M0 134 C-1.61 98.19, -2.28 60.29, 0 0" stroke="#000000" stroke-width="1" fill="none"></path></g><g stroke-linecap="round"><g transform="translate(13.490141898123547 83.5) rotate(0 50.5 0.5)"><path d="M-1.04 0.59 C15.95 0.49, 84.78 -0.22, 101.69 -0.11 M0.61 -0.14 C17.53 -0.18, 84.66 0.37, 101.11 0.84" stroke="#000000" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(14.990141898123547 128) rotate(0 50.5 0.5)"><path d="M0.39 0.38 C17.24 0.29, 84.83 0.36, 101.56 0.38 M-0.87 -0.47 C15.83 -0.48, 84.11 1.26, 100.91 1.59" stroke="#000000" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(236.74014189812357 76) rotate(0 59 47)"><path d="M0 0 C38.66 0.54, 74.91 -1.33, 118 0 M0 0 C39.08 -1.01, 79 -1.36, 118 0 M118 0 C118.44 24.68, 117.96 48.68, 118 94 M118 0 C117.52 19.38, 118.21 40.02, 118 94 M118 94 C75.19 94.43, 34.15 92.27, 0 94 M118 94 C77.82 94.84, 36.63 93.55, 0 94 M0 94 C-0.41 67.76, 0.15 44.89, 0 0 M0 94 C-1.14 63.88, 0.01 33.28, 0 0" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(307.74014189812357 77) rotate(0 22.649986267089844 12.5)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Heap</text></g><g transform="translate(31.740141898123547 10) rotate(0 28.91998291015625 12.5)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Stack</text></g><g stroke-linecap="round" transform="translate(246.74014189812357 131) rotate(0 27.5 15)"><path d="M0 0 C13.07 -0.5, 24.09 -0.47, 55 0 M0 0 C20.86 0, 40.47 -0.2, 55 0 M55 0 C54.71 11.37, 53.62 22.77, 55 30 M55 0 C55.08 7.66, 54.81 15.23, 55 30 M55 30 C33.78 28.33, 16.56 30.71, 0 30 M55 30 C32.6 31.02, 12.05 30.79, 0 30 M0 30 C-1.55 19.6, 1.06 11.72, 0 0 M0 30 C-0.39 19.09, 1.08 8.35, 0 0" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(425.48199552483726 66.08986759809187) rotate(0 60.999977111816406 12.5)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">0: new #2</text></g><g transform="translate(390.7271973769546 101.93924394222455) rotate(0 244.56980895996094 37.5)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">The `new` instruction opens a space in the heap </text><text x="0" y="42.62" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">and a (ref) reference returned will be pushed </text><text x="0" y="67.62" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">onto the top of the stack.</text></g><g transform="translate(49.740141898123575 49) rotate(0 15.269989013671875 12.5)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">ref</text></g><g stroke-linecap="round"><g transform="translate(92.74014189812357 68.11313063217625) rotate(0 82.39279176369308 37.4946599132646)"><path d="M-0.89 0.14 C26.71 12.72, 136.76 63.71, 164.57 76.09 M0.85 -0.83 C28.35 11.39, 136.01 61.83, 163.51 74.55" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(92.74014189812357 68.11313063217625) rotate(0 82.39279176369308 37.4946599132646)"><path d="M138.6 72.39 C144.3 72.68, 151.34 75.49, 163.51 74.55 M138.6 72.39 C145.59 72.46, 151.07 72.86, 163.51 74.55" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(92.74014189812357 68.11313063217625) rotate(0 82.39279176369308 37.4946599132646)"><path d="M145.82 56.88 C150.02 60.52, 155.49 66.71, 163.51 74.55 M145.82 56.88 C150.92 60.89, 154.56 65.24, 163.51 74.55" stroke="#000000" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(11.115141898123547 221.25) rotate(0 50 67)"><path d="M0 0 C29.44 -0.7, 55.63 -0.91, 100 0 M0 0 C36.16 0.91, 72.68 1.15, 100 0 M100 0 C97.91 46.56, 99.03 90.25, 100 134 M100 0 C100.41 37.51, 99.77 72.39, 100 134 M100 134 C67.63 134.86, 33.94 131.36, 0 134 M100 134 C77.67 134.39, 57.98 134.63, 0 134 M0 134 C2.75 104.98, 2.63 78.39, 0 0 M0 134 C-1.83 83.55, 0.09 33.35, 0 0" stroke="#000000" stroke-width="1" fill="none"></path></g><g stroke-linecap="round"><g transform="translate(10.115141898123547 266.25) rotate(0 50.5 0.5)"><path d="M0.88 -0.71 C17.85 -0.59, 84 -0.18, 100.81 0.16 M-0.12 1.53 C16.77 1.83, 82.84 1.65, 99.77 1.26" stroke="#000000" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(11.615141898123547 310.75) rotate(0 50.5 0.5)"><path d="M-0.71 -0.19 C16.08 -0.04, 83.15 1.77, 100.16 1.78 M1.11 -1.33 C18.33 -1.6, 85.82 -0.26, 102.43 0.07" stroke="#000000" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(233.36514189812357 258.75) rotate(0 59 47)"><path d="M0 0 C42.67 1.49, 88.71 -1.62, 118 0 M0 0 C31.27 0.9, 61.87 -0.44, 118 0 M118 0 C116.3 18.86, 118.41 37.34, 118 94 M118 0 C117.98 31.1, 118.45 60.79, 118 94 M118 94 C80.55 91.6, 48.08 93.72, 0 94 M118 94 C92.77 94.22, 65.9 94.37, 0 94 M0 94 C-0.01 59.36, 2.06 21.49, 0 0 M0 94 C0.08 75.51, 0.38 55.61, 0 0" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(304.36514189812357 259.75) rotate(0 22.649986267089844 12.5)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Heap</text></g><g transform="translate(28.365141898123547 192.75) rotate(0 28.91998291015625 12.5)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Stack</text></g><g stroke-linecap="round" transform="translate(243.36514189812357 313.75) rotate(0 27.5 15)"><path d="M0 0 C10.84 -0.9, 25.31 -0.94, 55 0 M0 0 C16.97 -0.85, 35.99 -0.29, 55 0 M55 0 C53.47 6.68, 56.7 11.52, 55 30 M55 0 C54.14 6.46, 55.97 12.28, 55 30 M55 30 C43.64 28.78, 31.78 32.41, 0 30 M55 30 C35.4 30.41, 16.62 30.35, 0 30 M0 30 C-0.46 20.24, -0.55 16.21, 0 0 M0 30 C0.03 21.98, 0.66 12.97, 0 0" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(46.365141898123575 231.75) rotate(0 15.269989013671875 12.5)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">ref</text></g><g stroke-linecap="round"><g transform="translate(89.36514189812357 250.8631306321763) rotate(0 82.39279176369308 37.4946599132646)"><path d="M-0.45 0.01 C26.88 12.74, 136.69 62.83, 164.32 75.29 M1.52 -1.03 C28.62 11.41, 135.91 60.48, 163.13 73.32" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(89.36514189812357 250.8631306321763) rotate(0 82.39279176369308 37.4946599132646)"><path d="M138.22 71.2 C146.41 71.22, 155.08 73.57, 163.13 73.32 M138.22 71.2 C145.51 71.66, 151.38 72.37, 163.13 73.32" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(89.36514189812357 250.8631306321763) rotate(0 82.39279176369308 37.4946599132646)"><path d="M145.41 55.69 C151.09 60.78, 157.4 68.23, 163.13 73.32 M145.41 55.69 C150.52 60.48, 154.35 65.6, 163.13 73.32" stroke="#000000" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(433.1110687114803 250) rotate(0 31.09998321533203 12.5)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">3: dup</text></g><g transform="translate(393.14524620608216 289.2974478460208) rotate(0 298.8397216796875 25)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">The `dup` instruction duplicates the top-of-stack reference</text><text x="0" y="42.62" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">and pushes onto the top of the stack</text></g><g transform="translate(45.240141898123575 276.5) rotate(0 15.269989013671875 12.5)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">ref</text></g><g stroke-linecap="round"><g transform="translate(81.74014189812357 292) rotate(0 87.5 22)"><path d="M0.79 1.12 C30.02 8.49, 145.53 36.27, 174.71 43.52 M-0.26 0.67 C28.85 8.25, 144.31 37.82, 173.62 44.81" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(81.74014189812357 292) rotate(0 87.5 22)"><path d="M148.75 47.44 C156.66 46.16, 160.01 47.45, 173.62 44.81 M148.75 47.44 C156.56 46.86, 166.93 46.31, 173.62 44.81" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(81.74014189812357 292) rotate(0 87.5 22)"><path d="M152.88 30.84 C159.7 33.61, 162.05 38.92, 173.62 44.81 M152.88 30.84 C159.34 36.09, 168.26 41.38, 173.62 44.81" stroke="#000000" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(12.115141898123547 411.25) rotate(0 50 67)"><path d="M0 0 C19.69 1.07, 41.15 -0.13, 100 0 M0 0 C21.49 0.15, 42.58 -0.64, 100 0 M100 0 C100.48 53.16, 99.2 103.32, 100 134 M100 0 C101.39 46.8, 101.78 92.67, 100 134 M100 134 C66.76 133, 32.53 133.77, 0 134 M100 134 C67.78 134.08, 37 132.29, 0 134 M0 134 C1.53 90.27, 0.18 45.61, 0 0 M0 134 C-1.97 100.65, -0.29 66.6, 0 0" stroke="#000000" stroke-width="1" fill="none"></path></g><g stroke-linecap="round"><g transform="translate(11.115141898123547 456.25) rotate(0 50.5 0.5)"><path d="M-0.49 0.94 C16.4 1.04, 84.35 1.01, 101.08 1.22 M1.45 0.39 C18.21 0.05, 83.39 -0.8, 100.18 -0.79" stroke="#000000" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(12.615141898123547 500.75) rotate(0 50.5 0.5)"><path d="M0.94 0.08 C17.71 0.15, 84.34 -0.33, 101.22 -0.1 M-0.02 -0.92 C16.56 -0.7, 83.37 0.81, 100.38 0.86" stroke="#000000" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(234.36514189812357 448.75) rotate(0 59 47)"><path d="M0 0 C30.93 -1.92, 63.12 0.7, 118 0 M0 0 C42.96 -0.18, 87.17 -0.8, 118 0 M118 0 C116.75 26.54, 120.01 50.16, 118 94 M118 0 C118.85 31.12, 118.03 61.86, 118 94 M118 94 C74.04 95.33, 32.57 93.16, 0 94 M118 94 C87.18 94.96, 57.79 94.75, 0 94 M0 94 C0.48 58.73, 1.28 23.94, 0 0 M0 94 C-0.24 73.85, 0.19 53.27, 0 0" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(305.36514189812357 449.75) rotate(0 22.649986267089844 12.5)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Heap</text></g><g transform="translate(29.365141898123547 382.75) rotate(0 28.91998291015625 12.5)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Stack</text></g><g stroke-linecap="round" transform="translate(244.36514189812357 503.75) rotate(0 27.5 15)"><path d="M0 0 C18.28 0.78, 36.09 1.31, 55 0 M0 0 C15.43 -0.69, 30.64 -1.33, 55 0 M55 0 C54.01 7.15, 56.34 14.56, 55 30 M55 0 C55.66 10.51, 54.37 20.52, 55 30 M55 30 C38.77 29.36, 28.15 31.33, 0 30 M55 30 C43.04 30.56, 31.3 29.88, 0 30 M0 30 C-1.28 17.98, 1.03 10.96, 0 0 M0 30 C0.16 20.09, 0.38 10.71, 0 0" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(47.365141898123575 421.75) rotate(0 15.269989013671875 12.5)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">ref</text></g><g stroke-linecap="round"><g transform="translate(90.36514189812357 440.8631306321763) rotate(0 82.39279176369308 37.4946599132646)"><path d="M0.79 0.65 C28.24 13.02, 138.38 62.15, 165.9 74.69 M-0.25 -0.05 C27.04 12.46, 137.87 63.73, 165.53 76.07" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(90.36514189812357 440.8631306321763) rotate(0 82.39279176369308 37.4946599132646)"><path d="M140.61 74.11 C151.65 76.58, 160.01 77.34, 165.53 76.07 M140.61 74.11 C150.35 74.01, 158.58 76.1, 165.53 76.07" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(90.36514189812357 440.8631306321763) rotate(0 82.39279176369308 37.4946599132646)"><path d="M147.7 58.55 C155.97 67.28, 161.5 74.25, 165.53 76.07 M147.7 58.55 C154.81 64.28, 160.38 72.23, 165.53 76.07" stroke="#000000" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(419.6149755175017 430.81225042906715) rotate(0 94.59992218017578 12.5)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">4: invokespecial #3</text></g><g transform="translate(387.0312628834218 465.7106415908338) rotate(0 317.7896728515625 37.5)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">The `invokespecial` instruction pops the top-of-stack reference </text><text x="0" y="42.62" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">and the just-allocated space will be initialized </text><text x="0" y="67.62" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">through invoking constructor</text></g><g stroke-linecap="round" transform="translate(18.115141898123547 628.25) rotate(0 50 67)"><path d="M0 0 C27.21 -2.16, 56.06 -0.53, 100 0 M0 0 C25.49 1.09, 50.43 -0.09, 100 0 M100 0 C101.25 34.81, 101.43 67.17, 100 134 M100 0 C99.98 48.89, 100.22 100.35, 100 134 M100 134 C64.98 132.82, 31.63 132.48, 0 134 M100 134 C78.36 135.42, 58.06 134.6, 0 134 M0 134 C-0.85 88.88, 0.92 45.52, 0 0 M0 134 C0.5 81.08, 1.13 28.5, 0 0" stroke="#000000" stroke-width="1" fill="none"></path></g><g stroke-linecap="round"><g transform="translate(17.115141898123547 673.25) rotate(0 50.5 0.5)"><path d="M-0.72 -0.7 C15.86 -0.68, 83.7 1.05, 100.55 1.27 M1.11 1.55 C17.4 1.69, 83 -0.74, 99.37 -0.7" stroke="#000000" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(18.615141898123547 717.75) rotate(0 50.5 0.5)"><path d="M-0.7 -0.45 C15.98 -0.26, 84.39 0.22, 101.27 0.42 M1.14 -1.73 C17.58 -1.32, 84.05 1.03, 100.47 1.65" stroke="#000000" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(240.36514189812357 665.75) rotate(0 59 47)"><path d="M0 0 C28.82 -0.53, 56.11 0.05, 118 0 M0 0 C39.17 -0.63, 79.53 0.51, 118 0 M118 0 C117.68 31.64, 118.62 60.76, 118 94 M118 0 C118.17 27.15, 117.38 53.6, 118 94 M118 94 C81.3 93.08, 48.76 96.11, 0 94 M118 94 C90.15 94.37, 62.42 93.61, 0 94 M0 94 C0.76 71.07, -0.58 44.86, 0 0 M0 94 C0.1 67.58, 0.86 39.02, 0 0" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(311.36514189812357 666.75) rotate(0 22.649986267089844 12.5)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Heap</text></g><g transform="translate(35.36514189812355 599.75) rotate(0 28.91998291015625 12.5)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Stack</text></g><g stroke-linecap="round" transform="translate(250.36514189812357 720.75) rotate(0 27.5 15)"><path d="M0 0 C17.37 0.86, 37.31 0.44, 55 0 M0 0 C15.61 -0.12, 30.33 -0.03, 55 0 M55 0 C55.53 7.58, 53.57 15.97, 55 30 M55 0 C55.43 11.77, 54.42 24.38, 55 30 M55 30 C44.69 28.87, 33.53 30.24, 0 30 M55 30 C38.16 29.69, 21.87 30.57, 0 30 M0 30 C0.17 20.13, -0.72 11.72, 0 0 M0 30 C-0.63 22.11, -0.38 13.21, 0 0" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(97.36514189812357 582.75) rotate(0 15.269989013671875 12.5)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">ref</text></g><g stroke-linecap="round"><g transform="translate(127.65758538749535 601.4438513166059) rotate(0 63.746570019007194 60.704299571049816)"><path d="M0.41 1.07 C21.75 21.29, 106.57 100.89, 127.65 121.07 M-0.83 0.59 C20.4 21.01, 105.67 102.5, 126.79 122.43" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(127.65758538749535 601.4438513166059) rotate(0 63.746570019007194 60.704299571049816)"><path d="M103.87 112.44 C111.81 115.32, 115.62 116.8, 126.79 122.43 M103.87 112.44 C112.66 116.31, 120.14 120.32, 126.79 122.43" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(127.65758538749535 601.4438513166059) rotate(0 63.746570019007194 60.704299571049816)"><path d="M115.66 100.05 C120.4 106.3, 121.04 111.12, 126.79 122.43 M115.66 100.05 C120.26 108.42, 123.49 116.91, 126.79 122.43" stroke="#000000" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(428.2009363095722 633.4493379904595) rotate(0 56.8299560546875 12.5)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">7: astore_1</text></g><g transform="translate(389.6775587078126 675.0892343538062) rotate(0 340.979736328125 25)"><text x="0" y="17.619999999999997" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">The top-of-stack reference is popped and assigned to </text><text x="0" y="42.62" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">the element (`newTest`) at the position 1 of the LocalVariableTable</text></g><g transform="translate(234.74014189812357 570) rotate(0 78.76631927490234 42.39130434782609)"><text x="0" y="14.938695652173916" font-family="Virgil, Segoe UI Emoji" font-size="16.956521739130437px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">LocalVariableTable</text><text x="0" y="36.134347826086966" font-family="Virgil, Segoe UI Emoji" font-size="16.956521739130437px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">0 args</text><text x="0" y="57.33000000000001" font-family="Virgil, Segoe UI Emoji" font-size="16.956521739130437px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">1 newTest</text><text x="0" y="78.52565217391306" font-family="Virgil, Segoe UI Emoji" font-size="16.956521739130437px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic"></text></g><g stroke-linecap="round"><g transform="translate(230.60415477559212 622.0730316488514) rotate(0 -54.1325581609058 -16.281023290192607)"><path d="M0.67 -0.55 C-17.37 -6.08, -88.99 -27.43, -107.21 -32.79 M-0.43 1.77 C-18.63 -3.6, -89.41 -25.84, -107.61 -31.38" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(230.60415477559212 622.0730316488514) rotate(0 -54.1325581609058 -16.281023290192607)"><path d="M-82.64 -32.6 C-93.2 -30.23, -102.3 -32.13, -107.61 -31.38 M-82.64 -32.6 C-90.05 -31.68, -96.14 -32.09, -107.61 -31.38" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(230.60415477559212 622.0730316488514) rotate(0 -54.1325581609058 -16.281023290192607)"><path d="M-87.7 -16.26 C-96.35 -20.23, -103.5 -28.44, -107.61 -31.38 M-87.7 -16.26 C-93.61 -20.09, -98.25 -25.2, -107.61 -31.38" stroke="#000000" stroke-width="1" fill="none"></path></g></g><mask></mask></svg></div><p><code>dup</code> æŒ‡ä»¤éœ€è¦å¤åˆ¶æ ˆé¡¶å…ƒç´ çš„åŸå› æ˜¯å› ä¸ºä¸‹ä¸€æ­¥çš„ <code>invokespecial</code> éœ€è¦æ‰§è¡Œé»˜è®¤æ„é€ å‡½æ•°ï¼Œè¿™å°†ä»æ ˆé¡¶å¼¹å‡ºä¸€ä¸ªå¼•ç”¨ã€‚å¦‚æœæ²¡æœ‰ <code>dup</code> æ¥å¤åˆ¶æ ˆé¡¶å…ƒç´ ï¼Œåœ¨æ‰§è¡Œ <code>invokespecial</code> åå°†å¯¼è‡´æ ˆä¸ºç©ºï¼Œä»è€Œå¯¼è‡´æ–°åˆ›å»ºçš„å¯¹è±¡ä¸¢å¤±ã€‚</p><p>è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆ <code>new</code> ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œã€‚å°½ç®¡åœ¨ Java ä»£ç ä¸­åªæœ‰ä¸€è¡Œï¼Œä½†åœ¨å­—èŠ‚ç å±‚é¢ï¼Œå®ƒè½¬åŒ–ä¸ºå››ä¸ªå…³é”®æŒ‡ä»¤æ“ä½œã€‚ç”±äºæŒ‡ä»¤é‡æ’ï¼Œ<code>new</code> ä¸­çš„ä¸‰ä¸ªæ­¥éª¤å¯ä»¥è¢«é‡æ–°æ’åºã€‚åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸Šè¿°å•ä¾‹æ¨¡å¼çš„é—®é¢˜ã€‚å› æ­¤ï¼Œæœ‰å¿…è¦åœ¨ <code>instance</code> å­—æ®µä¸Šæ·»åŠ  <code>volatile</code> ä»¥é˜²æ­¢é‡æ’ã€‚</p><h2 id="15-æ‡’æ±‰å•ä¾‹-åŒé‡æ£€æŸ¥é”å®šdcl"><a class="markdownIt-Anchor" href="#15-æ‡’æ±‰å•ä¾‹-åŒé‡æ£€æŸ¥é”å®šdcl"></a> 1.5. æ‡’æ±‰å•ä¾‹ - åŒé‡æ£€æŸ¥é”å®šï¼ˆDCLï¼‰</h2><p>åŒé‡æ£€æŸ¥é”å®šæ˜¯æœ€æ¨èçš„æ‡’æ±‰åˆå§‹åŒ–å•ä¾‹æ¨¡å¼ï¼Œç¡®ä¿äº†<span style="background:#fff88f">çº¿ç¨‹å®‰å…¨</span>ï¼Œå¹¶å®ç°äº†<span style="background:#fff88f">å»¶è¿ŸåŠ è½½</span>ã€‚å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1.5. æ‡’æ±‰å•ä¾‹ - åŒé‡æ£€æŸ¥é”å®šï¼ˆDCLï¼‰</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * ä¼˜ç‚¹ï¼š</span></span><br><span class="line"><span class="comment"> * 1. æ‡’æ±‰åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"> * 2. å¯ä»¥é€šè¿‡åŒé‡æ£€æŸ¥é”å®šï¼ˆDCLï¼‰ç¡®ä¿çº¿ç¨‹å®‰å…¨</span></span><br><span class="line"><span class="comment"> * 3. å¯ä»¥å‡å°‘é”å®šå¼€é”€</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ç¼ºç‚¹ï¼š</span></span><br><span class="line"><span class="comment"> * 1. æ›´å¤æ‚</span></span><br><span class="line"><span class="comment"> * 2. é¢å¯¹å¤§é‡åˆå§‹ `getInstance()` è¯·æ±‚æ—¶ï¼Œå¯èƒ½ä¼šå½±å“å…¶æ€§èƒ½</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * æœ€ä½³ä½¿ç”¨åœºæ™¯ï¼š</span></span><br><span class="line"><span class="comment"> * 1. å½“å•ä¾‹ç±»æŒæœ‰å¤§é‡èµ„æºæ—¶ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="comment"> * 2. å½“æˆ‘ä»¬å¸Œæœ›å»¶è¿Ÿåˆ›å»ºå•ä¾‹å®ä¾‹ç›´åˆ°çœŸæ­£éœ€è¦æ—¶ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="comment"> * 3. å½“æˆ‘ä»¬åŒæ—¶è€ƒè™‘æ€§èƒ½å’Œæ‡’æ±‰åˆå§‹åŒ–æ—¶ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="comment"> * 4. å½“å•ä¾‹ç±»å±äºè½»é‡çº§æˆ–æ€»æ˜¯éœ€è¢«ä½¿ç”¨æ—¶ï¼Œè¯¥åœºæ™¯å¯è€ƒè™‘å¯é¿å…ä½¿ç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LazySingletonDoubleCheck</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹ï¼šæ·»åŠ  volatile é˜²æ­¢é‡æ’åº</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> LazySingletonDoubleCheck instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šé™åˆ¶ç”¨æˆ·è‡ªå·±åˆ›å»ºå®ä¾‹ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazySingletonDoubleCheck</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®š</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LazySingletonDoubleCheck <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == instance) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LazySingletonDoubleCheck.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> == instance) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">LazySingletonDoubleCheck</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="151-å¯¹æ‡’æ±‰å•ä¾‹-åŒé‡æ£€æŸ¥é”å®šçš„åå°„æ”»å‡»"><a class="markdownIt-Anchor" href="#151-å¯¹æ‡’æ±‰å•ä¾‹-åŒé‡æ£€æŸ¥é”å®šçš„åå°„æ”»å‡»"></a> 1.5.1. å¯¹â€œæ‡’æ±‰å•ä¾‹ - åŒé‡æ£€æŸ¥é”å®šâ€çš„åå°„æ”»å‡»</h3><p>é€šå¸¸ï¼Œä¸ºäº†é¿å…åå°„æ”»å‡»ï¼Œæˆ‘ä»¬é€šå¸¸åœ¨ç§æœ‰æ„é€ å‡½æ•°ä¸­æ·»åŠ æ£€æŸ¥ï¼Œä»¥æŸ¥çœ‹ <code>instance</code> å­—æ®µæ˜¯å¦ä¸º nullã€‚å¦‚æœ <code>instance</code> ä¸ä¸º nullï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾è¿™ä¸ªå•ä¾‹ç±»å·²ç»åˆ›å»ºäº†å®ƒçš„å¯¹è±¡ï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ä»¥é˜²æ­¢åå°„æ”»å‡»ã€‚</p><p>ç„¶è€Œï¼Œå®ƒå®¹æ˜“å—åˆ°åå°„æ”»å‡»ï¼Œè¿™å¯èƒ½ç ´åé¢„æœŸçš„å•ä¾‹è¡Œä¸ºã€‚æˆ‘ä»¬æ¥çœ‹ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š</p><ul><li>æƒ…å†µ 1 (âˆš)ï¼šå¦‚æœæˆ‘ä»¬å…ˆè°ƒç”¨ <code>getInstance()</code> ç„¶åè°ƒç”¨ <code>constructor.newInstance()</code>ï¼Œå°†æŠ›å‡ºé”™è¯¯ä»¥é˜²æ­¢åå°„æ”»å‡»ã€‚</li><li>æƒ…å†µ 2 (Ã—)ï¼šå¦‚æœæˆ‘ä»¬å…ˆè°ƒç”¨ <code>constructor.newInstance()</code> ç„¶åè°ƒç”¨ <code>getInstance()</code>ï¼Œæˆ‘ä»¬å°†è·å¾—ä¸¤ä¸ªä¸åŒçš„å®ä¾‹ï¼Œå¯¼è‡´å•ä¾‹æ¨¡å¼ç ´è£‚ã€‚</li></ul><p>å› æ­¤ï¼Œæ‡’æ±‰å•ä¾‹æ— æ³•åœ¨æ‰€æœ‰æƒ…å†µä¸‹é˜²æ­¢åå°„æ”»å‡»ã€‚å…·ä½“åŸå› å¦‚ä¸‹ï¼š</p><ol><li>åå°„å…è®¸è®¿é—®ç§æœ‰æ„é€ å‡½æ•°ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨åå°„æœºåˆ¶ç»•è¿‡ç§æœ‰æ„é€ å‡½æ•°ï¼Œåˆ›å»ºå•ä¾‹ç±»çš„æ–°å®ä¾‹ã€‚</li><li>å®ƒç¼ºä¹ä»»ä½•å›ºæœ‰æœºåˆ¶æ¥æ£€æŸ¥é€šè¿‡åå°„è®¿é—®æ—¶å•ä¾‹ç±»çš„å®ä¾‹æ˜¯å¦å·²ç»å­˜åœ¨ã€‚</li><li>åœ¨ç§æœ‰æ„é€ å‡½æ•°ä¸­æŠ›å‡ºå¼‚å¸¸ä»¥é˜²æ­¢åå°„æ”»å‡»å¹¶ä¸æ˜¯ä¸€ä¸ªä¸‡æ— ä¸€å¤±çš„è®¡åˆ’ï¼Œå› ä¸ºæ”»å‡»è€…ä»ç„¶å¯ä»¥æ“æ§å®ä¾‹åˆ›å»ºè¿‡ç¨‹ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LazySingletonDoubleCheckReflectionProof</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹ï¼šæ·»åŠ  volatile é˜²æ­¢é‡æ’åº</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> LazySingletonDoubleCheckReflectionProof instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šé™åˆ¶ç”¨æˆ·è‡ªå·±åˆ›å»ºå®ä¾‹ï¼Œä½†ä¸èƒ½é˜²æ­¢æ„é€ å‡½æ•°åå°„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazySingletonDoubleCheckReflectionProof</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸èƒ½é˜²æ­¢åå°„æ”»å‡»ï¼šç¬¬ä¸€æ¬¡ä½¿ç”¨åå°„è°ƒç”¨å°†ä»ç„¶æˆåŠŸï¼Œä½†åç»­å°è¯•å°†å¤±è´¥ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != instance) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;This singleton instance already exists.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®š</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LazySingletonDoubleCheckReflectionProof <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == instance) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LazySingletonDoubleCheckReflectionProof.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> == instance) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">LazySingletonDoubleCheckReflectionProof</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="152-å¯¹æ‡’æ±‰å•ä¾‹-åŒé‡æ£€æŸ¥é”å®šçš„åºåˆ—åŒ–æ”»å‡»"><a class="markdownIt-Anchor" href="#152-å¯¹æ‡’æ±‰å•ä¾‹-åŒé‡æ£€æŸ¥é”å®šçš„åºåˆ—åŒ–æ”»å‡»"></a> 1.5.2. å¯¹â€œæ‡’æ±‰å•ä¾‹ - åŒé‡æ£€æŸ¥é”å®šâ€çš„åºåˆ—åŒ–æ”»å‡»</h3><p>åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¸€ä¸ªç±»éœ€è¦å®ç° <code>java.io.Serializable</code>ï¼Œå¦åˆ™å°†æŠ›å‡º <code>java.io.NotSerializableException</code>ã€‚åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„ä¸€èˆ¬è¿‡ç¨‹ï¼š</p><ol><li>åºåˆ—åŒ–å•ä¾‹ç±»ä»¥ç”Ÿæˆåºåˆ—åŒ–æ–‡ä»¶ã€‚</li><li>è¯»å–åºåˆ—åŒ–æ–‡ä»¶é€šè¿‡ååºåˆ—åŒ–è·å–å•ä¾‹ç±»çš„å®ä¾‹ã€‚</li><li>æ¯”è¾ƒåºåˆ—åŒ–å®ä¾‹å’Œååºåˆ—åŒ–å®ä¾‹æ˜¯å¦ç›¸åŒã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯¥ç±»å¿…é¡»å®ç° `java.io.Serializable` ä»¥é¿å…æŠ›å‡º `java.io.NotSerializableException`ã€‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LazySingletonDoubleCheckSerialization</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹ï¼šæ·»åŠ  volatile é˜²æ­¢é‡æ’åº</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> LazySingletonDoubleCheckSerialization instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šé™åˆ¶ç”¨æˆ·è‡ªå·±åˆ›å»ºå®ä¾‹ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazySingletonDoubleCheckSerialization</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸èƒ½åœ¨æ‰€æœ‰æƒ…å†µä¸‹é˜²æ­¢åå°„æ”»å‡»</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != instance) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;This singleton instance already exists.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®š</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LazySingletonDoubleCheckSerialization <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == instance) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LazySingletonDoubleCheckSerialization.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> == instance) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">LazySingletonDoubleCheckSerialization</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†å•ä¾‹ç±»åºåˆ—åŒ–ä»¥ç”Ÿæˆåºåˆ—åŒ–æ–‡ä»¶ -&gt; è¯»å–åºåˆ—åŒ–æ–‡ä»¶å¹¶é€šè¿‡ååºåˆ—åŒ–è·å–å•ä¾‹ç±»çš„å®ä¾‹ -&gt; ååºåˆ—åŒ–çš„å®ä¾‹ä¸ <code>getInstance()</code> çš„å®ä¾‹ä¸ç›¸åŒï¼Œä»è€Œç ´åå•ä¾‹æ¨¡å¼ã€‚ä»¥ä¸‹æ˜¯æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSerializationAttackOnLazySingletonDoubleCheckSerialization</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">LazySingletonDoubleCheckSerialization</span> <span class="variable">instance</span> <span class="operator">=</span> LazySingletonDoubleCheckSerialization.getInstance();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">Path</span> <span class="variable">serializedClassPath</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;TestSerialization-&quot;</span> + LazySingletonDoubleCheckSerialization.class.getSimpleName());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–ï¼š</span></span><br><span class="line">    <span class="keyword">try</span> (<span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(Files.newOutputStream(serializedClassPath))) &#123;</span><br><span class="line">        objectOutputStream.writeObject(instance);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ååºåˆ—åŒ–ï¼šæ„é€ å‡½æ•°å°†ä¸ä¼šè¢«è°ƒç”¨ï¼Œæ•°æ®å°†é€šè¿‡ä»å­—èŠ‚æµè¯»å–æ¥åˆå§‹åŒ–ã€‚</span></span><br><span class="line">    LazySingletonDoubleCheckSerialization testSerializableInstance;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> (<span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(Files.newInputStream(serializedClassPath))) &#123;</span><br><span class="line">        testSerializableInstance = ((LazySingletonDoubleCheckSerialization) objectInputStream.readObject());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException | ClassNotFoundException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Assertions.assertSame(instance, testSerializableInstance); <span class="comment">// Ã—</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ååºåˆ—åŒ–ç”Ÿæˆæ–°å¯¹è±¡çš„åŸå› æ˜¯åºåˆ—åŒ–æœ‰å…¶è‡ªå·±çš„æœºåˆ¶ã€‚å®ƒ<font color="#00b050">è¯»å–å­—èŠ‚æµæ•°æ®è€Œä¸è°ƒç”¨æ„é€ å‡½æ•°</font>ã€‚å¯¹äºéæšä¸¾å•ä¾‹ï¼Œä¸ºé˜²æ­¢åºåˆ—åŒ–æ”»å‡»ï¼Œéœ€è¦æ·»åŠ ç‰ˆæœ¬å·ï¼Œå¦‚ <code>private static final long serialVersionUID = -1L;</code>ï¼Œå¹¶å®ç° <code>readResolve()</code> æ–¹æ³•ï¼Œè¿”å›ç±»çš„å®ä¾‹ã€‚è¿™æ ·å°±å¯ä»¥å¾—åˆ°ç›¸åŒçš„å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LazySingletonDoubleCheckSerializationProof</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸»è¦ç”¨äºç‰ˆæœ¬æ§åˆ¶ï¼Œç¡®ä¿åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç±»ç‰ˆæœ¬ä¹‹é—´çš„å…¼å®¹æ€§ã€‚</span></span><br><span class="line"><span class="comment">     * å¦‚æœåœ¨åºåˆ—åŒ–æ—¶æœªæ·»åŠ  `serialVersionUID`ï¼Œå°†æ ¹æ®å½“å‰ç±»æ•°æ®è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç‰ˆæœ¬å·ã€‚</span></span><br><span class="line"><span class="comment">     * ååºåˆ—åŒ–æ—¶ï¼Œä¹Ÿä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç‰ˆæœ¬å·ã€‚</span></span><br><span class="line"><span class="comment">     * å¦‚æœä¸¤ä¸ªç‰ˆæœ¬å·ä¸åŒ¹é…ï¼ˆä¾‹å¦‚ï¼Œç±»å†…å®¹åœ¨ååºåˆ—åŒ–ä¹‹å‰è¢«ä¿®æ”¹ï¼‰ï¼Œå°†æŠ¥å‘Šä»¥ä¸‹é”™è¯¯ï¼š</span></span><br><span class="line"><span class="comment">     * `java.io.InvalidClassException: local class incompatible: stream classdesc serialVersionUID = -4190675925334731018, local class serialVersionUID = 1437610846000386433</span></span><br><span class="line"><span class="comment">     * æŒ‡å®š `serialVersionUID` å¯ä»¥è§£å†³æ­¤é—®é¢˜ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹ï¼šæ·»åŠ  volatile é˜²æ­¢é‡æ’åº</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> LazySingletonDoubleCheckSerializationProof instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šé™åˆ¶ç”¨æˆ·è‡ªå·±åˆ›å»ºå®ä¾‹ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazySingletonDoubleCheckSerializationProof</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸èƒ½åœ¨æ‰€æœ‰æƒ…å†µä¸‹é˜²æ­¢åå°„æ”»å‡»</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != instance) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;This singleton instance already exists.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®š</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LazySingletonDoubleCheckSerializationProof <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == instance) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LazySingletonDoubleCheckSerializationProof.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> == instance) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">LazySingletonDoubleCheckSerializationProof</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¹äºéæšä¸¾å•ä¾‹æ¨¡å¼ï¼Œå½“é¢ä¸´åºåˆ—åŒ–æ”»å‡»æ—¶ï¼Œå¿…é¡»å®ç° `readResolve()` æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ObjectStreamException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Object <span class="title function_">readResolve</span><span class="params">()</span> <span class="keyword">throws</span> ObjectStreamException &#123;</span><br><span class="line">        <span class="comment">// ååºåˆ—åŒ–å®ä¾‹æ˜¯ç›¸åŒçš„ï¼Œè¿”å›è¯¥å®ä¾‹</span></span><br><span class="line">        <span class="keyword">return</span> getInstance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥åˆ†æååºåˆ—åŒ–çš„æºä»£ç ï¼š<code>objectInputStream.readObject()</code> -&gt; <code>readObject(Object.class)</code> -&gt; <code>Object obj = readObject0(type, false);</code> -&gt; åœ¨ TC_OBJECT çš„æƒ…å†µä¸‹ï¼š<code>readOrdinaryObject(unshared)</code>ã€‚</p><p><code>readOrdinaryObject(unshared)</code> çš„å…³é”®ç‚¹æ˜¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Object <span class="title function_">readOrdinaryObject</span><span class="params">(<span class="type">boolean</span> unshared)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (obj != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">        handles.lookupException(passHandle) == <span class="literal">null</span> &amp;&amp;</span><br><span class="line">        <span class="comment">// hasReadResolveMethodï¼šæ£€æŸ¥å½“å‰ç±»æ˜¯å¦æœ‰ `readResolve()` æ–¹æ³•ã€‚</span></span><br><span class="line">        desc.hasReadResolveMethod())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨å½“å‰ç±»çš„ `readResolve()` æ–¹æ³•ã€‚</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">rep</span> <span class="operator">=</span> desc.invokeReadResolve(obj);</span><br><span class="line">        <span class="keyword">if</span> (unshared &amp;&amp; rep.getClass().isArray()) &#123;</span><br><span class="line">            rep = cloneArray(rep);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (rep != obj) &#123;</span><br><span class="line">            <span class="comment">// è¿‡æ»¤æ›¿æ¢å¯¹è±¡</span></span><br><span class="line">            <span class="keyword">if</span> (rep != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (rep.getClass().isArray()) &#123;</span><br><span class="line">                    filterCheck(rep.getClass(), Array.getLength(rep));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    filterCheck(rep.getClass(), -<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// é€šè¿‡ `readResolve()` è¿”å›çš„ `rep` è¢«èµ‹å€¼ç»™ `obj`ã€‚</span></span><br><span class="line">            handles.setObject(passHandle, obj = rep);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">hasReadResolveMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    requireInitialized();</span><br><span class="line">    <span class="comment">// å¦‚æœ `readResolveMethod` ä¸ä¸º nullï¼Œè¡¨ç¤ºå½“å‰ç±»æœ‰ `readResolve()` æ–¹æ³•ã€‚</span></span><br><span class="line">    <span class="keyword">return</span> (readResolveMethod != <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">ObjectStreamClass</span><span class="params">(<span class="keyword">final</span> Class&lt;?&gt; cl)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å½“å‰ç±»çš„ `readResolve()` æ–¹æ³•ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ `readResolveMethod` å˜é‡</span></span><br><span class="line">    readResolveMethod = getInheritableMethod(cl, <span class="string">&quot;readResolve&quot;</span>, <span class="literal">null</span>, Object.class);</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="153-å®Œç¾ç‰ˆçš„æ‡’æ±‰å•ä¾‹-åŒé‡æ£€æŸ¥é”å®š"><a class="markdownIt-Anchor" href="#153-å®Œç¾ç‰ˆçš„æ‡’æ±‰å•ä¾‹-åŒé‡æ£€æŸ¥é”å®š"></a> 1.5.3. å®Œç¾ç‰ˆçš„â€œæ‡’æ±‰å•ä¾‹ - åŒé‡æ£€æŸ¥é”å®šâ€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‡’æ±‰å•ä¾‹ - åŒé‡æ£€æŸ¥é”å®šï¼ˆDCLï¼‰ï¼šå®Œç¾ç‰ˆ</span></span><br><span class="line"><span class="comment"> * 1. ä½¿ç”¨ volatile + DCL æ¥ä¿è¯çº¿ç¨‹å®‰å…¨å¹¶å‡å°‘åŒæ­¥çš„ä½¿ç”¨</span></span><br><span class="line"><span class="comment"> * 2. å°è¯•ä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°æ£€æŸ¥æ¥é˜²æ­¢åå°„æ”»å‡»ï¼Œä½†ä¸èƒ½åœ¨æ‰€æœ‰æƒ…å†µä¸‹ä¿è¯</span></span><br><span class="line"><span class="comment"> * 3. ä½¿ç”¨å®šä¹‰çš„ serialVersionUID å’Œ readResolve() æ¥é˜²æ­¢åºåˆ—åŒ–æ”»å‡»</span></span><br><span class="line"><span class="comment"> * 4. é‡å†™ clone() æ–¹æ³•ä»¥é˜²æ­¢å…‹éš†æ”»å‡»</span></span><br><span class="line"><span class="comment"> * 5. ä½¿ç”¨ final ç±»æ¥é˜²æ­¢å­ç±»åŒ–ï¼Œé¿å…ä»»ä½•å­ç±»ç ´åå•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">LazySingletonDoubleCheckPerfect</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜ç¡®å®šä¹‰ `serialVersionUID` å¯ä»¥é¿å…æ½œåœ¨çš„å…¼å®¹æ€§é—®é¢˜ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹ï¼šæ·»åŠ  volatile ä»¥é˜²æ­¢é‡æ’åº</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> LazySingletonDoubleCheckPerfect instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šé™åˆ¶ç”¨æˆ·è‡ªè¡Œåˆ›å»ºå®ä¾‹ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazySingletonDoubleCheckPerfect</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ— æ³•åœ¨æ‰€æœ‰æƒ…å†µä¸‹é˜²æ­¢åå°„æ”»å‡»</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != instance) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;This singleton instance already exists.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®š</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LazySingletonDoubleCheckPerfect <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == instance) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LazySingletonDoubleCheckPerfect.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> == instance) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">LazySingletonDoubleCheckPerfect</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜²æ­¢åºåˆ—åŒ–æ”»å‡»</span></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span> <span class="keyword">throws</span> ObjectStreamException &#123;</span><br><span class="line">        <span class="comment">// åœ¨ååºåˆ—åŒ–æœŸé—´ï¼šè¿”å›ç°æœ‰å®ä¾‹ï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°å®ä¾‹ã€‚</span></span><br><span class="line">        <span class="keyword">return</span> getInstance();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜²æ­¢å…‹éš†</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="comment">// (1) æŠ›å‡ºå¼‚å¸¸ä»¥é˜²æ­¢å…‹éš†</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CloneNotSupportedException</span>(<span class="string">&quot;Cloning of this singleton instance is not allowed&quot;</span>);</span><br><span class="line">        <span class="comment">// (2) æˆ–è€…ç›´æ¥ä»å…‹éš†æ–¹æ³•è¿”å›ç›¸åŒçš„å®ä¾‹</span></span><br><span class="line">        <span class="comment">//return getInstance();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="2-é¥¿æ±‰å¼å•ä¾‹"><a class="markdownIt-Anchor" href="#2-é¥¿æ±‰å¼å•ä¾‹"></a> 2. é¥¿æ±‰å¼å•ä¾‹</h1><p>é¥¿æ±‰å¼åˆå§‹åŒ–æ¨¡å¼åœ¨ç±»åŠ è½½æ—¶å®Œæˆåˆå§‹åŒ–ï¼Œä¾èµ–äº<font color="#00b050">ç±»åŠ è½½æœºåˆ¶</font>æ¥ç¡®ä¿å•ä¾‹è¡Œä¸ºè€Œæ— éœ€ç‰¹åœ°äººä¸ºåŠ é”ï¼Œä»è€Œå®ç°æ›´é«˜çš„æ‰§è¡Œæ•ˆç‡ã€‚ç„¶è€Œï¼Œç”±äºåœ¨ç±»åŠ è½½æ—¶è¿›è¡Œå®ä¾‹åŒ–ï¼Œå®ƒç¼ºä¹å»¶è¿ŸåŠ è½½çš„ä¼˜åŠ¿ã€‚å¦‚æœå®ä¾‹æœªè¢«ä½¿ç”¨ï¼Œå®ƒå°†è¢«ä¸å¿…è¦åœ°å®ä¾‹åŒ–ï¼Œå¯¼è‡´èµ„æºæµªè´¹ã€‚</p><p>åœ¨ä»¥ä¸‹ä¸¤ä¸ªé¥¿æ±‰å¼å•ä¾‹çš„ä¾‹å­ä¸­ï¼Œå®ƒä»¬éƒ½æ¯”æ‡’æ±‰å¼å•ä¾‹ç®€å•å¾—å¤šã€‚è¿™ä¸¤ç§æ¨¡å¼éƒ½åˆ©ç”¨äº† JVM çš„ç±»åŠ è½½æœºåˆ¶æ¥ç¡®ä¿å®ä¾‹çš„å”¯ä¸€æ€§ã€‚åˆå§‹åŒ–åªå‘ç”Ÿä¸€æ¬¡ï¼Œå¹¶ä¸” JVM ä¼šåŒæ­¥ç±»åŠ è½½è¿‡ç¨‹ã€‚</p><p>ç±»åŠ è½½è¿‡ç¨‹åŒ…æ‹¬ï¼š</p><ol><li><strong>åŠ è½½</strong>ï¼šJVM å®šä½å¹¶å°†ç±»æ–‡ä»¶çš„å­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç”Ÿæˆç›¸åº”çš„ç±»æ•°æ®ç»“æ„ã€‚</li><li><strong>é“¾æ¥</strong>ï¼š<strong>éªŒè¯</strong>ï¼ˆéªŒè¯åŠ è½½çš„å­—èŠ‚ç çš„æ­£ç¡®æ€§ï¼‰â†’ <strong>å‡†å¤‡</strong>ï¼ˆå°†é™æ€å­—æ®µåˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ï¼‰â†’ <strong>è§£æ</strong>ï¼ˆå°†ç±»æ–‡ä»¶ä¸­çš„ç¬¦å·å¼•ç”¨è§£æä¸ºå®é™…å¼•ç”¨ï¼‰</li><li><strong>åˆå§‹åŒ–</strong>ï¼šç±»ä¸­çš„<font color="#00b050">é™æ€åˆå§‹åŒ–å™¨</font>å’Œ<font color="#00b050">é™æ€ä»£ç å—</font>åœ¨<code>&lt;clinit&gt;</code>ä¸­æ‰§è¡Œï¼Œæ­¤è¿‡ç¨‹ä»…åœ¨ç±»é¦–æ¬¡è¢«ä½¿ç”¨æ—¶å‘ç”Ÿï¼Œä¾‹å¦‚åˆ›å»ºå®ä¾‹æˆ–è°ƒç”¨é™æ€æ–¹æ³•æ—¶ã€‚</li><li><strong>ä½¿ç”¨</strong>ï¼šç±»è¢«åŠ è½½å’Œåˆå§‹åŒ–åï¼Œå¯ä»¥åˆ›å»ºå…¶å®ä¾‹ï¼Œè°ƒç”¨å…¶æ–¹æ³•ä»¥åŠè®¿é—®å…¶å­—æ®µã€‚</li><li><strong>å¸è½½</strong>ï¼šå½“ç±»åŠå…¶ç›¸å…³çš„ç±»åŠ è½½å™¨ä¸å†ä½¿ç”¨ä¸”å¯ä»¥è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œç±»ä¼šä»å†…å­˜ä¸­ç§»é™¤ã€‚</li></ol><p>ç”±äº <code>instance</code> å˜é‡æ˜¯é™æ€æˆå‘˜å˜é‡ï¼Œå…¶å®ä¾‹åŒ–å‘ç”Ÿåœ¨ç±»åŠ è½½çš„åˆå§‹åŒ–é˜¶æ®µã€‚æ­¤é˜¶æ®µæ¶‰åŠæ‰§è¡Œç±»æ„é€ å™¨ <code>&lt;clinit&gt;()</code> æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰é™æ€å˜é‡å’Œé™æ€ä»£ç å—ã€‚å› æ­¤ï¼Œ<code>private static final EagerSingletonStaticConstant instance = new EagerSingletonStaticConstant();</code> å’Œ <code> static &#123; instance = new EagerSingletonStaticBlock(); &#125;</code> ä¹Ÿåœ¨æ­¤æ–¹æ³•ä¸­æ‰§è¡Œã€‚JVM ç¡®ä¿ç±»çš„ <code>&lt;clinit&gt;()</code> æ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­æ˜¯åŒæ­¥çš„ï¼Œä»è€Œä¿è¯äº†çº¿ç¨‹å®‰å…¨ã€‚</p><details class="custom-callout tip" open><summary class="callout-title"><div class="callout-icon"></div><div>Tip</div><div class="callout-fold"></div></summary><div class="callout-body"><p>æœ‰äº›äººå¯èƒ½ä¼šå›°æƒ‘ä¸ºä»€ä¹ˆé¥¿æ±‰å¼å•ä¾‹æ›´æµªè´¹èµ„æºã€‚ä»–ä»¬å¯èƒ½ä¼šæƒ³ï¼šâ€œå½“é‚£ä¸ªé¥¿æ±‰å¼å•ä¾‹ç±»ä»æœªä½¿ç”¨æ—¶ï¼Œä¼¼ä¹æ²¡æœ‰è°ƒç”¨ç±»çš„æ„é€ å‡½æ•°ã€‚â€</p><p>å®é™…ä¸Šï¼Œè¿™ç§æƒ…å†µæ›´å¤šåœ°å‡ºç°åœ¨è°ƒç”¨ç±»çš„å…¶ä»–æ–¹æ³•æ—¶ï¼Œè€Œä¸æ˜¯è°ƒç”¨<code>getInstance()</code>æ–¹æ³•ã€‚å¯¹äºé¥¿æ±‰å¼å•ä¾‹ï¼Œå³ä½¿ä½ ä¸è·å–è¯¥å•ä¾‹çš„å®ä¾‹ï¼Œä»…ä»…æ˜¯è°ƒç”¨ç±»çš„å…¶ä»–æ–¹æ³•ï¼Œä¹Ÿä¼šç”±äºç±»åŠ è½½æœºåˆ¶è§¦å‘ç±»çš„åˆ›å»ºã€‚ä½†å¯¹äºæ‡’æ±‰å¼å•ä¾‹ï¼Œå®ƒä¸ä¼šè§¦å‘ç±»çš„åˆ›å»ºï¼Œè€Œåªæ˜¯æ‰§è¡Œè¯¥å…¶ä»–æ–¹æ³•ã€‚</p><p>æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æ­¤ç¤ºä¾‹ï¼š<a href="https://github.com/sissilab/DesignPattern-Lab/blob/master/src/main/java/com/sissilab/dp/ox1_creational/ox11_singleton/EagerSingletonWastingReason.java">EagerSingletonWastingReason.java at sissilab/DesignPattern-Lab (github.com)</a>ã€‚</p></div></details><h2 id="21-é¥¿æ±‰å¼å•ä¾‹-é™æ€å¸¸é‡"><a class="markdownIt-Anchor" href="#21-é¥¿æ±‰å¼å•ä¾‹-é™æ€å¸¸é‡"></a> 2.1. é¥¿æ±‰å¼å•ä¾‹ - é™æ€å¸¸é‡</h2><p>è¿™ç§å®ç°éå¸¸ç®€å•ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´èµ„æºæµªè´¹ï¼Œå› ä¸ºç±»çš„å®ä¾‹æ€»æ˜¯è¢«åˆ›å»ºï¼Œæ— è®ºæ˜¯å¦éœ€è¦ã€‚è€Œä¸”åœ¨ç±»åˆ›å»ºæœŸé—´å¤„ç†å¼‚å¸¸ä¹Ÿä¸å®¹æ˜“ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 2.1. é¥¿æ±‰å¼å•ä¾‹ - é™æ€å¸¸é‡</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ä¼˜ç‚¹ï¼š</span></span><br><span class="line"><span class="comment"> * 1. åŸºäºç±»åŠ è½½æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä¸éœ€è¦åŒæ­¥æ“ä½œ</span></span><br><span class="line"><span class="comment"> * 2. å®ç°ç®€å•æ˜“æ‡‚ï¼Œæ— éœ€é¢å¤–çš„ä»£ç æ¥å¤„ç†æ‡’åŠ è½½æˆ–åŒæ­¥æœºåˆ¶</span></span><br><span class="line"><span class="comment"> * 3. åœ¨ `getInstance()` æ—¶æ²¡æœ‰æ€§èƒ½å¼€é”€ï¼Œå› ä¸ºå®ä¾‹æ˜¯åœ¨ç±»åŠ è½½æ—¶åˆ›å»ºçš„</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ç¼ºç‚¹ï¼š</span></span><br><span class="line"><span class="comment"> * 1. å¯èƒ½ä¼šç”±äºæå‰åˆ›å»ºå®ä¾‹è€Œæµªè´¹èµ„æºï¼Œå°¤å…¶æ˜¯å¯¹äºæ‹¥æœ‰å¤§ç¼“å­˜æˆ–æ•°æ®åº“è¿æ¥çš„é‡é‡çº§å•ä¾‹ç±»</span></span><br><span class="line"><span class="comment"> * 2. ç¼ºä¹æ‡’åŠ è½½</span></span><br><span class="line"><span class="comment"> * 3. ä½¿ç”¨é™æ€å¸¸é‡æ—¶ï¼Œå¤„ç†ç±»åˆ›å»ºæœŸé—´çš„å¼‚å¸¸ä¸çµæ´»</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * æœ€ä½³ä½¿ç”¨åœºæ™¯ï¼š</span></span><br><span class="line"><span class="comment"> * 1. å½“å•ä¾‹ç±»ç›¸å¯¹è½»é‡æ—¶ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="comment"> * 2. å½“å•ä¾‹ç±»åœ¨åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸä¸­é¢‘ç¹ä½¿ç”¨æ—¶ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="comment"> * 3. å½“æ‡’åŠ è½½æ›´åˆé€‚æ—¶é¿å…ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EagerSingletonStaticConstant</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹ï¼šåœ¨ç±»åŠ è½½æ—¶åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">EagerSingletonStaticConstant</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EagerSingletonStaticConstant</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šç¦æ­¢ç”¨æˆ·è‡ªè¡Œåˆ›å»ºå®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">EagerSingletonStaticConstant</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ§åˆ¶å¯¹å•ä¾‹å®ä¾‹çš„è®¿é—®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> EagerSingletonStaticConstant <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å±•ç¤ºäº†é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼çš„ç®€å•å®ç°ï¼Œå®ƒä¾èµ–äºé™æ€å¸¸é‡æ¥ä¿è¯å®ä¾‹çš„å”¯ä¸€æ€§å’Œçº¿ç¨‹å®‰å…¨æ€§ã€‚</p><h3 id="211-å¯¹é¥¿æ±‰å¼å•ä¾‹-é™æ€å¸¸é‡çš„åå°„æ”»å‡»"><a class="markdownIt-Anchor" href="#211-å¯¹é¥¿æ±‰å¼å•ä¾‹-é™æ€å¸¸é‡çš„åå°„æ”»å‡»"></a> 2.1.1. å¯¹â€œé¥¿æ±‰å¼å•ä¾‹ - é™æ€å¸¸é‡â€çš„åå°„æ”»å‡»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EagerSingletonStaticConstantReflectionProof</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹ï¼šåœ¨ç±»åŠ è½½æ—¶åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">EagerSingletonStaticConstantReflectionProof</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EagerSingletonStaticConstantReflectionProof</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šç¦æ­¢ç”¨æˆ·è‡ªè¡Œåˆ›å»ºå®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">EagerSingletonStaticConstantReflectionProof</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é˜²æ­¢åå°„æ”»å‡»</span></span><br><span class="line">        <span class="keyword">if</span> (instance != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;This singleton instance already exists.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ§åˆ¶å¯¹å•ä¾‹å®ä¾‹çš„è®¿é—®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> EagerSingletonStaticConstantReflectionProof <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="212-å¯¹é¥¿æ±‰å¼å•ä¾‹-é™æ€å¸¸é‡çš„åºåˆ—åŒ–æ”»å‡»"><a class="markdownIt-Anchor" href="#212-å¯¹é¥¿æ±‰å¼å•ä¾‹-é™æ€å¸¸é‡çš„åºåˆ—åŒ–æ”»å‡»"></a> 2.1.2. å¯¹â€œé¥¿æ±‰å¼å•ä¾‹ - é™æ€å¸¸é‡â€çš„åºåˆ—åŒ–æ”»å‡»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EagerSingletonStaticConstantSerializationProof</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜¾å¼å®šä¹‰ `serialVersionUID`ï¼Œä»¥é¿å…æ½œåœ¨çš„ä¸å…¼å®¹é—®é¢˜</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹ï¼šåœ¨ç±»åŠ è½½æ—¶åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">EagerSingletonStaticConstantSerializationProof</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EagerSingletonStaticConstantSerializationProof</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šç¦æ­¢ç”¨æˆ·è‡ªè¡Œåˆ›å»ºå®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">EagerSingletonStaticConstantSerializationProof</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é˜²æ­¢åå°„æ”»å‡»</span></span><br><span class="line">        <span class="keyword">if</span> (instance != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;This singleton instance already exists.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ§åˆ¶å¯¹å•ä¾‹å®ä¾‹çš„è®¿é—®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> EagerSingletonStaticConstantSerializationProof <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜²æ­¢ååºåˆ—åŒ–æ—¶åˆ›å»ºæ–°å®ä¾‹</span></span><br><span class="line">    Object <span class="title function_">readResolve</span><span class="params">()</span> <span class="keyword">throws</span> ObjectStreamException &#123;</span><br><span class="line">        <span class="comment">// åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼šè¿”å›ç°æœ‰çš„å®ä¾‹ï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°å®ä¾‹</span></span><br><span class="line">        <span class="keyword">return</span> getInstance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="213-å®Œç¾ç‰ˆçš„é¥¿æ±‰å¼å•ä¾‹-é™æ€å¸¸é‡"><a class="markdownIt-Anchor" href="#213-å®Œç¾ç‰ˆçš„é¥¿æ±‰å¼å•ä¾‹-é™æ€å¸¸é‡"></a> 2.1.3. å®Œç¾ç‰ˆçš„â€œé¥¿æ±‰å¼å•ä¾‹ - é™æ€å¸¸é‡â€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é¥¿æ±‰å¼å•ä¾‹ - é™æ€å¸¸é‡ï¼šå®Œç¾ç‰ˆæœ¬</span></span><br><span class="line"><span class="comment"> * 1. ä½¿ç”¨é™æ€å¸¸é‡åŸºäºç±»åŠ è½½æœºåˆ¶åˆ›å»ºå•ä¾‹å®ä¾‹</span></span><br><span class="line"><span class="comment"> * 2. å°è¯•ä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°æ£€æŸ¥æ¥é˜²æ­¢åå°„æ”»å‡»ï¼Œä½†æ— æ³•åœ¨æ‰€æœ‰æƒ…å†µä¸‹ä¿è¯</span></span><br><span class="line"><span class="comment"> * 3. ä½¿ç”¨å®šä¹‰çš„ serialVersionUID å’Œ readResolve() æ¥é˜²æ­¢åºåˆ—åŒ–æ”»å‡»</span></span><br><span class="line"><span class="comment"> * 4. é‡å†™ clone() ä»¥é˜²æ­¢å…‹éš†æ”»å‡»</span></span><br><span class="line"><span class="comment"> * 5. ä½¿ç”¨ final ç±»ä»¥é˜²æ­¢å­ç±»åŒ–ï¼Œé¿å…ä»»ä½•å­ç±»ç ´åå•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">EagerSingletonStaticConstantPerfect</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜¾å¼å®šä¹‰ `serialVersionUID` ä»¥é¿å…æ½œåœ¨çš„ä¸å…¼å®¹é—®é¢˜</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹ï¼šåœ¨ç±»åŠ è½½æ—¶åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">EagerSingletonStaticConstantPerfect</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EagerSingletonStaticConstantPerfect</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šç¦æ­¢ç”¨æˆ·è‡ªè¡Œåˆ›å»ºå®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">EagerSingletonStaticConstantPerfect</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ— æ³•åœ¨æ‰€æœ‰æƒ…å†µä¸‹é˜²æ­¢åå°„æ”»å‡»</span></span><br><span class="line">        <span class="keyword">if</span> (instance != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;This singleton instance already exists.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ§åˆ¶å¯¹å•ä¾‹å®ä¾‹çš„è®¿é—®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> EagerSingletonStaticConstantPerfect <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜²æ­¢åºåˆ—åŒ–æ”»å‡»</span></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span> <span class="keyword">throws</span> ObjectStreamException &#123;</span><br><span class="line">        <span class="comment">// åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼šè¿”å›ç°æœ‰çš„å®ä¾‹ï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°å®ä¾‹</span></span><br><span class="line">        <span class="keyword">return</span> getInstance();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜²æ­¢å…‹éš†</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="comment">// (1) æŠ›å‡ºå¼‚å¸¸ä»¥é˜²æ­¢å…‹éš†</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CloneNotSupportedException</span>(<span class="string">&quot;Cloning of this singleton instance is not allowed&quot;</span>);</span><br><span class="line">        <span class="comment">// (2) æˆ–è€…ç›´æ¥ä»cloneæ–¹æ³•è¿”å›ç›¸åŒçš„å®ä¾‹</span></span><br><span class="line">        <span class="comment">//return getInstance();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="22-é¥¿æ±‰å¼å•ä¾‹-é™æ€å—"><a class="markdownIt-Anchor" href="#22-é¥¿æ±‰å¼å•ä¾‹-é™æ€å—"></a> 2.2. é¥¿æ±‰å¼å•ä¾‹ - é™æ€å—</h2><p>ä½¿ç”¨é™æ€å—å®Œæˆç±»å®ä¾‹åŒ–ä¹Ÿå¯èƒ½ç”±äºç±»åŠ è½½æœºåˆ¶å¯¼è‡´èµ„æºæµªè´¹ã€‚ä½†åœ¨é™æ€å—ä¸­å¤„ç†å¼‚å¸¸å’Œæ‰§è¡Œæ›´å¤šæ“ä½œä¼šæ›´å®¹æ˜“ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 2.2. é¥¿æ±‰å¼å•ä¾‹ - é™æ€å—</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ä¼˜ç‚¹ï¼š</span></span><br><span class="line"><span class="comment"> * 1. å¯ä»¥åŸºäºç±»åŠ è½½æœºåˆ¶ä¿è¯åˆ›å»ºæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ— éœ€åŒæ­¥</span></span><br><span class="line"><span class="comment"> * 2. æ›´ç›´æ¥ä¸”æ˜“äºç†è§£ï¼Œæ— éœ€é¢å¤–ä»£ç æ¥å¤„ç†å»¶è¿Ÿåˆå§‹åŒ–æˆ–åŒæ­¥æœºåˆ¶</span></span><br><span class="line"><span class="comment"> * 3. åœ¨ `getInstance()` æ—¶æ²¡æœ‰æ€§èƒ½å¼€é”€ï¼Œå› ä¸ºå®ä¾‹æ˜¯åœ¨ç±»åŠ è½½æ—¶åˆ›å»ºçš„</span></span><br><span class="line"><span class="comment"> * 4. åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œé™æ€å—çµæ´»åœ°å¤„ç†æ›´å¤æ‚çš„é€»è¾‘æˆ–å¼‚å¸¸</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ç¼ºç‚¹ï¼š</span></span><br><span class="line"><span class="comment"> * 1. ç”±äºè¿‡æ—©åˆ›å»ºå¯èƒ½æµªè´¹èµ„æºï¼Œå°¤å…¶æ˜¯å¯¹äºèµ„æºå¯†é›†å‹çš„å•ä¾‹ç±»ï¼Œå¦‚å¤§å‹ç¼“å­˜æˆ–æ•°æ®åº“è¿æ¥</span></span><br><span class="line"><span class="comment"> * 2. ç¼ºä¹å»¶è¿Ÿåˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * æœ€ä½³ä½¿ç”¨åœºæ™¯ï¼š</span></span><br><span class="line"><span class="comment"> * 1. åœ¨å•ä¾‹ç±»ç›¸å¯¹è½»é‡æ—¶ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="comment"> * 2. åœ¨åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸä¸­é¢‘ç¹éœ€è¦å•ä¾‹ç±»æ—¶ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="comment"> * 3. åœ¨éœ€è¦å¤æ‚åˆå§‹åŒ–æ­¥éª¤æ—¶ä½¿ç”¨ï¼Œå› ä¸ºé™æ€å—æä¾›äº†çµæ´»æ€§æ¥å¤„ç†ã€‚</span></span><br><span class="line"><span class="comment"> * 4. å½“å»¶è¿ŸåŠ è½½æ›´å¯å–æ—¶é¿å…ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EagerSingletonStaticBlock</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹ï¼šåœ¨ç±»åŠ è½½æ—¶åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> EagerSingletonStaticBlock instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æ€å—ä¸­åˆ›å»ºè¯¥å•ä¾‹ç±»çš„å®ä¾‹</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        instance = <span class="keyword">new</span> <span class="title class_">EagerSingletonStaticBlock</span>();</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šç¦æ­¢ç”¨æˆ·è‡ªè¡Œåˆ›å»ºå®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">EagerSingletonStaticBlock</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ§åˆ¶å¯¹å•ä¾‹å®ä¾‹çš„è®¿é—®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> EagerSingletonStaticBlock <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="221-å¯¹é¥¿æ±‰å¼å•ä¾‹-é™æ€å—çš„åå°„æ”»å‡»"><a class="markdownIt-Anchor" href="#221-å¯¹é¥¿æ±‰å¼å•ä¾‹-é™æ€å—çš„åå°„æ”»å‡»"></a> 2.2.1. å¯¹â€œé¥¿æ±‰å¼å•ä¾‹ - é™æ€å—â€çš„åå°„æ”»å‡»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EagerSingletonStaticBlockReflectionProof</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹ï¼šåœ¨é™æ€å—ä¸­åŠ è½½ç±»æ—¶åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> EagerSingletonStaticBlockReflectionProof instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        instance = <span class="keyword">new</span> <span class="title class_">EagerSingletonStaticBlockReflectionProof</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šé™åˆ¶ç”¨æˆ·è‡ªè¡Œåˆ›å»ºå®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">EagerSingletonStaticBlockReflectionProof</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é˜²æ­¢åå°„æ”»å‡»</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != instance) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;This singleton instance already exists.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ§åˆ¶å¯¹å•ä¾‹å®ä¾‹çš„è®¿é—®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> EagerSingletonStaticBlockReflectionProof <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="222-å¯¹é¥¿æ±‰å¼å•ä¾‹-é™æ€å—çš„åºåˆ—åŒ–æ”»å‡»"><a class="markdownIt-Anchor" href="#222-å¯¹é¥¿æ±‰å¼å•ä¾‹-é™æ€å—çš„åºåˆ—åŒ–æ”»å‡»"></a> 2.2.2. å¯¹â€œé¥¿æ±‰å¼å•ä¾‹ - é™æ€å—â€çš„åºåˆ—åŒ–æ”»å‡»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EagerSingletonStaticBlockSerializationProof</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜ç¡®å®šä¹‰ `serialVersionUID` å¯ä»¥é¿å…æ½œåœ¨çš„ä¸å…¼å®¹é—®é¢˜ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹ï¼šåœ¨é™æ€å—ä¸­åŠ è½½ç±»æ—¶åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> EagerSingletonStaticBlockSerializationProof instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        instance = <span class="keyword">new</span> <span class="title class_">EagerSingletonStaticBlockSerializationProof</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šé™åˆ¶ç”¨æˆ·è‡ªè¡Œåˆ›å»ºå®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">EagerSingletonStaticBlockSerializationProof</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é˜²æ­¢åå°„æ”»å‡»</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != instance) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;This singleton instance already exists.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ§åˆ¶å¯¹å•ä¾‹å®ä¾‹çš„è®¿é—®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> EagerSingletonStaticBlockSerializationProof <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜²æ­¢åºåˆ—åŒ–æ”»å‡»</span></span><br><span class="line">    Object <span class="title function_">readResolve</span><span class="params">()</span> <span class="keyword">throws</span> ObjectStreamException &#123;</span><br><span class="line">        <span class="comment">// åœ¨ååºåˆ—åŒ–æœŸé—´ï¼šè¿”å›ç°æœ‰å®ä¾‹ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚</span></span><br><span class="line">        <span class="keyword">return</span> getInstance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="223-å®Œç¾ç‰ˆæœ¬çš„é¥¿æ±‰å¼å•ä¾‹-é™æ€å—"><a class="markdownIt-Anchor" href="#223-å®Œç¾ç‰ˆæœ¬çš„é¥¿æ±‰å¼å•ä¾‹-é™æ€å—"></a> 2.2.3. å®Œç¾ç‰ˆæœ¬çš„â€œé¥¿æ±‰å¼å•ä¾‹ - é™æ€å—â€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é¥¿æ±‰å¼å•ä¾‹ - é™æ€å—ï¼šå®Œç¾ç‰ˆæœ¬</span></span><br><span class="line"><span class="comment"> * 1. ä½¿ç”¨é™æ€å—åŸºäºç±»åŠ è½½æœºåˆ¶åˆ›å»ºå•ä¾‹å®ä¾‹</span></span><br><span class="line"><span class="comment"> * 2. å°è¯•ä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°æ£€æŸ¥ä»¥é˜²æ­¢åå°„æ”»å‡»ï¼Œä½†åœ¨æ‰€æœ‰æƒ…å†µä¸‹æ— æ³•ä¿è¯</span></span><br><span class="line"><span class="comment"> * 3. ä½¿ç”¨å®šä¹‰çš„ serialVersionUID å’Œ readResolve() æ¥é˜²æ­¢åºåˆ—åŒ–æ”»å‡»</span></span><br><span class="line"><span class="comment"> * 4. é‡å†™ clone() æ–¹æ³•ä»¥é˜²æ­¢å…‹éš†æ”»å‡»</span></span><br><span class="line"><span class="comment"> * 5. ä½¿ç”¨ final ç±»é˜²æ­¢å­ç±»åŒ–ï¼Œé¿å…ä»»ä½•å­ç±»ç ´åå•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">EagerSingletonStaticBlockPerfect</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜ç¡®å®šä¹‰ `serialVersionUID` å¯ä»¥é¿å…æ½œåœ¨çš„ä¸å…¼å®¹é—®é¢˜ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹ï¼šåœ¨åŠ è½½ç±»æ—¶åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> EagerSingletonStaticBlockPerfect instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        instance = <span class="keyword">new</span> <span class="title class_">EagerSingletonStaticBlockPerfect</span>();</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šé™åˆ¶ç”¨æˆ·è‡ªè¡Œåˆ›å»ºå®ä¾‹ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">EagerSingletonStaticBlockPerfect</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åœ¨æ‰€æœ‰æƒ…å†µä¸‹æ— æ³•é˜²æ­¢åå°„æ”»å‡»</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != instance) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;This singleton instance already exists.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ§åˆ¶å¯¹å•ä¾‹å®ä¾‹çš„è®¿é—®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> EagerSingletonStaticBlockPerfect <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜²æ­¢åºåˆ—åŒ–æ”»å‡»</span></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span> <span class="keyword">throws</span> ObjectStreamException &#123;</span><br><span class="line">        <span class="comment">// åœ¨ååºåˆ—åŒ–æœŸé—´ï¼šè¿”å›ç°æœ‰å®ä¾‹ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚</span></span><br><span class="line">        <span class="keyword">return</span> getInstance();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜²æ­¢å…‹éš†</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="comment">// (1) æŠ›å‡ºå¼‚å¸¸ä»¥é˜²æ­¢å…‹éš†</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CloneNotSupportedException</span>(<span class="string">&quot;Cloning of this singleton instance is not allowed&quot;</span>);</span><br><span class="line">        <span class="comment">// (2) æˆ–ç›´æ¥ä»å…‹éš†æ–¹æ³•è¿”å›ç›¸åŒå®ä¾‹</span></span><br><span class="line">        <span class="comment">//return getInstance();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3-é™æ€å†…éƒ¨ç±»å•ä¾‹"><a class="markdownIt-Anchor" href="#3-é™æ€å†…éƒ¨ç±»å•ä¾‹"></a> 3. é™æ€å†…éƒ¨ç±»å•ä¾‹</h1><p>é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼æœ¬è´¨ä¸Šä¹Ÿåˆ©ç”¨äº†ç±»åŠ è½½æœºåˆ¶æ¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚ç”±äºå…¶ç‰¹æ€§ï¼Œå®ƒå¯ä»¥ä¿è¯ç±»åˆå§‹åŒ–ä»…åœ¨å®é™…ä½¿ç”¨æ—¶è§¦å‘ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§æ‡’åŠ è½½çš„å½¢å¼ã€‚</p><ul><li>ä¸ <a href="#15-%E6%87%92%E6%B1%89%E5%8D%95%E4%BE%8B-%E5%8F%8C%E9%87%8D%E6%A3%80%E6%9F%A5%E9%94%81%E5%AE%9Adcl">1.5. æ‡’æ±‰å•ä¾‹ - åŒé‡æ£€æŸ¥é”å®šï¼ˆDCLï¼‰</a> ç›¸æ¯”ï¼Œè¿™ç§æ¨¡å¼ä¹Ÿèƒ½å®ç°ç±»ä¼¼çš„æ‡’åŠ è½½æ•ˆæœï¼Œä½†å®ç°æ›´ç®€å•ã€‚</li><li>ä¸ <a href="#2-%E9%A5%BF%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B">2. é¥¿æ±‰å¼å•ä¾‹</a> ç›¸æ¯”ï¼Œè¿™ç§æ¨¡å¼åŒæ ·åˆ©ç”¨ç±»åŠ è½½æœºåˆ¶æ¥åˆå§‹åŒ–å¹¶ç¡®ä¿åªæœ‰ä¸€ä¸ªç±»å®ä¾‹ã€‚å½“ç±»è¢«åŠ è½½æ—¶ï¼Œé¥¿æ±‰å¼å•ä¾‹å°†è¢«å®ä¾‹åŒ–ï¼Œä½†é™æ€å†…éƒ¨ç±»å•ä¾‹å¯èƒ½ä¸ä¼šã€‚è¿™æ˜¯å› ä¸ºå®ä¾‹åªæœ‰åœ¨å…¶é™æ€å†…éƒ¨ç±» <code>InstanceHolder</code> è¢«ä½¿ç”¨å’ŒåŠ è½½æ—¶æ‰ä¼šåˆ›å»ºã€‚å› æ­¤ï¼Œ<code>StaticInnerClassSingleton</code> çš„å®ä¾‹ä¸ä¼šåœ¨æ–¹æ³• <code>getInstance()</code> è¢«è°ƒç”¨ä¹‹å‰åˆ›å»ºï¼Œè¿™æ ·å°±å®ç°äº†æ‡’åŠ è½½çš„æ•ˆæœã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 3. é™æ€å†…éƒ¨ç±»å•ä¾‹</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ä¼˜ç‚¹ï¼š</span></span><br><span class="line"><span class="comment"> * 1. åŸºäºé™æ€å†…éƒ¨ç±»ç‰¹æ€§å®ç°æ‡’åŠ è½½</span></span><br><span class="line"><span class="comment"> * 2. å¯ä»¥ä¿è¯ `InstanceHolder` ç±»çš„é™æ€åˆå§‹åŒ–åœ¨ç±»åŠ è½½æœºåˆ¶ä¸‹çš„çº¿ç¨‹å®‰å…¨</span></span><br><span class="line"><span class="comment"> * 3. é¿å…äº†ä¸ DCL æ¨¡å¼ç›¸å…³çš„åŒæ­¥å¼€é”€</span></span><br><span class="line"><span class="comment"> * 4. ç›¸æ¯”äº DCL æ¨¡å¼ï¼Œç›¸å¯¹æ›´å®¹æ˜“ç†è§£</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ç¼ºç‚¹ï¼š</span></span><br><span class="line"><span class="comment"> * 1. å¯¹äºç±»åˆ›å»ºè¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸å¤„ç†ä¸å¤Ÿçµæ´»</span></span><br><span class="line"><span class="comment"> * 2. ç”±äºç±»åŠ è½½æ—¶æœºå¯èƒ½å¯¼è‡´æ„å¤–é—®é¢˜</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * æœ€ä½³ä½¿ç”¨åœºæ™¯ï¼š</span></span><br><span class="line"><span class="comment"> * 1. å½“å•ä¾‹ç±»æŒæœ‰å¤§é‡èµ„æºæ—¶ä½¿ç”¨</span></span><br><span class="line"><span class="comment"> * 2. å½“å¸Œæœ›å»¶è¿Ÿå•ä¾‹å®ä¾‹çš„åˆ›å»ºç›´åˆ°çœŸæ­£éœ€è¦æ—¶ä½¿ç”¨</span></span><br><span class="line"><span class="comment"> * 3. å½“éœ€è¦å¤æ‚åˆå§‹åŒ–æ­¥éª¤æ—¶é¿å…ä½¿ç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticInnerClassSingleton</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æ€å†…éƒ¨ç±»æä¾›ç±»çš„å•ä¾‹å®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">InstanceHolder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">StaticInnerClassSingleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StaticInnerClassSingleton</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šé™åˆ¶ç”¨æˆ·è‡ªè¡Œåˆ›å»ºå®ä¾‹ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">StaticInnerClassSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ§åˆ¶å¯¹å•ä¾‹å®ä¾‹çš„è®¿é—®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> StaticInnerClassSingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åªæœ‰åœ¨è¿™é‡Œæ‰ä¼šè§¦å‘ `InstanceHolder.instance` çš„åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">return</span> InstanceHolder.instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="31-å¯¹é™æ€å†…éƒ¨ç±»å•ä¾‹çš„åå°„æ”»å‡»"><a class="markdownIt-Anchor" href="#31-å¯¹é™æ€å†…éƒ¨ç±»å•ä¾‹çš„åå°„æ”»å‡»"></a> 3.1. å¯¹â€œé™æ€å†…éƒ¨ç±»å•ä¾‹â€çš„åå°„æ”»å‡»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StaticInnerSingletonReflectionProof</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æ€å†…éƒ¨ç±»æä¾›ç±»çš„å•ä¾‹å®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">InstanceHolder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">StaticInnerSingletonReflectionProof</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StaticInnerSingletonReflectionProof</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šé™åˆ¶ç”¨æˆ·è‡ªè¡Œåˆ›å»ºå®ä¾‹ï¼Œä½†æ— æ³•é˜²æ­¢æ„é€ å‡½æ•°çš„åå°„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">StaticInnerSingletonReflectionProof</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é˜²æ­¢åå°„æ”»å‡»</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != InstanceHolder.instance) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;This singleton instance already exists.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ§åˆ¶å¯¹å•ä¾‹å®ä¾‹çš„è®¿é—®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> StaticInnerSingletonReflectionProof <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åªæœ‰åœ¨è¿™é‡Œæ‰ä¼šè§¦å‘ `InstanceHolder.instance` çš„åˆå§‹åŒ–ã€‚</span></span><br><span class="line">        <span class="keyword">return</span> InstanceHolder.instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="32-å¯¹é™æ€å†…éƒ¨ç±»å•ä¾‹çš„åºåˆ—åŒ–æ”»å‡»"><a class="markdownIt-Anchor" href="#32-å¯¹é™æ€å†…éƒ¨ç±»å•ä¾‹çš„åºåˆ—åŒ–æ”»å‡»"></a> 3.2. å¯¹â€œé™æ€å†…éƒ¨ç±»å•ä¾‹â€çš„åºåˆ—åŒ–æ”»å‡»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StaticInnerSingletonSerializationProof</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¦‚æœåœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­æ²¡æœ‰æ·»åŠ  `serialVersionUID`ï¼Œç‰ˆæœ¬å·å°†æ ¹æ®å½“å‰ç±»æ•°æ®è‡ªåŠ¨ç”Ÿæˆã€‚</span></span><br><span class="line"><span class="comment">     * åœ¨ååºåˆ—åŒ–æ—¶ï¼Œä¹Ÿä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç‰ˆæœ¬å·ã€‚</span></span><br><span class="line"><span class="comment">     * å¦‚æœä¸¤ä¸ªç‰ˆæœ¬å·ä¸åŒ¹é…ï¼ˆç±»å†…å®¹åœ¨ååºåˆ—åŒ–å‰è¢«ä¿®æ”¹ï¼‰ï¼Œåˆ™ä¼šæŠ¥å‘Šä»¥ä¸‹é”™è¯¯ï¼š</span></span><br><span class="line"><span class="comment">     * `java.io.InvalidClassException: local class incompatible: stream classdesc serialVersionUID = -6193354024038071874, local class serialVersionUID = 3430229600994946531`</span></span><br><span class="line"><span class="comment">     * æŒ‡å®šä¸€ä¸ª serialVersionUID å¯ä»¥è§£å†³æ­¤é—®é¢˜ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æ€å†…éƒ¨ç±»æä¾›ç±»çš„å•ä¾‹å®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">InstanceHolder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">StaticInnerSingletonSerializationProof</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StaticInnerSingletonSerializationProof</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šé™åˆ¶ç”¨æˆ·è‡ªè¡Œåˆ›å»ºå®ä¾‹ï¼Œä½†æ— æ³•é˜²æ­¢æ„é€ å‡½æ•°çš„åå°„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">StaticInnerSingletonSerializationProof</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é˜²æ­¢åå°„æ”»å‡»</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != InstanceHolder.instance) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;This singleton instance already exists.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ§åˆ¶å¯¹å•ä¾‹å®ä¾‹çš„è®¿é—®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> StaticInnerSingletonSerializationProof <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> InstanceHolder.instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¹äºéæšä¸¾å•ä¾‹æ¨¡å¼ï¼Œåœ¨é¢å¯¹åºåˆ—åŒ–æ”»å‡»æ—¶ï¼Œå¿…é¡»å®ç° `readResolve()` æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ObjectStreamException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Object <span class="title function_">readResolve</span><span class="params">()</span> <span class="keyword">throws</span> ObjectStreamException &#123;</span><br><span class="line">        <span class="comment">// åœ¨ååºåˆ—åŒ–æœŸé—´ï¼šè¿”å›ç°æœ‰å®ä¾‹ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚</span></span><br><span class="line">        <span class="keyword">return</span> getInstance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="33-å®Œç¾ç‰ˆæœ¬çš„é™æ€å†…éƒ¨ç±»å•ä¾‹"><a class="markdownIt-Anchor" href="#33-å®Œç¾ç‰ˆæœ¬çš„é™æ€å†…éƒ¨ç±»å•ä¾‹"></a> 3.3. å®Œç¾ç‰ˆæœ¬çš„â€œé™æ€å†…éƒ¨ç±»å•ä¾‹â€</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é™æ€å†…éƒ¨ç±»å•ä¾‹ï¼šå®Œç¾ç‰ˆæœ¬</span></span><br><span class="line"><span class="comment"> * 1. åˆ©ç”¨é™æ€å†…éƒ¨ç±»çš„ç‰¹æ€§æä¾›æ‡’åŠ è½½å’ŒåŸºäºç±»åŠ è½½æœºåˆ¶çš„çº¿ç¨‹å®‰å…¨</span></span><br><span class="line"><span class="comment"> * 2. å°è¯•ä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°æ£€æŸ¥ä»¥é˜²æ­¢åå°„æ”»å‡»ï¼Œä½†åœ¨æ‰€æœ‰æƒ…å†µä¸‹æ— æ³•ä¿è¯</span></span><br><span class="line"><span class="comment"> * 3. ä½¿ç”¨å®šä¹‰çš„ serialVersionUID å’Œ readResolve() æ¥é˜²æ­¢åºåˆ—åŒ–æ”»å‡»</span></span><br><span class="line"><span class="comment"> * 4. é‡å†™ clone() æ–¹æ³•ä»¥é˜²æ­¢å…‹éš†æ”»å‡»</span></span><br><span class="line"><span class="comment"> * 5. ä½¿ç”¨ final ç±»é˜²æ­¢å­ç±»åŒ–ï¼Œé¿å…ä»»ä½•å­ç±»ç ´åå•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">StaticInnerSingletonPerfect</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜ç¡®å®šä¹‰ `serialVersionUID` å¯ä»¥é¿å…æ½œåœ¨çš„ä¸å…¼å®¹é—®é¢˜ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æ€å†…éƒ¨ç±»æä¾›ç±»çš„å•ä¾‹å®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">InstanceHolder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">StaticInnerSingletonPerfect</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StaticInnerSingletonPerfect</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šé™åˆ¶ç”¨æˆ·è‡ªè¡Œåˆ›å»ºå®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">StaticInnerSingletonPerfect</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é˜²æ­¢åå°„æ”»å‡»</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != InstanceHolder.instance) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;This singleton instance already exists.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ§åˆ¶å¯¹å•ä¾‹å®ä¾‹çš„è®¿é—®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> StaticInnerSingletonPerfect <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> StaticInnerSingletonPerfect.InstanceHolder.instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜²æ­¢åºåˆ—åŒ–æ”»å‡»</span></span><br><span class="line">    Object <span class="title function_">readResolve</span><span class="params">()</span> <span class="keyword">throws</span> ObjectStreamException &#123;</span><br><span class="line">        <span class="comment">// åœ¨ååºåˆ—åŒ–æœŸé—´ï¼šè¿”å›ç°æœ‰å®ä¾‹ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚</span></span><br><span class="line">        <span class="keyword">return</span> getInstance();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜²æ­¢å…‹éš†</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="comment">// (1) æŠ›å‡ºå¼‚å¸¸ä»¥é˜²æ­¢å…‹éš†</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CloneNotSupportedException</span>(<span class="string">&quot;Cloning of this singleton instance is not allowed&quot;</span>);</span><br><span class="line">        <span class="comment">// (2) æˆ–ç›´æ¥ä»å…‹éš†æ–¹æ³•è¿”å›ç›¸åŒå®ä¾‹</span></span><br><span class="line">        <span class="comment">//return getInstance();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4-æšä¸¾å‹å•ä¾‹"><a class="markdownIt-Anchor" href="#4-æšä¸¾å‹å•ä¾‹"></a> 4. æšä¸¾å‹å•ä¾‹</h1><p>æšä¸¾å‹å•ä¾‹è¢«è®¤ä¸ºæ˜¯å®ç°å•ä¾‹æ¨¡å¼çš„æœ€ä½³æ–¹å¼ã€‚å®ƒä¸ä»…åˆ©ç”¨äº†ç±»åŠ è½½æœºåˆ¶æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œè¿˜é˜²æ­¢åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­é‡å»ºå¯¹è±¡ï¼Œå¹¶é¿å…äº†åå°„æ”»å‡»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 4. æšä¸¾å‹å•ä¾‹</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ä¼˜ç‚¹ï¼š</span></span><br><span class="line"><span class="comment"> * 1. å®ç°éå¸¸ç®€å•ï¼Œä»£ç ç®€æ´ã€‚</span></span><br><span class="line"><span class="comment"> * 2. å¤©ç„¶çº¿ç¨‹å®‰å…¨ï¼Œå› ä¸ºä½¿ç”¨äº†ç±»åŠ è½½æœºåˆ¶ã€ç§æœ‰æ„é€ å‡½æ•°å’Œå…¬å…±é™æ€æœ€ç»ˆå®ä¾‹å­—æ®µã€‚</span></span><br><span class="line"><span class="comment"> * 3. å¯ä»¥é˜²æ­¢åå°„æ”»å‡»ï¼Œå› ä¸ºè°ƒç”¨ `newInstance()` æ—¶ä¼šæŠ›å‡º IllegalArgumentExceptionã€‚</span></span><br><span class="line"><span class="comment"> * 4. è‡ªå¸¦åºåˆ—åŒ–åŠŸèƒ½ï¼Œå¯ä»¥é˜²æ­¢åºåˆ—åŒ–æ”»å‡»ã€‚</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ç¼ºç‚¹ï¼š</span></span><br><span class="line"><span class="comment"> * 1. æ²¡æœ‰æ‡’åŠ è½½ã€‚</span></span><br><span class="line"><span class="comment"> * 2. ä¸èƒ½æ‰©å±•å…¶ä»–ç±»ï¼Œå› ä¸ºæšä¸¾ç±»éšå¼ç»§æ‰¿ `java.lang.Enum`ã€‚</span></span><br><span class="line"><span class="comment"> * 3. ä¸æ–¹ä¾¿è°ƒè¯•ï¼Œå› ä¸ºä¸€äº›å…³é”®ä»£ç æ˜¯éšå¼è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæ¯”å¦‚ç§æœ‰æ„é€ å‡½æ•°ã€é™æ€åˆå§‹åŒ–å—ç­‰ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">EnumSingleton</span> &#123;</span><br><span class="line">    instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">anyMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬åˆ†æä¸€ä¸‹æšä¸¾ç±»çš„å­—èŠ‚ç ã€‚åœ¨ç¼–è¯‘ <code>EnumSingleton.java</code> å¹¶é€šè¿‡ <code>javac -g EnumSingleton.java</code> ç”Ÿæˆç±»æ–‡ä»¶åï¼Œæ‰§è¡Œ <code>javap -v -p EnumSingleton.class</code> ä»¥ç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line">Classfile /DesignPattern-Lab/src/main/java/com/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton.<span class="keyword">class</span></span><br><span class="line">  <span class="title class_">Last</span> modified <span class="number">26</span>/08/<span class="number">2024</span>; size <span class="number">1195</span> bytes</span><br><span class="line">  MD5 checksum 1e21098493b1502d48f3a4fba5884dcc</span><br><span class="line">  Compiled from <span class="string">&quot;EnumSingleton.java&quot;</span></span><br><span class="line"><span class="comment">// æšä¸¾ç±»éšå¼ç»§æ‰¿ `java.lang.Enum`</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">com</span>.sissilab.dp.ox1_creational.ox11_singleton.EnumSingleton <span class="keyword">extends</span> <span class="title class_">java</span>.lang.Enum&lt;com.sissilab.dp.ox1_creational.ox11_singleton.EnumSingleton&gt;</span><br><span class="line">  minor version: <span class="number">0</span></span><br><span class="line">  major version: <span class="number">52</span></span><br><span class="line">  flags: ACC_PUBLIC, ACC_FINAL, ACC_SUPER, ACC_ENUM</span><br><span class="line">Constant pool:</span><br><span class="line">   #<span class="number">1</span> = Fieldref           #<span class="number">4.</span>#<span class="number">34</span>         <span class="comment">// com/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton.$VALUES:[Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;</span></span><br><span class="line">   #<span class="number">2</span> = Methodref          #<span class="number">35.</span>#<span class="number">36</span>        <span class="comment">// &quot;[Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;&quot;.clone:()Ljava/lang/Object;</span></span><br><span class="line">   #<span class="number">3</span> = Class              #<span class="number">14</span>            <span class="comment">// &quot;[Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;&quot;</span></span><br><span class="line">   #<span class="number">4</span> = Class              #<span class="number">37</span>            <span class="comment">// com/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton</span></span><br><span class="line">   #<span class="number">5</span> = Methodref          #<span class="number">10.</span>#<span class="number">38</span>        <span class="comment">// java/lang/Enum.valueOf:(Ljava/lang/Class;Ljava/lang/String;)Ljava/lang/Enum;</span></span><br><span class="line">   #<span class="number">6</span> = Methodref          #<span class="number">10.</span>#<span class="number">39</span>        <span class="comment">// java/lang/Enum.&quot;&lt;init&gt;&quot;:(Ljava/lang/String;I)V</span></span><br><span class="line">   #<span class="number">7</span> = String             #<span class="number">11</span>            <span class="comment">// instance</span></span><br><span class="line">   #<span class="number">8</span> = Methodref          #<span class="number">4.</span>#<span class="number">39</span>         <span class="comment">// com/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton.&quot;&lt;init&gt;&quot;:(Ljava/lang/String;I)V</span></span><br><span class="line">   #<span class="number">9</span> = Fieldref           #<span class="number">4.</span>#<span class="number">40</span>         <span class="comment">// com/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton.instance:Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;</span></span><br><span class="line">  #<span class="number">10</span> = Class              #<span class="number">41</span>            <span class="comment">// java/lang/Enum</span></span><br><span class="line">  #<span class="number">11</span> = Utf8               instance</span><br><span class="line">  #<span class="number">12</span> = Utf8               Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;</span><br><span class="line">  #<span class="number">13</span> = Utf8               $VALUES</span><br><span class="line">  #<span class="number">14</span> = Utf8               [Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;</span><br><span class="line">  #<span class="number">15</span> = Utf8               values</span><br><span class="line">  #<span class="number">16</span> = Utf8               ()[Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;</span><br><span class="line">  #<span class="number">17</span> = Utf8               Code</span><br><span class="line">  #<span class="number">18</span> = Utf8               LineNumberTable</span><br><span class="line">  #<span class="number">19</span> = Utf8               valueOf</span><br><span class="line">  #<span class="number">20</span> = Utf8               (Ljava/lang/String;)Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;</span><br><span class="line">  #<span class="number">21</span> = Utf8               LocalVariableTable</span><br><span class="line">  #<span class="number">22</span> = Utf8               name</span><br><span class="line">  #<span class="number">23</span> = Utf8               Ljava/lang/String;</span><br><span class="line">  #<span class="number">24</span> = Utf8               &lt;init&gt;</span><br><span class="line">  #<span class="number">25</span> = Utf8               (Ljava/lang/String;I)V</span><br><span class="line">  #<span class="number">26</span> = Utf8               <span class="built_in">this</span></span><br><span class="line">  #<span class="number">27</span> = Utf8               Signature</span><br><span class="line">  #<span class="number">28</span> = Utf8               ()V</span><br><span class="line">  #<span class="number">29</span> = Utf8               anyMethod</span><br><span class="line">  #<span class="number">30</span> = Utf8               &lt;clinit&gt;</span><br><span class="line">  #<span class="number">31</span> = Utf8               Ljava/lang/Enum&lt;Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;&gt;;</span><br><span class="line">  #<span class="number">32</span> = Utf8               SourceFile</span><br><span class="line">  #<span class="number">33</span> = Utf8               EnumSingleton.java</span><br><span class="line">  #<span class="number">34</span> = NameAndType        #<span class="number">13</span>:#<span class="number">14</span>        <span class="comment">// $VALUES:[Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;</span></span><br><span class="line">  #<span class="number">35</span> = Class              #<span class="number">14</span>            <span class="comment">// &quot;[Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;&quot;</span></span><br><span class="line">  #<span class="number">36</span> = NameAndType        #<span class="number">42</span>:#<span class="number">43</span>        <span class="comment">// clone:()Ljava/lang/Object;</span></span><br><span class="line">  #<span class="number">37</span> = Utf8               com/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton</span><br><span class="line">  #<span class="number">38</span> = NameAndType        #<span class="number">19</span>:#<span class="number">44</span>        <span class="comment">// valueOf:(Ljava/lang/Class;Ljava/lang/String;)Ljava/lang/Enum;</span></span><br><span class="line">  #<span class="number">39</span> = NameAndType        #<span class="number">24</span>:#<span class="number">25</span>        <span class="comment">// &quot;&lt;init&gt;&quot;:(Ljava/lang/String;I)V</span></span><br><span class="line">  #<span class="number">40</span> = NameAndType        #<span class="number">11</span>:#<span class="number">12</span>        <span class="comment">// instance:Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;</span></span><br><span class="line">  #<span class="number">41</span> = Utf8               java/lang/Enum</span><br><span class="line">  #<span class="number">42</span> = Utf8               clone</span><br><span class="line">  #<span class="number">43</span> = Utf8               ()Ljava/lang/Object;</span><br><span class="line">  #<span class="number">44</span> = Utf8               (Ljava/lang/Class;Ljava/lang/String;)Ljava/lang/Enum;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// `instance` æ˜¯ä¸€ä¸ª `public static final` å­—æ®µ</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> com.sissilab.dp.ox1_creational.ox11_singleton.EnumSingleton instance;</span><br><span class="line">    descriptor: Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC, ACC_FINAL, ACC_ENUM</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `private static final $VALUES` å­—æ®µä¿å­˜æ‰€æœ‰æšä¸¾å¸¸é‡</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> com.sissilab.dp.ox1_creational.ox11_singleton.EnumSingleton[] $VALUES;</span><br><span class="line">    descriptor: [Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;</span><br><span class="line">    flags: ACC_PRIVATE, ACC_STATIC, ACC_FINAL, ACC_SYNTHETIC</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `values()` æ–¹æ³•æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œç”¨äºè¿”å›å®šä¹‰çš„æšä¸¾å¸¸é‡æ•°ç»„</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> com.sissilab.dp.ox1_creational.ox11_singleton.EnumSingleton[] values();</span><br><span class="line">    descriptor: ()[Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">0</span>, args_size=<span class="number">0</span></span><br><span class="line">         <span class="number">0</span>: getstatic     #<span class="number">1</span>                  <span class="comment">// Field $VALUES:[Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;</span></span><br><span class="line">         <span class="number">3</span>: invokevirtual #<span class="number">2</span>                  <span class="comment">// Method &quot;[Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;&quot;.clone:()Ljava/lang/Object;</span></span><br><span class="line">         <span class="number">6</span>: checkcast     #<span class="number">3</span>                  <span class="comment">// class &quot;[Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;&quot;</span></span><br><span class="line">         <span class="number">9</span>: areturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">17</span>: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> com.sissilab.dp.ox1_creational.ox11_singleton.EnumSingleton <span class="title function_">valueOf</span><span class="params">(java.lang.String)</span>;</span><br><span class="line">    descriptor: (Ljava/lang/String;)Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: ldc           #<span class="number">4</span>                  <span class="comment">// class com/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton</span></span><br><span class="line">         <span class="number">2</span>: aload_0</span><br><span class="line">         <span class="number">3</span>: invokestatic  #<span class="number">5</span>                  <span class="comment">// Method java/lang/Enum.valueOf:(Ljava/lang/Class;Ljava/lang/String;)Ljava/lang/Enum;</span></span><br><span class="line">         <span class="number">6</span>: checkcast     #<span class="number">4</span>                  <span class="comment">// class com/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton</span></span><br><span class="line">         <span class="number">9</span>: areturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">17</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>      <span class="number">10</span>     <span class="number">0</span>  name   Ljava/lang/String;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è‡ªåŠ¨ç”Ÿæˆçš„ä¸¤ä¸ªå‚æ•°ï¼ˆString, intï¼‰çš„ç§æœ‰æ„é€ å‡½æ•°</span></span><br><span class="line">  <span class="keyword">private</span> com.sissilab.dp.ox1_creational.ox11_singleton.EnumSingleton();</span><br><span class="line">    descriptor: (Ljava/lang/String;I)V</span><br><span class="line">    flags: ACC_PRIVATE</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">3</span>, locals=<span class="number">3</span>, args_size=<span class="number">3</span></span><br><span class="line">         <span class="comment">// å°† `this` å¼•ç”¨åŠ è½½åˆ°æ ˆä¸Šï¼ˆæ¥è‡ª slot 0ï¼‰</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="comment">// å°†å­˜å‚¨åœ¨å±€éƒ¨å˜é‡ 1 ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆæšä¸¾å¸¸é‡çš„ `name`ï¼‰åŠ è½½åˆ°æ ˆä¸Š</span></span><br><span class="line">         <span class="number">1</span>: aload_1</span><br><span class="line">         <span class="comment">// å°†å­˜å‚¨åœ¨å±€éƒ¨å˜é‡ 2 ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°ï¼ˆæšä¸¾å¸¸é‡çš„ `ordinal`ï¼‰åŠ è½½åˆ°æ ˆä¸Š</span></span><br><span class="line">         <span class="number">2</span>: iload_2</span><br><span class="line">         <span class="comment">// è°ƒç”¨è¶…ç±»æ„é€ å‡½æ•° `java.lang.Enum (String name, int ordinal)`</span></span><br><span class="line">         <span class="number">3</span>: invokespecial #<span class="number">6</span>                  <span class="comment">// Method java/lang/Enum.&quot;&lt;init&gt;&quot;:(Ljava/lang/String;I)V</span></span><br><span class="line">         <span class="number">6</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">17</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">7</span>     <span class="number">0</span>  <span class="built_in">this</span>   Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;</span><br><span class="line">    Signature: #<span class="number">28</span>                          <span class="comment">// ()V</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">anyMethod</span><span class="params">()</span>;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">0</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">21</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">1</span>     <span class="number">0</span>  <span class="built_in">this</span>   Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é™æ€åˆå§‹åŒ–å—</span></span><br><span class="line">  <span class="keyword">static</span> &#123;&#125;;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">4</span>, locals=<span class="number">0</span>, args_size=<span class="number">0</span></span><br><span class="line">         <span class="comment">// ä¸ºç”± #4 å¼•ç”¨çš„ç±»åˆ†é…å†…å­˜ -&gt; å°†å¼•ç”¨æ·»åŠ åˆ°æ“ä½œæ•°æ ˆçš„é¡¶éƒ¨</span></span><br><span class="line">         <span class="number">0</span>: <span class="keyword">new</span>           #<span class="number">4</span>                  <span class="comment">// class com/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton</span></span><br><span class="line">         <span class="comment">// dupï¼šå¤åˆ¶æ ˆé¡¶å€¼ -&gt; å°†å¤åˆ¶çš„å¼•ç”¨æ·»åŠ åˆ°æ“ä½œæ•°æ ˆçš„é¡¶éƒ¨</span></span><br><span class="line">         <span class="number">3</span>: dup</span><br><span class="line">         <span class="comment">// ldcï¼šå°†å­—ç¬¦ä¸²å®ä¾‹åŠ è½½åˆ°æ ˆä¸Šï¼ˆ`String name`ï¼‰</span></span><br><span class="line">         <span class="number">4</span>: ldc           #<span class="number">7</span>                  <span class="comment">// String instance</span></span><br><span class="line">         <span class="comment">// iconst_0ï¼šå°†æ•´æ•°å¸¸é‡ 0 å‹å…¥æ ˆä¸­ï¼ˆ`int ordinal`ï¼‰</span></span><br><span class="line">         <span class="number">6</span>: iconst_0</span><br><span class="line">         <span class="comment">// invokespecialï¼šè°ƒç”¨æ„é€ å‡½æ•° EnumSingleton(String, int) è¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line">         <span class="number">7</span>: invokespecial #<span class="number">8</span>                  <span class="comment">// Method &quot;&lt;init&gt;&quot;:(Ljava/lang/String;I)V</span></span><br><span class="line">        <span class="comment">// putstaticï¼šå°†åˆ›å»ºçš„å®ä¾‹åˆ†é…ç»™ EnumSingleton çš„é™æ€å­—æ®µ `instance`</span></span><br><span class="line">        <span class="number">10</span>: putstatic     #<span class="number">9</span>                  <span class="comment">// Field instance:Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;</span></span><br><span class="line">        <span class="comment">// iconst_1ï¼šå°†æ•´æ•° 1ï¼ˆè¦åˆ›å»ºçš„æ•°ç»„çš„å¤§å°ï¼‰å‹å…¥æ ˆä¸­</span></span><br><span class="line">        <span class="number">13</span>: iconst_1</span><br><span class="line">        <span class="comment">// anewarrayï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ EnumSingleton å¯¹è±¡æ•°ç»„ï¼ˆå¤§å°ä¸º 1ï¼‰</span></span><br><span class="line">        <span class="number">14</span>: anewarray     #<span class="number">4</span>                  <span class="comment">// class com/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton</span></span><br><span class="line">        <span class="comment">// dupï¼šå¤åˆ¶æ ˆä¸Šçš„æ•°ç»„å¼•ç”¨</span></span><br><span class="line">        <span class="number">17</span>: dup</span><br><span class="line">        <span class="comment">// iconst_0ï¼šå°†æ•´æ•° 0ï¼ˆæ•°ç»„çš„ç´¢å¼•ï¼‰å‹å…¥æ ˆä¸­</span></span><br><span class="line">        <span class="number">18</span>: iconst_0</span><br><span class="line">        <span class="comment">// getstaticï¼šè·å–é™æ€å­—æ®µ `instance`</span></span><br><span class="line">        <span class="number">19</span>: getstatic     #<span class="number">9</span>                  <span class="comment">// Field instance:Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;</span></span><br><span class="line">        <span class="comment">// aastoreï¼šå°†å®ä¾‹å­˜å‚¨åˆ°æ•°ç»„çš„ç´¢å¼• 0 å¤„</span></span><br><span class="line">        <span class="number">22</span>: aastore</span><br><span class="line">        <span class="comment">// putstaticï¼šå°†æ•°ç»„å­˜å‚¨åˆ°é™æ€å­—æ®µ `$VALUES` ä¸­ï¼ˆå®ƒæŒ‰é¡ºåºä¿å­˜æ‰€æœ‰æšä¸¾å¸¸é‡ï¼‰</span></span><br><span class="line">        <span class="number">23</span>: putstatic     #<span class="number">1</span>                  <span class="comment">// Field $VALUES:[Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;</span></span><br><span class="line">        <span class="number">26</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">18</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">17</span>: <span class="number">13</span></span><br><span class="line">&#125;</span><br><span class="line">Signature: #<span class="number">31</span>                          <span class="comment">// Ljava/lang/Enum&lt;Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;&gt;;</span></span><br><span class="line">SourceFile: <span class="string">&quot;EnumSingleton.java&quot;</span></span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œåˆå§‹åŒ–è¿‡ç¨‹å‘ç”Ÿåœ¨é™æ€åˆå§‹åŒ–å—ï¼ˆ<code>static &#123;&#125;</code>ï¼Œå®ƒä¼šåœ¨ç±»é¦–æ¬¡åŠ è½½æ—¶æ‰§è¡Œï¼‰ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸ºç”± #4 å¼•ç”¨çš„ç±»åˆ†é…å†…å­˜ -&gt; å°†å¼•ç”¨æ·»åŠ åˆ°æ“ä½œæ•°æ ˆçš„é¡¶éƒ¨</span></span><br><span class="line"><span class="number">0</span>: <span class="keyword">new</span>           #<span class="number">4</span>                  <span class="comment">// class com/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// dupï¼šå¤åˆ¶æ ˆé¡¶å€¼ -&gt; å°†å¤åˆ¶çš„å¼•ç”¨æ·»åŠ åˆ°æ“ä½œæ•°æ ˆçš„é¡¶éƒ¨</span></span><br><span class="line"><span class="number">3</span>: dup</span><br><span class="line"></span><br><span class="line"><span class="comment">// ldcï¼šå°†å­—ç¬¦ä¸²å®ä¾‹åŠ è½½åˆ°æ ˆä¸Šï¼ˆ`String name`ï¼‰</span></span><br><span class="line"><span class="number">4</span>: ldc           #<span class="number">7</span>                  <span class="comment">// String instance</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// iconst_0ï¼šå°†æ•´æ•°å¸¸é‡ 0 å‹å…¥æ ˆä¸­ï¼ˆ`int ordinal`ï¼‰</span></span><br><span class="line"><span class="number">6</span>: iconst_0</span><br><span class="line"></span><br><span class="line"><span class="comment">// invokespecialï¼šè°ƒç”¨æ„é€ å‡½æ•° EnumSingleton(String, int) è¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line"><span class="number">7</span>: invokespecial #<span class="number">8</span>                  <span class="comment">// Method &quot;&lt;init&gt;&quot;:(Ljava/lang/String;I)V</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// putstaticï¼šå°†åˆ›å»ºçš„å®ä¾‹åˆ†é…ç»™ EnumSingleton çš„é™æ€å­—æ®µ `instance`</span></span><br><span class="line"><span class="number">10</span>: putstatic     #<span class="number">9</span>                  <span class="comment">// Field instance:Lcom/sissilab/dp/ox1_creational/ox11_singleton/EnumSingleton;</span></span><br></pre></td></tr></table></figure><h2 id="41-å¯¹æšä¸¾å‹å•ä¾‹çš„åå°„æ”»å‡»"><a class="markdownIt-Anchor" href="#41-å¯¹æšä¸¾å‹å•ä¾‹çš„åå°„æ”»å‡»"></a> 4.1. å¯¹â€œæšä¸¾å‹å•ä¾‹â€çš„åå°„æ”»å‡»</h2><p>å½“å°è¯•é€šè¿‡åå°„è·å–æšä¸¾ç±»çš„å®ä¾‹æ—¶ï¼Œä¼šæŠ›å‡ºé”™è¯¯ï¼š<code>java.lang.IllegalArgumentException: Cannot reflectively create enum objects</code>ã€‚è¿™æœ‰æ•ˆåœ°é˜²æ­¢äº†åå°„æ”»å‡»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testReflectionAttackOnEnumSingleton</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException &#123;</span><br><span class="line">    <span class="comment">// è·å–æ„é€ å‡½æ•°ï¼šåªä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå¸¦æœ‰ä¸¤ä¸ªå‚æ•°çš„ç§æœ‰æ„é€ å‡½æ•°ï¼Œå¦‚ `private EnumSingleton(String, int)`</span></span><br><span class="line">    Constructor&lt;EnumSingleton&gt; constructor = EnumSingleton.class.getDeclaredConstructor(String.class, <span class="type">int</span>.class);</span><br><span class="line">    <span class="comment">// è®¾ç½®æ„é€ å‡½æ•°çš„å¯è®¿é—®æ€§</span></span><br><span class="line">    constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="comment">// reflectInstance: é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºå®ä¾‹</span></span><br><span class="line">    <span class="type">EnumSingleton</span> <span class="variable">reflectInstance</span> <span class="operator">=</span> constructor.newInstance(<span class="string">&quot;instance&quot;</span>, <span class="number">0</span>); <span class="comment">// java.lang.IllegalArgumentException: Cannot reflectively create enum objects</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// instance: é€šè¿‡æ­£å¸¸çš„ public static final `instance` å­—æ®µè·å–å®ä¾‹</span></span><br><span class="line">    <span class="type">EnumSingleton</span> <span class="variable">instance</span> <span class="operator">=</span> EnumSingleton.instance;</span><br><span class="line"></span><br><span class="line">    Assertions.assertSame(reflectInstance, instance); <span class="comment">// Ã—</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œé”™è¯¯æ˜¯åœ¨ <code>public T newInstance(Object ... initargs)</code> ä¸­æŠ›å‡ºçš„ã€‚ä»¥ä¸‹æºä»£ç è¡¨æ˜æœ‰ä¸€ä¸ªæ˜¾å¼æ£€æŸ¥å½“å‰ç±»æ˜¯å¦ä¸ºæšä¸¾ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¼šæŠ›å‡º <code>IllegalArgumentException</code>ã€‚å› æ­¤ï¼Œæšä¸¾å•ä¾‹å¯ä»¥æœ‰æ•ˆé˜²æ­¢åå°„æ”»å‡»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Constructor</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Executable</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@CallerSensitive</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">newInstance</span><span class="params">(Object ... initargs)</span> <span class="keyword">throws</span> InstantiationException, IllegalAccessException, IllegalArgumentException, InvocationTargetException &#123;</span><br><span class="line">        <span class="keyword">if</span> (!override) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!Reflection.quickCheckMemberAccess(clazz, modifiers)) &#123;</span><br><span class="line">                Class&lt;?&gt; caller = Reflection.getCallerClass();</span><br><span class="line">                checkAccess(caller, clazz, <span class="literal">null</span>, modifiers);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰ç±»æ˜¯æšä¸¾ç±»å‹ï¼Œåˆ™ä¼šæŠ›å‡º `IllegalArgumentException`ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> ((clazz.getModifiers() &amp; Modifier.ENUM) != <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Cannot reflectively create enum objects&quot;</span>);</span><br><span class="line">        <span class="type">ConstructorAccessor</span> <span class="variable">ca</span> <span class="operator">=</span> constructorAccessor;   <span class="comment">// è¯»å– volatile</span></span><br><span class="line">        <span class="keyword">if</span> (ca == <span class="literal">null</span>) &#123;</span><br><span class="line">            ca = acquireConstructorAccessor();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">        <span class="type">T</span> <span class="variable">inst</span> <span class="operator">=</span> (T) ca.newInstance(initargs);</span><br><span class="line">        <span class="keyword">return</span> inst;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="42-å¯¹æšä¸¾å‹å•ä¾‹çš„åºåˆ—åŒ–æ”»å‡»"><a class="markdownIt-Anchor" href="#42-å¯¹æšä¸¾å‹å•ä¾‹çš„åºåˆ—åŒ–æ”»å‡»"></a> 4.2. å¯¹â€œæšä¸¾å‹å•ä¾‹â€çš„åºåˆ—åŒ–æ”»å‡»</h2><p>æ¯ä¸ªæšä¸¾ç±»éšå¼ç»§æ‰¿è‡ª <code>java.lang.Enum</code> æŠ½è±¡ç±»ï¼Œè¯¥ç±»å®ç°äº† <code>java.io.Serializable</code>ï¼Œè¿™æ„å‘³ç€æšä¸¾ç±»å¯ä»¥æ”¯æŒåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚å¾—ç›Šäºå…¶å†…ç½®æœºåˆ¶ï¼Œæšä¸¾å•ä¾‹å¤©ç„¶èƒ½å¤ŸæŠµå¾¡åºåˆ—åŒ–æ”»å‡»ï¼Œå› ä¸ºåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¸ä¼šåˆ›å»ºæ–°çš„æšä¸¾å¸¸é‡å®ä¾‹ã€‚</p><p>è®©æˆ‘ä»¬çœ‹çœ‹åœ¨ååºåˆ—åŒ–æºä»£ç ä¸­æšä¸¾å•ä¾‹å‘ç”Ÿäº†ä»€ä¹ˆã€‚åœ¨ <code>readObject0(type, false)</code> æ–¹æ³•ä¸­ï¼Œé’ˆå¯¹ <code>TC_ENUM</code> çš„æƒ…å†µï¼šâ€“&gt; <code>readEnum(boolean unshared)</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Enum&lt;?&gt; readEnum(<span class="type">boolean</span> unshared) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// ä»…å¤„ç†ä½œä¸ºæšä¸¾åºåˆ—åŒ–çš„å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">if</span> (bin.readByte() != TC_ENUM) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InternalError</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">ObjectStreamClass</span> <span class="variable">desc</span> <span class="operator">=</span> readClassDesc(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// å¦‚æœè¯¥ç±»ä¸æ˜¯æšä¸¾ï¼Œåˆ™ä¼šæŠ›å‡º InvalidClassExceptionã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (!desc.isEnum()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidClassException</span>(<span class="string">&quot;non-enum class: &quot;</span> + desc);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">enumHandle</span> <span class="operator">=</span> handles.assign(unshared ? unsharedMarker : <span class="literal">null</span>);</span><br><span class="line">    <span class="type">ClassNotFoundException</span> <span class="variable">resolveEx</span> <span class="operator">=</span> desc.getResolveException();</span><br><span class="line">    <span class="keyword">if</span> (resolveEx != <span class="literal">null</span>) &#123;</span><br><span class="line">        handles.markException(enumHandle, resolveEx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æšä¸¾å¸¸é‡çš„åç§°ï¼Œä¾‹å¦‚ `instance`ï¼ˆæ¯ä¸ªå¸¸é‡åç§°åœ¨æšä¸¾ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼‰ã€‚</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> readString(<span class="literal">false</span>);</span><br><span class="line">    Enum&lt;?&gt; result = <span class="literal">null</span>;</span><br><span class="line">    Class&lt;?&gt; cl = desc.forClass();</span><br><span class="line">    <span class="keyword">if</span> (cl != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">            <span class="comment">// ä½¿ç”¨æšä¸¾ç±»ï¼ˆä¾‹å¦‚ `EnumSingleton`ï¼‰å’Œå¸¸é‡åç§°ï¼ˆä¾‹å¦‚ `instance`ï¼‰æŸ¥æ‰¾å¸¸é‡</span></span><br><span class="line">            <span class="comment">// è¿™æ˜¯å…³é”®éƒ¨åˆ†ï¼Œæ— è®ºæšä¸¾åºåˆ—åŒ–å’Œååºåˆ—åŒ–å¤šå°‘æ¬¡ï¼Œéƒ½ä¸ä¼šåˆ›å»ºæ–°çš„æšä¸¾å®ä¾‹ã€‚</span></span><br><span class="line">            Enum&lt;?&gt; en = Enum.valueOf((Class)cl, name);</span><br><span class="line">            result = en;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> (IOException) <span class="keyword">new</span> <span class="title class_">InvalidObjectException</span>(</span><br><span class="line">                <span class="string">&quot;enum constant &quot;</span> + name + <span class="string">&quot; does not exist in &quot;</span> +</span><br><span class="line">                cl).initCause(ex);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!unshared) &#123;</span><br><span class="line">            <span class="comment">// åœ¨é»˜è®¤æ¨¡å¼ï¼ˆå…±äº«æ¨¡å¼ï¼‰ä¸‹ï¼Œ`unshared` ä¸º falseã€‚è¿™æ„å‘³ç€å¦‚æœå¯¹è±¡åœ¨åºåˆ—åŒ–æµä¸­å‡ºç°å¤šæ¬¡ï¼Œæ‰€æœ‰æŒ‡å‘è¯¥å¯¹è±¡çš„å¼•ç”¨éƒ½å°†æŒ‡å‘åŒä¸€ä¸ªååºåˆ—åŒ–å®ä¾‹ã€‚</span></span><br><span class="line">            <span class="comment">// å°†æ›´æ–°ç°æœ‰çš„å¥æŸ„ï¼ˆ`Object[] entries`ï¼‰ï¼Œç¡®ä¿é‡ç”¨åŒä¸€æšä¸¾å®ä¾‹ï¼Œå°¤å…¶æ˜¯å¯¹äºæšä¸¾å•ä¾‹ã€‚</span></span><br><span class="line">            handles.setObject(enumHandle, result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handles.finish(enumHandle);</span><br><span class="line">    passHandle = enumHandle;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T <span class="keyword">extends</span> <span class="title class_">Enum</span>&lt;T&gt;&gt; T <span class="title function_">valueOf</span><span class="params">(Class&lt;T&gt; enumType, String name)</span> &#123;</span><br><span class="line">    <span class="comment">// ä»å†…éƒ¨æ˜ å°„ (`Map&lt;String, T&gt; enumConstantDirectory`) ä¸­é€šè¿‡åç§°è·å–æšä¸¾å¸¸é‡</span></span><br><span class="line">    <span class="comment">// åœ¨ `enumConstantDirectory()` å†…éƒ¨æœ‰ä¸€ä¸ªé¢„æ„å»ºçš„æ˜ å°„ï¼ŒåŒ…å«æ‰€æœ‰åŠ è½½åˆ°å†…å­˜ä¸­çš„æšä¸¾å¸¸é‡ï¼Œç¡®ä¿æ¯ä¸ªæšä¸¾å¸¸é‡çš„å”¯ä¸€æ€§ã€‚</span></span><br><span class="line">    <span class="type">T</span> <span class="variable">result</span> <span class="operator">=</span> enumType.enumConstantDirectory().get(name);</span><br><span class="line">    <span class="keyword">if</span> (result != <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    <span class="keyword">if</span> (name == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;Name is null&quot;</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(</span><br><span class="line">        <span class="string">&quot;No enum constant &quot;</span> + enumType.getCanonicalName() + <span class="string">&quot;.&quot;</span> + name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="43-å®Œç¾ç‰ˆæœ¬çš„æšä¸¾å‹å•ä¾‹"><a class="markdownIt-Anchor" href="#43-å®Œç¾ç‰ˆæœ¬çš„æšä¸¾å‹å•ä¾‹"></a> 4.3. å®Œç¾ç‰ˆæœ¬çš„â€œæšä¸¾å‹å•ä¾‹â€</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨æ­¤å•ä¾‹ï¼š</span></span><br><span class="line"><span class="comment"> * `EnumSingletonPerfect.instance.anyMethod();`</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">EnumSingletonPerfect</span> &#123;</span><br><span class="line">    instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">anyMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¿é—®å»¶è¿ŸåŠ è½½çš„èµ„æºï¼š</span></span><br><span class="line"><span class="comment">     * `EnumSingletonPerfect.instance.getExpensiveResource().useResource();`</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨é™æ€å†…éƒ¨ç±»æ¥å®ç°é‡èµ„æºçš„å»¶è¿ŸåŠ è½½</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">LazyHeavyResource</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">HeavyResource</span> <span class="variable">RESOURCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeavyResource</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> HeavyResource <span class="title function_">getExpensiveResource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LazyHeavyResource.RESOURCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™ä¸ªé™æ€å†…éƒ¨ç±»ä»£è¡¨ä¸€ä¸ªé‡èµ„æºã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">HeavyResource</span> &#123;</span><br><span class="line">        HeavyResource() &#123;</span><br><span class="line">            <span class="comment">// æ¨¡æ‹Ÿè€—è´¹èµ„æºçš„åˆå§‹åŒ–åœºæ™¯â€¦â€¦éœ€è¦å¤§é‡æ—¶é—´æ¥åŠ è½½</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">useResource</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Use this heavy resource...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="5-åœ¨æºä»£ç ä¸­çš„åº”ç”¨"><a class="markdownIt-Anchor" href="#5-åœ¨æºä»£ç ä¸­çš„åº”ç”¨"></a> 5. åœ¨æºä»£ç ä¸­çš„åº”ç”¨</h1><h2 id="51-javalangruntime-é¥¿æ±‰å¼å•ä¾‹-é™æ€å¸¸é‡"><a class="markdownIt-Anchor" href="#51-javalangruntime-é¥¿æ±‰å¼å•ä¾‹-é™æ€å¸¸é‡"></a> 5.1. java.lang.Runtime (é¥¿æ±‰å¼å•ä¾‹ - é™æ€å¸¸é‡)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¥¿æ±‰å¼å•ä¾‹ - é™æ€å¸¸é‡ï¼šå•ä¾‹å®ä¾‹ `currentRuntime` åœ¨ç±»åŠ è½½æ—¶åˆå§‹åŒ–ï¼Œç¡®ä¿å®ä¾‹æå‰åˆ›å»ºå¹¶ä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Runtime</span> &#123;</span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹ï¼šåœ¨åŠ è½½ç±»æ—¶åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Runtime</span> <span class="variable">currentRuntime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runtime</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šé˜²æ­¢å¤–éƒ¨å®ä¾‹åŒ–</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Runtime</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ§åˆ¶è®¿é—®å•ä¾‹å®ä¾‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Runtime <span class="title function_">getRuntime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> currentRuntime;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="52-orgquartzimplschedulerrepository-æ‡’æ±‰å¼å•ä¾‹-synchronized"><a class="markdownIt-Anchor" href="#52-orgquartzimplschedulerrepository-æ‡’æ±‰å¼å•ä¾‹-synchronized"></a> 5.2. org.quartz.impl.SchedulerRepository (æ‡’æ±‰å¼å•ä¾‹ - synchronized)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Scheduler scheduler = new StdSchedulerFactory().getScheduler(); -&gt; SchedulerRepository schedRep = SchedulerRepository.getInstance();</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SchedulerRepository</span> &#123;</span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SchedulerRepository inst;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°ï¼šé˜²æ­¢å¤–éƒ¨å®ä¾‹åŒ–</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SchedulerRepository</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ§åˆ¶è®¿é—®å•ä¾‹å®ä¾‹ï¼šä½¿ç”¨é™æ€åŒæ­¥æ–¹æ³•ä»¥ç¡®ä¿çº¿ç¨‹å®‰å…¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> SchedulerRepository <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (inst == <span class="literal">null</span>) &#123;</span><br><span class="line">            inst = <span class="keyword">new</span> <span class="title class_">SchedulerRepository</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> inst;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="53-spring-orgspringframeworkbeansfactorysupportdefaultsingletonbeanregistry-æ‡’æ±‰å¼å•ä¾‹-åŒé‡æ£€æŸ¥é”å®š-dcl"><a class="markdownIt-Anchor" href="#53-spring-orgspringframeworkbeansfactorysupportdefaultsingletonbeanregistry-æ‡’æ±‰å¼å•ä¾‹-åŒé‡æ£€æŸ¥é”å®š-dcl"></a> 5.3. Spring - org.springframework.beans.factory.support.DefaultSingletonBeanRegistry (æ‡’æ±‰å¼å•ä¾‹ - åŒé‡æ£€æŸ¥é”å®š DCL)</h2><p>Spring çš„å•ä¾‹æ¨¡å¼ï¼šå½“åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­å®šä¹‰ä¸€ä¸ª bean æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ˜ç¡®æŒ‡å®šä½œç”¨åŸŸï¼ŒSpring ä¼šå°†å…¶è§†ä¸ºå•ä¾‹ã€‚è¿™æ„å‘³ç€ Spring åªä¼šåˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œè¯¥å®ä¾‹å¯ä»¥è¢«æ‰€æœ‰ç±»å…±äº«ã€‚é€šè¿‡åœ¨ Spring ä¸­åˆ©ç”¨è¿™ç§å•ä¾‹æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥äº«å—åˆ°é«˜æ•ˆçš„å†…å­˜ç®¡ç†ã€é›†ä¸­åŒ–çš„ bean é…ç½®ï¼Œä»¥åŠåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«å’Œé‡ç”¨ bean å®ä¾‹çš„å¥½å¤„ã€‚</p><p>åœ¨ Spring ä¸­ï¼ŒåŠ è½½å•ä¾‹çš„è¿‡ç¨‹é€šå¸¸ä» <code>org.springframework.beans.factory.BeanFactory</code> çš„ <code>getBean()</code> æ–¹æ³•å¼€å§‹ï¼Œå…¶é»˜è®¤å®ç°æ˜¯æŠ½è±¡ç±» <code>org.springframework.beans.factory.support.AbstractBeanFactory</code>ã€‚å„ç§ <code>getBean()</code> æ–¹æ³•æœ€ç»ˆè°ƒç”¨ <code>AbstractBeanFactory</code> çš„ <code>doGetBean()</code> æ–¹æ³•ï¼Œä¾‹å¦‚ <code>org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// org.springframework.beans.factory.support.AbstractBeanFactory</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractBeanFactory</span> <span class="keyword">extends</span> <span class="title class_">FactoryBeanRegistrySupport</span> <span class="keyword">implements</span> <span class="title class_">ConfigurableBeanFactory</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> &lt;T&gt; T <span class="title function_">doGetBean</span><span class="params">(<span class="keyword">final</span> String name, <span class="keyword">final</span> Class&lt;T&gt; requiredType, <span class="keyword">final</span> Object[] args, <span class="type">boolean</span> typeCheckOnly)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="comment">// è·å–è½¬æ¢åçš„ bean åç§°ï¼Œä»¥é˜²åç§°åŒ…å«éæ³•å­—ç¬¦</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> transformedBeanName(name);</span><br><span class="line">        Object bean;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// æ£€æŸ¥å•ä¾‹ç¼“å­˜ä»¥æŸ¥æ‰¾æ‰‹åŠ¨æ³¨å†Œçš„å•ä¾‹</span></span><br><span class="line">        <span class="comment">// é€šå¸¸æƒ…å†µä¸‹ï¼Œå®ƒå°†åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚ bean æ—¶è¿”å› nullã€‚</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">sharedInstance</span> <span class="operator">=</span> getSingleton(beanName);</span><br><span class="line">        <span class="keyword">if</span> (sharedInstance != <span class="literal">null</span> &amp;&amp; args == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è·å–ç»™å®š bean å®ä¾‹çš„å¯¹è±¡ï¼Œè¦ä¹ˆæ˜¯ bean å®ä¾‹æœ¬èº«ï¼Œè¦ä¹ˆæ˜¯ FactoryBean åˆ›å»ºçš„å¯¹è±¡ã€‚</span></span><br><span class="line">            bean = getObjectForBeanInstance(sharedInstance, name, beanName, <span class="literal">null</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="type">RootBeanDefinition</span> <span class="variable">mbd</span> <span class="operator">=</span> getMergedLocalBeanDefinition(beanName);</span><br><span class="line">                <span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">                <span class="comment">// åˆ›å»º bean å®ä¾‹</span></span><br><span class="line">                <span class="keyword">if</span> (mbd.isSingleton()) &#123;</span><br><span class="line">                    <span class="comment">// è‹¥è¯¥ bean æ˜¯å•ä¾‹ï¼Œå®ƒå°†ä¼šè¿›å…¥é‡è½½çš„ `getSingleton()` æ–¹æ³•</span></span><br><span class="line">                    sharedInstance = getSingleton(beanName, <span class="keyword">new</span> <span class="title class_">ObjectFactory</span>&lt;Object&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="keyword">public</span> Object <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                <span class="keyword">return</span> createBean(beanName, mbd, args);</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">                                destroySingleton(beanName);</span><br><span class="line">                                <span class="keyword">throw</span> ex;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    bean = getObjectForBeanInstance(sharedInstance, name, beanName, mbd);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mbd.isPrototype()) &#123;</span><br><span class="line">                    <span class="comment">// ...</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// ...</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">                cleanupAfterBeanCreationFailure(beanName);</span><br><span class="line">                <span class="keyword">throw</span> ex;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">return</span> (T) bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥ä»£ç  <code>Object sharedInstance = getSingleton(beanName);</code> åœ¨ <code>getBean()</code> æ–¹æ³•ä¸­æ˜¯ Spring ä¸­å•ä¾‹æ¨¡å¼ï¼ˆåŒé‡æ£€æŸ¥ï¼‰çš„æ ¸å¿ƒå®ç°ã€‚<code>getSingleton()</code> æ–¹æ³•åœ¨ <code>AbstractBeanFactory</code> çš„çˆ¶ç±» <code>DefaultSingletonBeanRegistry</code> ä¸­å®šä¹‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultSingletonBeanRegistry</span> <span class="keyword">extends</span> <span class="title class_">SimpleAliasRegistry</span> <span class="keyword">implements</span> <span class="title class_">SingletonBeanRegistry</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å•ä¾‹å¯¹è±¡ç¼“å­˜ï¼ˆå®Œå…¨åˆå§‹åŒ–çš„å•ä¾‹ beanï¼‰ï¼šbean åç§° -&gt; bean å®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="number">256</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ—©æœŸå•ä¾‹å¯¹è±¡ç¼“å­˜ï¼ˆå½“å‰æ­£åœ¨åˆ›å»ºçš„å•ä¾‹ beanï¼Œéƒ¨åˆ†åˆ›å»ºï¼‰ï¼šbean åç§° -&gt; bean å®ä¾‹</span></span><br><span class="line">    <span class="comment">// è¿™æ˜¯è§£å†³å¾ªç¯ä¾èµ–çš„å…³é”®ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; earlySingletonObjects = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å•ä¾‹å·¥å‚ç¼“å­˜ï¼šbean åç§° -&gt; ObjectFactory</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getSingleton</span><span class="params">(String beanName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getSingleton(beanName, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ® DCL æ¨¡å¼ä»ç¼“å­˜ä¸­è·å– bean</span></span><br><span class="line">    <span class="comment">// `singletonObjects` -&gt; `earlySingletonObjects` -&gt; `singletonFactories` -&gt; é€šè¿‡ `singletonFactory.getObject()` åˆ›å»ºå•ä¾‹ bean</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">getSingleton</span><span class="params">(String beanName, <span class="type">boolean</span> allowEarlyReference)</span> &#123;</span><br><span class="line">        <span class="comment">// (1) `singletonObjects`ï¼šæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦åŒ…å« bean</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">singletonObject</span> <span class="operator">=</span> <span class="built_in">this</span>.singletonObjects.get(beanName);</span><br><span class="line">        <span class="comment">// åœ¨ `singletonObjects` ä¸­æ‰¾ä¸åˆ°å•ä¾‹ã€‚&amp;&amp; å•ä¾‹ bean å½“å‰æ­£åœ¨åˆ›å»ºä¸­ã€‚</span></span><br><span class="line">        <span class="comment">// isSingletonCurrentlyInCreation(beanName)ï¼šå¦‚æœä¸ºçœŸï¼Œåˆ™å•ä¾‹ bean æ­£åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­ä½†å°šæœªå®Œå…¨åˆå§‹åŒ–ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (singletonObject == <span class="literal">null</span> &amp;&amp; isSingletonCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="built_in">this</span>.singletonObjects) &#123; <span class="comment">// åœ¨ `singletonObjects` æ˜ å°„ä¸ŠåŒæ­¥ä»¥ç¡®ä¿çº¿ç¨‹å®‰å…¨</span></span><br><span class="line">                <span class="comment">// (2) `earlySingletonObjects`ï¼šæ­¤ç¼“å­˜ä¿å­˜æ­£åœ¨åˆ›å»ºçš„ beanã€‚</span></span><br><span class="line">                singletonObject = <span class="built_in">this</span>.earlySingletonObjects.get(beanName);</span><br><span class="line">                <span class="comment">// åœ¨ `earlySingletonObjects` ä¸­æ‰¾ä¸åˆ°å•ä¾‹ã€‚&amp;&amp; `allowEarlyReference` ä¸ºçœŸã€‚</span></span><br><span class="line">                <span class="keyword">if</span> (singletonObject == <span class="literal">null</span> &amp;&amp; allowEarlyReference) &#123;</span><br><span class="line">                    <span class="comment">// å½“æŸäº›æ–¹æ³•éœ€è¦æå‰åˆå§‹åŒ–æ—¶ï¼Œè°ƒç”¨ `addSingleFactory()` æ–¹æ³•å°†ç›¸åº”çš„ `ObjectFactory` åˆå§‹åŒ–ç­–ç•¥å­˜å‚¨åœ¨ `singletonFactories` æ˜ å°„ä¸­ã€‚</span></span><br><span class="line">                    <span class="comment">// (3) `singletonFactories`ï¼šé€šè¿‡ beanName è·å– ObjectFactory</span></span><br><span class="line">                    ObjectFactory&lt;?&gt; singletonFactory = <span class="built_in">this</span>.singletonFactories.get(beanName);</span><br><span class="line">                    <span class="keyword">if</span> (singletonFactory != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="comment">// åˆ›å»ºå¹¶è·å– bean</span></span><br><span class="line">                        singletonObject = singletonFactory.getObject();</span><br><span class="line">                        <span class="comment">// æ›´æ–°ä¸¤ä¸ªç¼“å­˜ï¼š`earlySingletonObjects` å’Œ `singletonFactories` äº’æ–¥ã€‚</span></span><br><span class="line">                        <span class="built_in">this</span>.earlySingletonObjects.put(beanName, singletonObject);</span><br><span class="line">                        <span class="built_in">this</span>.singletonFactories.remove(beanName);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (singletonObject != NULL_OBJECT ? singletonObject : <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æ¥è¯´ï¼Œå½“ç¬¬ä¸€æ¬¡åœ¨ <code>doGetBean()</code> ä¸­è°ƒç”¨ <code>getSingleton()</code> æ—¶ï¼Œç¼“å­˜ä¸­æ‰¾ä¸åˆ°å¯¹åº”çš„ bean å®ä¾‹ã€‚ç„¶åï¼Œå®ƒè¿›å…¥ <code>if (mbd.isSingleton()) &#123; &#125;</code> å—ï¼Œè°ƒç”¨é‡è½½çš„ <code>getSingleton()</code> æ–¹æ³•ã€‚åœ¨æ­¤æ–¹æ³•ä¸­ï¼Œbean è¢«å®ä¾‹åŒ–ï¼Œç„¶åå®ä¾‹è¢«ç¼“å­˜åˆ° <code>singletonObjects</code> æ˜ å°„ä¸­ï¼Œä»è€Œå…è®¸åœ¨åç»­è¯·æ±‚ä¸­ç›´æ¥è¿”å›å•ä¾‹ beanã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultSingletonBeanRegistry</span> <span class="keyword">extends</span> <span class="title class_">SimpleAliasRegistry</span> <span class="keyword">implements</span> <span class="title class_">SingletonBeanRegistry</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getSingleton</span><span class="params">(String beanName, ObjectFactory&lt;?&gt; singletonFactory)</span> &#123;</span><br><span class="line">        Assert.notNull(beanName, <span class="string">&quot;&#x27;beanName&#x27; must not be null&quot;</span>);</span><br><span class="line">        <span class="comment">// ç”±äºåˆ›å»ºè¿‡ç¨‹æ¶‰åŠå¯¹ `singletonObjects` çš„æ“ä½œï¼Œå› æ­¤éœ€è¦åŠ é”ã€‚</span></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>.singletonObjects) &#123;</span><br><span class="line">            <span class="comment">// 1. å†æ¬¡å°è¯•ä» `singletonObjects` æ˜ å°„ä¸­è·å– beanï¼Œå¹¶æ£€æŸ¥ bean æ˜¯å¦å·²åŠ è½½ã€‚å¦‚æœ bean å·²åŠ è½½ï¼Œåˆ™ç›´æ¥è¿”å›ã€‚</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">singletonObject</span> <span class="operator">=</span> <span class="built_in">this</span>.singletonObjects.get(beanName);</span><br><span class="line">            <span class="keyword">if</span> (singletonObject == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 2. å¦‚æœå½“å‰ BeanFactory æ­£åœ¨è¢«é”€æ¯ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œä¸å…è®¸åˆ›å»ºå•ä¾‹ beanã€‚</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.singletonsCurrentlyInDestruction) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationNotAllowedException</span>(beanName,</span><br><span class="line">                                                              <span class="string">&quot;Singleton bean creation not allowed while singletons of this factory are in destruction &quot;</span> +</span><br><span class="line">                                                              <span class="string">&quot;(Do not request a bean from a BeanFactory in a destroy method implementation!)&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                    logger.debug(<span class="string">&quot;Creating shared instance of singleton bean &#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 3. åˆ›å»º bean ä¹‹å‰çš„ä¸€äº›å‡†å¤‡å·¥ä½œï¼š</span></span><br><span class="line">                <span class="comment">// beanName è¢«è®°å½•ä¸ºå½“å‰æ­£åœ¨åŠ è½½ï¼ˆæ·»åŠ åˆ° `singletonsCurrentlyInCreation` ç¼“å­˜ä¸­ï¼‰ã€‚</span></span><br><span class="line">                <span class="comment">// å¦‚æœ bean å·²ç»åœ¨åŠ è½½è¿‡ç¨‹ä¸­ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</span></span><br><span class="line">                <span class="comment">// è¿™æ˜¯ä¸ºäº†è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚</span></span><br><span class="line">                beforeSingletonCreation(beanName);</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">newSingleton</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">recordSuppressedExceptions</span> <span class="operator">=</span> (<span class="built_in">this</span>.suppressedExceptions == <span class="literal">null</span>);</span><br><span class="line">                <span class="keyword">if</span> (recordSuppressedExceptions) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.suppressedExceptions = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;Exception&gt;();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// 4. é€šè¿‡å›è°ƒæœºåˆ¶è·å– bean å®ä¾‹ã€‚</span></span><br><span class="line">                    singletonObject = singletonFactory.getObject();</span><br><span class="line">                    newSingleton = <span class="literal">true</span>;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IllegalStateException ex) &#123;</span><br><span class="line">                    <span class="comment">// å•ä¾‹å¯¹è±¡åœ¨æ­¤æœŸé—´æ˜¯å¦éšå¼å‡ºç° -&gt;</span></span><br><span class="line">                    <span class="comment">// å¦‚æœæ˜¯ï¼Œåˆ™ç»§ç»­ä½¿ç”¨å®ƒï¼Œå› ä¸ºè¯¥å¼‚å¸¸è¡¨æ˜äº†çŠ¶æ€ã€‚</span></span><br><span class="line">                    singletonObject = <span class="built_in">this</span>.singletonObjects.get(beanName);</span><br><span class="line">                    <span class="keyword">if</span> (singletonObject == <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> ex;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (BeanCreationException ex) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (recordSuppressedExceptions) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (Exception suppressedException : <span class="built_in">this</span>.suppressedExceptions) &#123;</span><br><span class="line">                            ex.addRelatedCause(suppressedException);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">throw</span> ex;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (recordSuppressedExceptions) &#123;</span><br><span class="line">                        <span class="built_in">this</span>.suppressedExceptions = <span class="literal">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 5. å•ä¾‹ bean åŠ è½½åçš„åå¤„ç†æ­¥éª¤ï¼š</span></span><br><span class="line">                    <span class="comment">// ç§»é™¤å½“å‰æ­£åœ¨åˆ›å»ºçš„ bean çš„è®°å½•ï¼ˆä» `singletonsCurrentlyInCreation` ç¼“å­˜ä¸­ç§»é™¤ beanNameï¼‰ã€‚</span></span><br><span class="line">                    afterSingletonCreation(beanName); <span class="comment">// ä» singletonsCurrentlyInCreation ä¸­ç§»é™¤è¯¥ beanName</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (newSingleton) &#123;</span><br><span class="line">                    <span class="comment">// 6. æ·»åŠ åˆ° `singletonObjects` ç¼“å­˜å¹¶ä»å…¶ä»–è¾…åŠ©ç¼“å­˜ä¸­ç§»é™¤ï¼ˆä¾‹å¦‚ `singletonFactories`ã€`earlySingletonObjects`ï¼‰</span></span><br><span class="line">                    addSingleton(beanName, singletonObject);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> (singletonObject != NULL_OBJECT ? singletonObject : <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="54-spring-orgspringframeworkcorereactiveadapterregistry-æ‡’æ±‰å¼å•ä¾‹-åŒé‡æ£€æŸ¥é”å®š-dcl"><a class="markdownIt-Anchor" href="#54-spring-orgspringframeworkcorereactiveadapterregistry-æ‡’æ±‰å¼å•ä¾‹-åŒé‡æ£€æŸ¥é”å®š-dcl"></a> 5.4. Spring - org.springframework.core.ReactiveAdapterRegistry (æ‡’æ±‰å¼å•ä¾‹ - åŒé‡æ£€æŸ¥é”å®š DCL)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReactiveAdapterRegistry</span> &#123;</span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹ï¼šæ·»åŠ  volatile ä»¥é˜²æ­¢é‡æ’åº</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> ReactiveAdapterRegistry sharedInstance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®š</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ReactiveAdapterRegistry <span class="title function_">getSharedInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ReactiveAdapterRegistry</span> <span class="variable">registry</span> <span class="operator">=</span> sharedInstance;</span><br><span class="line">        <span class="keyword">if</span> (registry == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (ReactiveAdapterRegistry.class) &#123;</span><br><span class="line">                registry = sharedInstance;</span><br><span class="line">                <span class="keyword">if</span> (registry == <span class="literal">null</span>) &#123;</span><br><span class="line">                    registry = <span class="keyword">new</span> <span class="title class_">ReactiveAdapterRegistry</span>();</span><br><span class="line">                    sharedInstance = registry;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> registry;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="55-spring-orgspringframeworkaopframeworkproxyfactorybean-æ‡’æ±‰å¼å•ä¾‹-synchronized"><a class="markdownIt-Anchor" href="#55-spring-orgspringframeworkaopframeworkproxyfactorybean-æ‡’æ±‰å¼å•ä¾‹-synchronized"></a> 5.5. Spring - org.springframework.aop.framework.ProxyFactoryBean (æ‡’æ±‰å¼å•ä¾‹ - synchronized)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyFactoryBean</span> <span class="keyword">extends</span> <span class="title class_">ProxyCreatorSupport</span></span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;Object&gt;, BeanClassLoaderAware, BeanFactoryAware &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Object singletonInstance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ§åˆ¶å¯¹å•ä¾‹å®ä¾‹çš„è®¿é—®ï¼šä½¿ç”¨åŒæ­¥æ–¹æ³•ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">synchronized</span> Object <span class="title function_">getSingletonInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.singletonInstance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.targetSource = freshTargetSource();</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.autodetectInterfaces &amp;&amp; getProxiedInterfaces().length == <span class="number">0</span> &amp;&amp; !isProxyTargetClass()) &#123;</span><br><span class="line">                <span class="comment">// ä¾èµ– AOP æœºåˆ¶æ¥å‘Šè¯‰æˆ‘ä»¬è¦ä»£ç†å“ªäº›æ¥å£</span></span><br><span class="line">                Class&lt;?&gt; targetClass = getTargetClass();</span><br><span class="line">                <span class="keyword">if</span> (targetClass == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FactoryBeanNotInitializedException</span>(<span class="string">&quot;Cannot determine target class for proxy&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                setInterfaces(ClassUtils.getAllInterfacesForClass(targetClass, <span class="built_in">this</span>.proxyClassLoader));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// åˆå§‹åŒ–å…±äº«çš„å•ä¾‹å®ä¾‹ã€‚</span></span><br><span class="line">            <span class="built_in">super</span>.setFrozen(<span class="built_in">this</span>.freezeProxy);</span><br><span class="line">            <span class="comment">// åˆ›å»º AOP åŠ¨æ€ä»£ç† å’Œ è·å–å®ä¾‹</span></span><br><span class="line">            <span class="built_in">this</span>.singletonInstance = getProxy(createAopProxy());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.singletonInstance;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="56-tomcat-orgapachecatalinawebresourcestomcaturlstreamhandlerfactory-æ‡’æ±‰å¼å•ä¾‹-åŒé‡æ£€æŸ¥é”å®š-dcl"><a class="markdownIt-Anchor" href="#56-tomcat-orgapachecatalinawebresourcestomcaturlstreamhandlerfactory-æ‡’æ±‰å¼å•ä¾‹-åŒé‡æ£€æŸ¥é”å®š-dcl"></a> 5.6. Tomcat - org.apache.catalina.webresources.TomcatURLStreamHandlerFactory (æ‡’æ±‰å¼å•ä¾‹ - åŒé‡æ£€æŸ¥é”å®š DCL)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TomcatURLStreamHandlerFactory</span> <span class="keyword">implements</span> <span class="title class_">URLStreamHandlerFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰å•ä¾‹å®ä¾‹ï¼šæ·»åŠ  volatile æ¥é˜²æ­¢æŒ‡å®šé‡æ’</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">TomcatURLStreamHandlerFactory</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> TomcatURLStreamHandlerFactory <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        getInstanceInternal(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ åŒé‡æ£€æŸ¥é”å®š DCL</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> TomcatURLStreamHandlerFactory <span class="title function_">getInstanceInternal</span><span class="params">(<span class="type">boolean</span> register)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">var1</span> <span class="operator">=</span> TomcatURLStreamHandlerFactory.class;</span><br><span class="line">            <span class="keyword">synchronized</span>(TomcatURLStreamHandlerFactory.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">TomcatURLStreamHandlerFactory</span>(register);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="references"><a class="markdownIt-Anchor" href="#references"></a> References</h1><ul><li><a href="https://en.wikipedia.org/wiki/Singleton_pattern">Singleton pattern - Wikipedia</a></li><li><a href="https://java-design-patterns.com/patterns/singleton/">Singleton Pattern in Java: Implementing Global Access Points in Java Applications | Java Design Patterns (java-design-patterns.com)</a></li><li><a href="https://www.runoob.com/design-pattern/singleton-pattern.html">èœé¸Ÿæ•™ç¨‹-å•ä¾‹æ¨¡å¼</a></li></ul>]]></content>
        
        
        <categories>
            
            <category> 23 ç§è®¾è®¡æ¨¡å¼ </category>
            
            <category> 1. åˆ›å»ºå‹æ¨¡å¼ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
            <tag> åˆ›å»ºå‹æ¨¡å¼ </tag>
            
        </tags>
        
    </entry>
    
    
    
    <entry>
        <title>è®¾è®¡æ¨¡å¼æ¦‚è§ˆ</title>
        <link href="/zh-CN/design-pattern/design-pattern-overview/"/>
        <url>/zh-CN/design-pattern/design-pattern-overview/</url>
        
        <content type="html"><![CDATA[<p>è®¾è®¡æ¨¡å¼ä¸€èˆ¬å…±åˆ†ä¸ºä¸‰å¤§ç±»ï¼š</p><p><strong>1. åˆ›å»ºå‹æ¨¡å¼ (Creational Pattern)ï¼š</strong></p><ul class="contains-task-list"><li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox"> <a href="/zh-CN/design-pattern/singleton-pattern">1.1.å•ä¾‹æ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">1.2.å·¥å‚æ–¹æ³•æ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">1.3.æŠ½è±¡å·¥å‚æ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">1.4.å»ºé€ è€…æ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">1.5.åŸå‹æ¨¡å¼</a></li></ul><p><strong>2. ç»“æ„å‹æ¨¡å¼ (Strctural Pattern)ï¼š</strong></p><ul class="contains-task-list"><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">2.1.é€‚é…å™¨æ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">2.2.è£…é¥°å™¨æ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">2.3.ä»£ç†æ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">2.4.å¤–è§‚æ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">2.5.æ¡¥æ¥æ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">2.6.ç»„åˆæ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">2.7.äº«å…ƒæ¨¡å¼</a></li></ul><p><strong>3. è¡Œä¸ºå‹æ¨¡å¼ (Behavioral Pattern)ï¼š</strong></p><ul class="contains-task-list"><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">3.1.ç­–ç•¥æ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">3.2.æ¨¡æ¿æ–¹æ³•æ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">3.3.è§‚å¯Ÿè€…æ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">3.4.è¿­ä»£å­æ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">3.5.è´£ä»»é“¾æ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">3.6.å‘½ä»¤æ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">3.7.å¤‡å¿˜å½•æ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">3.8.çŠ¶æ€æ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">3.9.è®¿é—®è€…æ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">3.10.ä¸­ä»‹è€…æ¨¡å¼</a></li><li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <a href="#">3.11.è§£é‡Šå™¨æ¨¡å¼</a><br />d</li></ul>]]></content>
        
        
        <categories>
            
            <category> 23 ç§è®¾è®¡æ¨¡å¼ </category>
            
            <category> 0. æ¦‚è§ˆ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
            <tag> æ¦‚è§ˆ </tag>
            
        </tags>
        
    </entry>
    
    
    
    
</search>